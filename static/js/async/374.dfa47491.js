(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["374"],{18810:function(n,e,t){"use strict";n.exports=t.p+"static/image/11.208c6b12.png"},52096:function(n,e,t){"use strict";n.exports=t.p+"static/image/12.29308569.png"},43858:function(n,e,t){"use strict";n.exports=t.p+"static/image/13.1cbdf0fc.png"},86850:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return d}});var i=t("69051"),a=t("72525"),r=t("43858"),o=t("52096"),s=t("18810");function l(n){let e=Object.assign({h1:"h1",a:"a",h2:"h2",h3:"h3",pre:"pre",code:"code",p:"p",ul:"ul",li:"li",img:"img"},(0,a.useMDXComponents)(),n.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.h1,{id:"\u9762\u8BD5\u5B9D\u5178app-\u6211\u7684\u6A21\u5757",children:["\u9762\u8BD5\u5B9D\u5178APP-\u6211\u7684\u6A21\u5757",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u9762\u8BD5\u5B9D\u5178app-\u6211\u7684\u6A21\u5757",children:"#"})]}),"\n",(0,i.jsxs)(e.h2,{id:"\u4E2A\u4EBA\u4E2D\u5FC3",children:["\u4E2A\u4EBA\u4E2D\u5FC3",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u4E2A\u4EBA\u4E2D\u5FC3",children:"#"})]}),"\n",(0,i.jsxs)(e.h3,{id:"1-\u6211\u7684-\u9875\u9762\u7ED3\u6784",children:["1. \u6211\u7684-\u9875\u9762\u7ED3\u6784",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#1-\u6211\u7684-\u9875\u9762\u7ED3\u6784",children:"#"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Mine.ets"',children:"import { IvClock } from '../../common/components/IvClock'\nimport { vp2vp } from '../../common/utils/Basic'\n\n@Preview\n@Component\nexport struct Mine {\n  @Builder\n  NavBuilder(icon: Resource, title: string,) {\n    Column({ space: vp2vp(8) }) {\n      Image(icon)\n        .width(vp2vp(30))\n        .height(vp2vp(30))\n        .objectFit(ImageFit.Fill)\n      Text(title)\n        .fontColor($r('app.color.gray'))\n        .fontSize(vp2vp(13))\n    }\n  }\n\n  @Builder\n  CellBuilder(title: string, cb?: () => void) {\n    Row() {\n      Text(title)\n        .fontSize(vp2vp(15))\n        .fontColor($r('app.color.black'))\n      Image($r('app.media.icon_my_arrow'))\n        .fillColor('#C3C3C5')\n        .width(vp2vp(18))\n        .height(vp2vp(18))\n    }\n    .width('100%')\n    .height(vp2vp(40))\n    .justifyContent(FlexAlign.SpaceBetween)\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n    .onClick(()=>{\n      cb && cb()\n    })\n  }\n\n  build() {\n    Column({ space: vp2vp(15) }) {\n      // \u5934\u90E8\n      Row() {\n        Image('/common/images/avatar.png')\n          .alt('/common/images/avatar.png')\n          .width(vp2vp(55))\n          .aspectRatio(1)\n          .borderRadius(vp2vp(30))\n          .border({ width: 0.5, color: '#e4e4e4' })\n        Column({ space: vp2vp(5) }) {\n          Text('\u9ED1\u9A6C\u7A0B\u5E8F\u5458')\n            .fontSize(vp2vp(18))\n            .fontWeight(FontWeight.Bold)\n          Row() {\n            Text('\u7F16\u8F91\u8D44\u6599')\n              .fontSize(vp2vp(12))\n              .fontColor($r('app.color.gray'))\n            Image($r('app.media.icon_edit'))\n              .width(vp2vp(12))\n              .aspectRatio(1)\n              .fillColor($r('app.color.gray'))\n          }\n        }\n        .padding({ left: vp2vp(12) })\n        .alignItems(HorizontalAlign.Start)\n        .layoutWeight(1)\n\n        IvClock({ clockCount: 0 })\n      }\n      .height(vp2vp(80))\n\n      // \u5BFC\u822A\n      GridRow({ columns: 4 }) {\n        GridCol() {\n          this.NavBuilder($r('app.media.icon_my_history'), '\u5386\u53F2\u8BB0\u5F55')\n        }\n\n        GridCol() {\n          this.NavBuilder($r('app.media.icon_my_favo'), '\u6211\u7684\u6536\u85CF')\n        }\n\n        GridCol() {\n          this.NavBuilder($r('app.media.icon_my_zan'), '\u6211\u7684\u70B9\u8D5E')\n        }\n\n        GridCol() {\n          Column() {\n            this.NavBuilder($r('app.media.icon_my_time'), '\u7D2F\u8BA1\u5B66\u65F6')\n            Row() {\n              Text('10\u5206\u949F')\n                .fontColor('#C3C3C5')\n                .fontSize(vp2vp(11))\n              Image($r('app.media.icon_my_arrow'))\n                .fillColor('#C3C3C5')\n                .width(vp2vp(13))\n                .height(vp2vp(13))\n            }\n            .margin({ top: vp2vp(3) })\n          }\n        }\n      }\n      .backgroundColor('#fff')\n      .padding({ top: vp2vp(15), bottom: vp2vp(15) })\n      .borderRadius(vp2vp(8))\n\n      Row() {\n        Text()\n          .width(vp2vp(3))\n          .height(vp2vp(12))\n          .backgroundColor($r('app.color.green'))\n        Text('\u524D\u7AEF\u5E38\u7528\u8BCD')\n          .fontSize(vp2vp(15))\n          .fontColor($r('app.color.black'))\n          .layoutWeight(1)\n          .padding({ left: vp2vp(12) })\n        Image($r('app.media.icon_my_new'))\n          .width(vp2vp(53))\n          .height(vp2vp(22))\n          .margin({ right: vp2vp(10) })\n      }\n      .backgroundColor('#fff')\n      .padding({ top: vp2vp(15), bottom: vp2vp(15) })\n      .borderRadius(vp2vp(8))\n\n      List() {\n        ListItem() {\n          this.CellBuilder('\u63A8\u8350\u5206\u4EAB')\n        }\n\n        ListItem() {\n          this.CellBuilder('\u610F\u89C1\u53CD\u9988')\n        }\n\n        ListItem() {\n          this.CellBuilder('\u5173\u4E8E\u6211\u4EEC')\n        }\n\n        if (this.user.token) {\n          ListItem() {\n            this.CellBuilder('\u9000\u51FA\u767B\u5F55', () => {\n              // \u9000\u51FA\u767B\u5F55\n            })\n          }\n        }\n      }\n      .padding({ top: vp2vp(10), bottom: vp2vp(10) })\n      .borderRadius(vp2vp(8))\n      .backgroundColor('#fff')\n      .divider({ strokeWidth: 0.5, color: $r('app.color.gray_bg') })\n\n    }\n    .padding(vp2vp(15))\n    .width('100%')\n    .height('100%')\n    .backgroundColor($r('app.color.gray_bg'))\n  }\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"2-\u6211\u7684-\u9875\u9762\u903B\u8F91",children:["2. \u6211\u7684-\u9875\u9762\u903B\u8F91",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#2-\u6211\u7684-\u9875\u9762\u903B\u8F91",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u5728 Index \u521D\u59CB\u5316\u6301\u4E45\u5316\u7528\u6237"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/Index.ets"',children:"  Auth.initLocalUser()\n"})}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u83B7\u53D6 AppStorage \u7528\u6237\u6570\u636E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Mine.ets"',children:"  @StorageProp(USER_KEY)\n  @Watch('updateUser')\n  userJson: string = '{}'\n  @State\n  user: UserModel = JSON.parse(this.userJson)\n\n  updateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n"})}),"\n",(0,i.jsx)(e.p,{children:"3\uFF09\u8FDB\u884C\u5C55\u793A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'{3,10,11,23-32,38} title="views/Index/Mine.ets"',children:"      // \u5934\u90E8\n      Row() {\n        Image(this.user.avatar || '/common/images/avatar.png')\n          .alt('/common/images/avatar.png')\n          .width(vp2vp(55))\n          .aspectRatio(1)\n          .borderRadius(vp2vp(30))\n          .border({ width: 0.5, color: '#e4e4e4' })\n        Column({ space: vp2vp(5) }) {\n          if (this.user.token) {\n            Text(this.user.nickName || this.user.username)\n              .fontSize(vp2vp(18))\n              .fontWeight(FontWeight.Bold)\n            Row() {\n              Text('\u7F16\u8F91\u8D44\u6599')\n                .fontSize(vp2vp(12))\n                .fontColor($r('app.color.gray'))\n              Image($r('app.media.icon_edit'))\n                .width(vp2vp(12))\n                .aspectRatio(1)\n                .fillColor($r('app.color.gray'))\n            }\n          } else {\n            Text('\u70B9\u51FB\u767B\u5F55')\n              .fontSize(vp2vp(18))\n              .fontWeight(FontWeight.Bold)\n              .onClick(() => {\n                router.pushUrl({\n                  url: 'pages/LoginPage'\n                })\n              })\n          }\n        }\n        .padding({ left: vp2vp(12) })\n        .alignItems(HorizontalAlign.Start)\n        .layoutWeight(1)\n\n        IvClock({ clockCount: this.user.clockinNumbers || 0  })\n      }\n      .height(vp2vp(80))\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'{4} title="views/Index/Mine.ets"',children:"          Column() {\n            this.NavBuilder($r('app.media.icon_my_time'), '\u7D2F\u8BA1\u5B66\u65F6')\n            Row() {\n              Text(formatTime(this.user.totalTime))\n                .fontColor('#C3C3C5')\n                .fontSize(vp2vp(11))\n              Image($r('app.media.icon_my_arrow'))\n                .fillColor('#C3C3C5')\n                .width(vp2vp(13))\n                .height(vp2vp(13))\n            }\n            .margin({ top: vp2vp(3) })\n          }\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Mine.ets"',children:"        if (this.user.token) {\n          this.CellBuilder('\u9000\u51FA\u767B\u5F55')\n        }\n"})}),"\n",(0,i.jsx)(e.p,{children:"4\uFF09Basic \u5C01\u88C5\u65F6\u95F4\u8F6C\u6362\u51FD\u6570"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="common/utils/Basic.ets"',children:"export const formatTime = (time: number = 0, hasUnit: boolean = true) => {\n  if (time < 3600) {\n    return String(Math.floor(time / 60)) + (hasUnit ? ' \u5206\u949F' : '')\n  } else {\n    return String(Math.round(time / 3600 * 10) / 10) + (hasUnit ? ' \u5C0F\u65F6' : '')\n  }\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Mine.ets"',children:"              Text(formatTime(this.user.totalTime))\n                .fontColor('#C3C3C5')\n                .fontSize(vp2vp(11))\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"3-\u767B\u5F55-\u9875\u9762\u7ED3\u6784",children:["3. \u767B\u5F55-\u9875\u9762\u7ED3\u6784",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#3-\u767B\u5F55-\u9875\u9762\u7ED3\u6784",children:"#"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/LoginPage.ets"',children:"import { vp2vp } from '../common/utils/Basic'\n\n@Extend(TextInput) function customStyle() {\n  .height(vp2vp(44))\n  .borderRadius(vp2vp(2))\n  .backgroundColor('#ffffff')\n  .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })\n  .padding({ left: 0 })\n  .placeholderColor('#C3C3C5')\n  .caretColor('#fa711d')\n}\n\n@Entry\n@Component\nstruct LoginPage {\n  @State\n  username: string = 'hmheima'\n  @State\n  password: string = 'Hmheima%123'\n  @State\n  isAgree: boolean = false\n  @State\n  loading: boolean = false\n\n  build() {\n    Navigation() {\n      Scroll() {\n        Column() {\n          Column() {\n            Image($r('app.media.icon'))\n              .width(vp2vp(120))\n              .aspectRatio(1)\n            Text('\u9762\u8BD5\u5B9D\u5178')\n              .fontSize(vp2vp(28))\n              .margin({ bottom: vp2vp(15) })\n            Text('\u641E\u5B9A\u4F01\u4E1A\u9762\u8BD5\u771F\u9898\uFF0C\u5C31\u7528\u9762\u8BD5\u5B9D\u5178')\n              .fontSize(vp2vp(14))\n              .fontColor($r('app.color.gray'))\n          }\n\n          Column({ space: vp2vp(15) }) {\n            TextInput({ placeholder: '\u8BF7\u8F93\u5165\u7528\u6237\u540D', text: this.username })\n              .customStyle()\n              .onChange(val => this.username = val)\n            TextInput({ placeholder: '\u8BF7\u8F93\u5165\u5BC6\u7801', text: this.password, })\n              .type(InputType.Password)\n              .showPasswordIcon(false)\n              .customStyle()\n              .onChange(val => this.password = val)\n            Row() {\n              Checkbox()\n                .selectedColor('#fa711d')\n                .width(vp2vp(14))\n                .aspectRatio(1)\n                .select(this.isAgree)\n                .onChange((val) => {\n                  this.isAgree = val\n                })\n              Row({ space: vp2vp(4) }) {\n                Text('\u5DF2\u9605\u8BFB\u5E76\u540C\u610F')\n                  .fontSize(vp2vp(14))\n                  .fontColor($r('app.color.gray'))\n                Text('\u7528\u6237\u534F\u8BAE')\n                  .fontSize(vp2vp(14))\n                Text('\u548C')\n                  .fontSize(vp2vp(14))\n                  .fontColor($r('app.color.gray'))\n                Text('\u9690\u79C1\u653F\u7B56')\n                  .fontSize(vp2vp(14))\n              }\n            }\n            .width('100%')\n\n            Button({ type: ButtonType.Normal   }) {\n              Row() {\n                if (this.loading) {\n                  LoadingProgress()\n                    .color('#ffffff')\n                    .width(vp2vp(24))\n                    .height(vp2vp(24))\n                    .margin({ right: vp2vp(10) })\n                }\n                Text('\u7ACB\u5373\u767B\u5F55').fontColor('#ffffff')\n              }\n            }\n            .width('100%')\n            .backgroundColor('transparent')\n            .stateEffect(false)\n            .borderRadius(vp2vp(4))\n            .height(vp2vp(44))\n            .linearGradient({\n              direction: GradientDirection.Right,\n              colors: [['#fc9c1c', 0], ['#fa711d', 1]]\n            })\n          }\n          .padding(vp2vp(30))\n\n          Column() {\n            Text('\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F')\n              .fontSize(vp2vp(14))\n              .fontColor($r('app.color.gray'))\n          }\n          .padding({ top: vp2vp(70), bottom: vp2vp(100) })\n        }\n      }\n    }\n    .titleMode(NavigationTitleMode.Mini)\n    .mode(NavigationMode.Stack)\n  }\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"4-\u767B\u5F55-\u9875\u9762\u903B\u8F91",children:["4. \u767B\u5F55-\u9875\u9762\u903B\u8F91",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#4-\u767B\u5F55-\u9875\u9762\u903B\u8F91",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u63A7\u5236\u6309\u94AE\uFF0C\u7981\u7528|\u542F\u7528\u72B6\u6001\uFF0C\u70B9\u51FB\u4E8B\u4EF6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/Index.ets"',children:"Button({ type: ButtonType.Normal }) {\n  Row() {\n    if (this.loading) {\n      LoadingProgress()\n        .color('#ffffff')\n        .width(vp2vp(24))\n        .height(vp2vp(24))\n        .margin({ right: vp2vp(10) })\n    }\n    Text('\u7ACB\u5373\u767B\u5F55')\n      .fontColor('#ffffff')\n  }\n}\n.width('100%')\n.backgroundColor('transparent')\n.borderRadius(vp2vp(4))\n.height(vp2vp(44))\n.stateEffect(false)\n.linearGradient({\n  direction: GradientDirection.Right,\n  colors: [['#fc9c1c', 0], ['#fa711d', 1]]\n})\n.enabled(!this.loading)\n.onClick(() => {\n  this.login()\n})\n"})}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u5B9E\u73B0\u767B\u5F55\uFF0C\u975E\u7A7A\u6821\u9A8C\u3001\u767B\u5F55\u8DF3\u8F6C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/LoginPage.ets"',children:"login() {\n  if (!this.username) {\n    return promptAction.showToast({ message: '\u8BF7\u8F93\u5165\u7528\u6237\u540D' })\n  }\n  if (!this.password) {\n    return promptAction.showToast({ message: '\u8BF7\u8F93\u5165\u5BC6\u7801' })\n  }\n  if (!this.isAgree) {\n    return promptAction.showToast({ message: '\u8BF7\u52FE\u9009\u5DF2\u9605\u8BFB\u5E76\u540C\u610F' })\n  }\n\n  this.loading = true\n  Request.post<UserModel>('login', {\n    username: this.username,\n    password: this.password\n  }).then(res => {\n    Auth.setUser(res.data)\n\n    const params = router.getParams()\n    if (params && params['return_url']) {\n      const url = params['return_url']\n      delete params['return_url']\n      router.replaceUrl({ url, params })\n    } else {\n      router.back()\n    }\n    this.loading = false\n    return promptAction.showToast({ message: '\u767B\u5F55\u6210\u529F' })\n  }).catch(e => {\n    this.loading = false\n    return promptAction.showToast({ message: '\u767B\u5F55\u5931\u8D25' })\n  })\n\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"5-\u6211\u7684-\u9000\u51FA\u767B\u5F55",children:["5. \u6211\u7684-\u9000\u51FA\u767B\u5F55",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#5-\u6211\u7684-\u9000\u51FA\u767B\u5F55",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u9000\u51FA\u767B\u5F55"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/Mine.ets"',children:"if (this.user.token) {\n  this.CellBuilder('\u9000\u51FA\u767B\u5F55', async () => {\n    const ok = await promptAction.showDialog({\n      title: '\u6E29\u99A8\u63D0\u793A',\n      message: '\u60A8\u786E\u8BA4\u8981\u9000\u51FA\u9762\u8BD5\u5B9D\u5178APP\u5417\uFF1F',\n      buttons: [\n        { text: '\u53D6\u6D88', color: '#c3c4c5' },\n        { text: '\u786E\u8BA4', color: '#333333', }\n      ]\n    })\n    if (ok.index === 1) {\n      Auth.delUser()\n    }\n  })\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["2\uFF09\u9000\u51FA\u548C\u767B\u5F55\uFF0C\u4F7F\u7528 ",(0,i.jsx)(e.code,{children:"emitter"})," \u901A\u77E5 ",(0,i.jsx)(e.code,{children:"Home"})," \u66F4\u65B0\u9875\u9762"]}),"\n",(0,i.jsx)(e.p,{children:"\u57FA\u672C\u8BED\u6CD5\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"on(event: InnerEvent, callback: Callback<EventData>): void\n\nemit(event: InnerEvent, data?: EventData): void\n\ninterface InnerEvent {\n  eventId: number\n}\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Home \u6CE8\u518C\u4E8B\u4EF6"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Home.ets"',children:"aboutToAppear() {\n  this.getQuestionTypeList()\n\n  emitter.on(LOGIN_EVENT, () => this.getQuestionTypeList())\n}\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u767B\u5F55\u89E6\u53D1\u4E8B\u4EF6"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/LoginPage.ets"',children:"Auth.setUser(res.data)\n// \u901A\u77E5 Home \u66F4\u65B0\u9875\u9762\nemitter.emit(LOGIN_EVENT)\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9000\u51FA\u89E6\u53D1\u4E8B\u4EF6"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Mine.ets"',children:"if (ok.index === 1) {\n  Auth.delUser()\n  // \u901A\u77E5 Home \u66F4\u65B0\u9875\u9762\n  emitter.emit(LOGIN_EVENT)\n}\n"})}),"\n",(0,i.jsxs)(e.h2,{id:"\u6253\u5361\u65E5\u5386",children:["\u6253\u5361\u65E5\u5386",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u6253\u5361\u65E5\u5386",children:"#"})]}),"\n",(0,i.jsxs)(e.h3,{id:"1-\u5B9E\u73B0\u6253\u5361",children:["1. \u5B9E\u73B0\u6253\u5361",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#1-\u5B9E\u73B0\u6253\u5361",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u9996\u9875\u6253\u5F00\u6570\u91CF\u663E\u793A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'tilte="views/Index/Home.ets"',children:"  @StorageProp(USER_KEY)\n  @Watch('updateUser')\n  userJson: string = '{}'\n  @State\n  user: UserModel = JSON.parse(this.userJson)\n\n  updateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-diff",meta:'tilte="views/Index/Home.ets"',children:"      Row({ space: vp2vp(10) }) {\n        IvSearch()\n+        IvClock({ clockCount: this.user.clockinNumbers || 0 })\n      }\n"})}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u6253\u5361\u529F\u80FD\u5B9E\u73B0"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'tilte="common/components/IvClock.ets"',children:".onClick(() => {\n  const user = Auth.getUser()\n  if (user.token) {\n    if (user.clockinNumbers > 0) {\n      // \u8DF3\u8F6C\u6253\u5361\u65E5\u5386\u9875\u9762\n      return router.pushUrl({ url: 'pages/ClockPage' })\n    } else {\n      // \u8FDB\u884C\u6253\u5361\n      Request.post<{ clockinNumbers: number }>('clockin').then(res => {\n        Auth.setUser({ ...user, clockinNumbers: res.data.clockinNumbers })\n        promptAction.showToast({ message: '\u6253\u5361\u6210\u529F' })\n      })\n    }\n  } else {\n    router.pushUrl({ url: 'pages/LoginPage' })\n  }\n})\n"})}),"\n",(0,i.jsx)(e.p,{children:"3\uFF09\u66F4\u65B0\u6253\u5361\u4FE1\u606F\uFF08\u7528\u6237\u4FE1\u606F\uFF09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'tilte="views/Index/Mine.ets"',children:"\n// \u83B7\u53D6\u7528\u6237\u4FE1\u606F\naboutToAppear(){\n  if (this.user.token) {\n    Request.get<UserModel>('userInfo')\n      .then(res => {\n        const { avatar, nickName, clockinNumbers, totalTime } = res.data\n        Auth.setUser({ ...this.user, avatar, nickName, clockinNumbers, totalTime })\n      })\n  }\n}\n\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"2-\u6253\u5361\u65E5\u5386-\u9875\u9762\u7ED3\u6784",children:["2. \u6253\u5361\u65E5\u5386-\u9875\u9762\u7ED3\u6784",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#2-\u6253\u5361\u65E5\u5386-\u9875\u9762\u7ED3\u6784",children:"#"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ClockPage.ets"',children:"import { vp2vp } from '../common/utils/Basic'\n\n@Entry\n@Component\nstruct ClockPage {\n  @Builder\n  dayBuilder(params: {\n    day: number,\n    text: string\n  }) {\n    Column() {\n      Row() {\n        Text(params.day.toString())\n          .fontSize(vp2vp(40))\n          .fontWeight(FontWeight.Bold)\n        Text('\u5929')\n          .fontSize(vp2vp(10))\n          .fontColor($r('app.color.gray'))\n          .margin({ bottom: vp2vp(8), left: vp2vp(10) })\n      }\n      .alignItems(VerticalAlign.Bottom)\n\n      Text(params.text)\n        .fontSize(vp2vp(10))\n        .fontColor($r('app.color.gray'))\n    }.margin({ right: vp2vp(36) })\n  }\n\n  build() {\n    Column() {\n      Navigation() {\n        Column() {\n          Row() {\n            Text('\u4ECA\u65E5\u5DF2\u6253\u5361')\n              .fontSize(vp2vp(20))\n              .margin({ right: vp2vp(5) })\n            Image($r('app.media.icon_clock_card'))\n              .width(vp2vp(20))\n              .aspectRatio(1)\n              .objectFit(ImageFit.Fill)\n          }\n          .width('100%')\n\n          Row() {\n            this.dayBuilder({ day: 10, text: '\u7D2F\u8BA1\u6253\u5361' })\n            this.dayBuilder({ day: 10, text: '\u8FDE\u7EED\u6253\u5361' })\n          }\n          .padding({ top: vp2vp(10), bottom: vp2vp(25) })\n          .width('100%')\n          .justifyContent(FlexAlign.Start)\n\n          Row() {\n\n          }\n          .height(300)\n          .margin({ bottom: vp2vp(50) })\n\n          Image('/common/images/clock_btn.png')\n            .width(vp2vp(145))\n            .height(vp2vp(38))\n            .objectFit(ImageFit.Fill)\n\n        }\n        .padding(vp2vp(15))\n        .layoutWeight(1)\n      }\n      .title('\u6BCF\u65E5\u6253\u5361')\n      .titleMode(NavigationTitleMode.Mini)\n      .mode(NavigationMode.Stack)\n      .backgroundImage('/common/images/clock_bg.png')\n      .backgroundImageSize(ImageSize.Contain)\n      .backgroundImagePosition(Alignment.Top)\n    }.backgroundColor($r('app.color.gray_bg'))\n  }\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"3-\u6253\u5361\u65E5\u5386-\u7B2C\u4E09\u65B9\u5E93",children:["3. \u6253\u5361\u65E5\u5386-\u7B2C\u4E09\u65B9\u5E93",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#3-\u6253\u5361\u65E5\u5386-\u7B2C\u4E09\u65B9\u5E93",children:"#"})]}),"\n",(0,i.jsxs)(e.p,{children:["1\uFF09\u65B9\u5F0F1\uFF1A\u4F7F\u7528 ohmp \u547D\u4EE4\u884C\uFF0C\u53C2\u8003\uFF1A",(0,i.jsx)(e.a,{href:"https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/ide-command-line-ohpm-0000001490235312-V3",target:"_blank",rel:"noopener noreferrer",children:"\u94FE\u63A5"})]}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u65B9\u5F0F2\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",meta:'title="entry/oh-package.json5"',children:'  "dependencies": {\n    "dayjs": "latest"\n  }\n'})}),"\n",(0,i.jsx)("img",{src:s,width:"400"}),"\n",(0,i.jsxs)(e.p,{children:["3\uFF09\u67E5\u627E\u652F\u6301\u7684\u7B2C\u4E09\u65B9\u5305 ",(0,i.jsx)(e.a,{href:"https://ohpm.openharmony.cn/",target:"_blank",rel:"noopener noreferrer",children:"\u94FE\u63A5"})]}),"\n",(0,i.jsxs)(e.h3,{id:"4-\u6253\u5361\u65E5\u5386-\u5171\u4EAB\u65E5\u5386\u672C\u5730\u5E93",children:["4. \u6253\u5361\u65E5\u5386-\u5171\u4EAB\u65E5\u5386\u672C\u5730\u5E93",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#4-\u6253\u5361\u65E5\u5386-\u5171\u4EAB\u65E5\u5386\u672C\u5730\u5E93",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u521B\u5EFA\u672C\u5730\u5305"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u6A21\u5757"}),"\n"]}),"\n",(0,i.jsx)("img",{src:o,width:"600"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5305\u540D\u79F0 miniCalendar"}),"\n"]}),"\n",(0,i.jsx)("img",{src:r,width:"600"}),"\n",(0,i.jsxs)(e.p,{children:["2\uFF09\u4FEE\u6539\u65E5\u5386\u6587\u4EF6\uFF0C\u540D\u79F0 ",(0,i.jsx)(e.code,{children:"MainPage.ets"})," \u6539\u6210 ",(0,i.jsx)(e.code,{children:"MiniCalendar.ets"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="miniCalendar/src/main/ets/components/mainpage/MiniCalendar.ets"',children:"import dayjs from 'dayjs'\nimport display from '@ohos.display'\nimport deviceInfo from '@ohos.deviceInfo'\n\n// \u8BBE\u8BA1\u7A3F\u5BBD\u5EA6\nconst designWidth = 375\n// \u7269\u7406\u50CF\u7D20\nconst devicePhysics = display.getDefaultDisplaySync().width\n\nexport const vp2vp = (originSize: number) => {\n  // useSize =  deviceWidth / designWidth * measureSize\n  // \u53EA\u6709 \u624B\u673A \u624D\u9700\u8981\n  // if (deviceInfo.deviceType !== 'tablet') {\n  //   return px2vp(devicePhysics) / designWidth * originSize\n  // }\n  return originSize\n}\n\nconst img = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABECAYAAAA4E5OyAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAF5SURBVHgB7drLUcMwFIXhGzvOMKwoJXSAO0gJ0BkdECoQJaQT2II1MTo8NiZsmLm6R+R8mzjJIuN/Yo0tyUxERERERERE/rmVOUopXa3Xm4dyeFN+ap/z6904ji9GrDNHfT/s7CMGzLsSJyGSEXMNMs+2PPktexTXIMfjdF9eDouPqaO4jiHwNY6kcrhdfHXI+W1kG1Pcg0BLUaoEgVaiVAsCLUSpGgTYo1QPAsxRQoIAa5SwIMAYJTQIsEUJDwJMUSiCAEsUmiDAEIUqCERHoQsCkVFcH///CieME7cTUwddN9yaI8og31Yn/r993z+bI8oguGSGYZPKjNuPS2aaLh7NEeWg+luMnC/L1XR9PoNqdAygujGLjgE0t+4MMYDi4Y4lBoQ//jPFgNAJIrYYEDaFyBgDQiaZWWNA9WUI5hhQdaGKPQZUW8psIQZUWexuJQa47yBqKQa47yBqKQbU3kFEHQNq7CDaf76bn9hjiIiIiIiIiMhZeAeOPE1Nm7TnTQAAAABJRU5ErkJggg=='\n\nclass DayItem {\n  public date: number\n  public month: number\n  public year: number\n  public isSelected?: boolean\n}\n\n@Component\nexport struct MiniCalendar {\n  // \u5185\u90E8\u5C5E\u6027\n  private weeks: string[] = ['\u65E5', '\u4E00', '\u4E8C', '\u4E09', '\u56DB', '\u4E94', '\u516D']\n  private selectedText: string = '\u5DF2\u6253\u5361'\n  private format: string = 'YYYY-MM-DD'\n  // \u5F53\u524D\u65F6\u95F4\n  @Prop\n  @Watch('onCurrentDateUpdate')\n  currentDate: string\n  // \u9009\u4E2D\u65F6\u95F4\n  @Link\n  @Watch('onCurrentDateUpdate')\n  selectedDays: string[]\n  @State\n  days: DayItem[] = []\n  onClickDate: (date: string) => void\n  onChangeMonth: (date: string) => void\n\n  onCurrentDateUpdate() {\n    this.days = this.getDays(this.currentDate)\n  }\n\n  aboutToAppear() {\n    this.days = this.getDays(this.currentDate)\n  }\n\n  getDays(originDate?: string) {\n    const date = originDate ? dayjs(originDate) : dayjs()\n    const days: DayItem[] = []\n    const len = 42\n\n    // \u5F53\u524D\u6708\n    const currDays = date.daysInMonth()\n    for (let index = 1; index <= currDays; index++) {\n      days.push({\n        date: index,\n        month: date.month() + 1,\n        year: date.year(),\n        isSelected: this.selectedDays.some(item => date.date(index).isSame(item))\n      })\n    }\n    // \u4E0A\u4E2A\u6708\n    const prevMonth = date.date(0)\n    const prevMonthLastDate = prevMonth.date()\n    const prevDays = prevMonth.day()\n    if (prevDays < 6) {\n      for (let index = 0; index <= prevDays; index++) {\n        days.unshift({\n          date: prevMonthLastDate - index,\n          month: prevMonth.month() + 1,\n          year: prevMonth.year()\n        })\n      }\n    }\n    // \u4E0B\u4E2A\u6708\n    const nextMonth = date.date(currDays + 1)\n    const start = days.length\n    for (let index = 1; index <= len - start; index++) {\n      days.push({\n        date: index,\n        month: nextMonth.month() + 1,\n        year: nextMonth.year()\n      })\n    }\n\n    return days\n  }\n\n  isTheMonth(month: number) {\n    return dayjs(this.currentDate).month() === month - 1\n  }\n\n  @Styles\n  btnStyle() {\n    .width(vp2vp(20))\n    .height(vp2vp(20))\n    .backgroundColor('#f6f7f9')\n    .borderRadius(vp2vp(4))\n  }\n\n  build() {\n    Column() {\n      Row() {\n        Column() {\n          Image(img)\n            .width(vp2vp(14))\n            .aspectRatio(1)\n            .rotate({ angle: 180 })\n        }\n        .btnStyle()\n        .justifyContent(FlexAlign.Center)\n        .onClick(() => {\n          const date = dayjs(this.currentDate).subtract(1, 'month')\n          this.currentDate = date.format(this.format)\n          this.onChangeMonth && this.onChangeMonth(date.format('YYYY-MM'))\n        })\n\n        Text(dayjs(this.currentDate).format('YYYY\u5E74MM\u6708'))\n          .fontColor('#6B7897')\n          .margin({ right: vp2vp(20), left: vp2vp(20) })\n          .width(vp2vp(110))\n          .textAlign(TextAlign.Center)\n\n        Column() {\n          Image(img)\n            .width(vp2vp(14))\n            .aspectRatio(1)\n        }\n        .btnStyle()\n        .justifyContent(FlexAlign.Center)\n        .onClick(() => {\n          const date = dayjs(this.currentDate).add(1, 'month')\n          this.currentDate = date.format(this.format)\n          this.onChangeMonth && this.onChangeMonth(date.format('YYYY-MM'))\n        })\n      }\n      .padding(15)\n\n      GridRow({ columns: 7 }) {\n        ForEach(this.weeks, (item) => {\n          GridCol() {\n            Column() {\n              Text(item)\n                .fontColor('#6E7B8A')\n            }\n          }.height(vp2vp(40))\n        })\n        ForEach(this.days, (item: DayItem) => {\n          GridCol() {\n            Column() {\n              if (item.isSelected) {\n                Text(item.date.toString())\n                  .fontColor('#fff')\n                  .width(vp2vp(32))\n                  .height(vp2vp(32))\n                  .borderRadius(vp2vp(16))\n                  .backgroundColor('#FFC531')\n                  .textAlign(TextAlign.Center)\n                  .fontSize(vp2vp(14))\n                Text(this.selectedText)\n                  .fontColor('#FFC531')\n                  .fontSize(vp2vp(10))\n                  .margin({ top: vp2vp(2) })\n\n              } else {\n                Text(item.date.toString())\n                  .width(vp2vp(32))\n                  .height(vp2vp(32))\n                  .fontSize(vp2vp(14))\n                  .textAlign(TextAlign.Center)\n                  .fontColor(this.isTheMonth(item.month) ? '#6E7B8A' : '#E1E4E7')\n              }\n            }.onClick(() => {\n              const date = `${item.year}-${item.month.toString().padStart(2, '0')}-${item.date.toString()\n                .padStart(2, '0')}`\n              this.onClickDate && this.onClickDate(date)\n            })\n          }.height(vp2vp(48))\n        })\n      }\n      .padding({ top: vp2vp(15) })\n      .border({ width: { top: 0.5 }, color: '#f6f7f9' })\n    }\n    .width('100%')\n    .backgroundColor('#fff')\n    .borderRadius(vp2vp(8))\n  }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"3\uFF09\u5BFC\u51FA\u7EC4\u4EF6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="index.ets"',children:"export { MiniCalendar } from './src/main/ets/components/mainpage/MiniCalendar'\n"})}),"\n",(0,i.jsx)(e.p,{children:"4\uFF09\u4F7F\u7528\u7EC4\u4EF6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",meta:'title="entry/oh-package.json5"',children:'  "dependencies": {\n    "@ohos/miniCalendar": "file:../miniCalendar"\n  }\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"import { MiniCalendar } from '@ohos/miniCalendar'\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"            MiniCalendar({\n              currentDate: '2023-12-9',\n              selectedDays: $selectedDays,\n              onChangeMonth: (date: string) => {\n                promptAction.showToast({ message: date })\n              }\n            })\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"3-\u6253\u5361\u65E5\u5386-\u663E\u793A\u7B7E\u5230",children:["3. \u6253\u5361\u65E5\u5386-\u663E\u793A\u7B7E\u5230",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#3-\u6253\u5361\u65E5\u5386-\u663E\u793A\u7B7E\u5230",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u6570\u636E\u6A21\u578B"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="models/ClockModel.ets"',children:"export class ClockModel {\n  flag?: boolean\n  clockinNumbers?: number\n  totalClockinNumber?: number\n  clockins?: ClockInModel[]\n}\n\nexport class ClockInModel {\n  id: string\n  createdAt: string\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u83B7\u53D6\u6570\u636E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ClockPage.ets"',children:"  @State\n  clockData: ClockModel = {\n    totalClockinNumber: 0,\n    clockinNumbers: 0\n  }\n\n  aboutToAppear() {\n    this.getData()\n  }\n\n  async getData(date?: {\n    year: string,\n    month: string\n  }) {\n    const res = await Request.get<ClockModel>('clockinInfo', date || {})\n    this.clockData = res.data\n    this.selectedDays = res.data.clockins.map(item => item.createdAt)\n  }\n"})}),"\n",(0,i.jsx)(e.p,{children:"3\uFF09\u6E32\u67D3\u9875\u9762"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ClockPage.ets"',children:"          Row() {\n            this.dayBuilder({ day: this.clockData.totalClockinNumber, text: '\u7D2F\u8BA1\u6253\u5361' })\n            this.dayBuilder({ day: this.clockData.clockinNumbers, text: '\u8FDE\u7EED\u6253\u5361' })\n          }\n"})}),"\n",(0,i.jsx)(e.p,{children:"4\uFF09\u5207\u6362\u6708\u4EFD\u67E5\u8BE2\u6253\u5361\u6570\u636E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ClockPage.ets"',children:"            MiniCalendar({\n              currentDate: '2023-12-9',\n              selectedDays: $selectedDays,\n              onChangeMonth: (date: string) => {\n                const [year, month] = date.split('-')\n                this.getData({ year, month })\n              }\n            })\n"})}),"\n",(0,i.jsxs)(e.h2,{id:"\u7F16\u8F91\u8D44\u6599",children:["\u7F16\u8F91\u8D44\u6599",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u7F16\u8F91\u8D44\u6599",children:"#"})]}),"\n",(0,i.jsxs)(e.h3,{id:"1-\u8D44\u6599\u9875\u9762",children:["1. \u8D44\u6599\u9875\u9762",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#1-\u8D44\u6599\u9875\u9762",children:"#"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="views/Index/Mine.ets"',children:"            Row() {\n              Text('\u7F16\u8F91\u8D44\u6599')\n                .fontSize(vp2vp(12))\n                .fontColor($r('app.color.gray'))\n              Image($r('app.media.icon_edit'))\n                .width(vp2vp(12))\n                .aspectRatio(1)\n                .fillColor($r('app.color.gray'))\n            }\n            .onClick(() => {\n              router.pushUrl({\n                url: 'pages/ProfilePage'\n              })\n            })\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ProfilePage.ets"',children:"import { USER_KEY } from '../common/utils/Auth'\nimport { vp2vp } from '../common/utils/Basic'\nimport { UserModel } from '../models/UserModel'\n\n@Entry\n@Component\nstruct ProfilePage {\n  @StorageProp(USER_KEY)\n  @Watch('updateUser')\n  userJson: string = '{}'\n  @State\n  user: UserModel = JSON.parse(this.userJson)\n\n  updateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n\n  pickerAvatar() {\n    // TODO\n  }\n\n  updateNickName() {\n    // TODO\n  }\n\n  build() {\n    Navigation() {\n      List() {\n        ListItem() {\n          Row() {\n            Text('\u5934\u50CF')\n            Image(this.user.avatar)\n              .alt('/common/images/avatar.png')\n              .width(vp2vp(40))\n              .aspectRatio(1)\n              .borderRadius(vp2vp(20))\n              .border({ width: 0.5, color: '#e4e4e4' })\n              .onClick(() => {\n                this.pickerAvatar()\n              })\n          }\n          .width('100%')\n          .height(vp2vp(60))\n          .justifyContent(FlexAlign.SpaceBetween)\n        }\n\n        ListItem() {\n          Row() {\n            Text('\u6635\u79F0')\n            TextInput({ text: this.user.nickName })\n              .textAlign(TextAlign.End)\n              .layoutWeight(1)\n              .padding(0)\n              .height(vp2vp(60))\n              .backgroundColor(Color.White)\n              .borderRadius(0)\n              .onChange((value) => this.user.nickName = value)\n              .onSubmit(() => {\n                this.updateNickName()\n              })\n          }\n          .width('100%')\n          .justifyContent(FlexAlign.SpaceBetween)\n        }\n      }\n      .width('100%')\n      .height('100%')\n      .padding({ left: vp2vp(30), right: vp2vp(30), top: vp2vp(15), bottom: vp2vp(15) })\n      .divider({ strokeWidth: 0.5, color: '#f5f5f5' })\n    }\n    .title('\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F')\n    .titleMode(NavigationTitleMode.Mini)\n    .mode(NavigationMode.Stack)\n  }\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"2-\u4FEE\u6539\u6635\u79F0",children:["2. \u4FEE\u6539\u6635\u79F0",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#2-\u4FEE\u6539\u6635\u79F0",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u5B9E\u73B0\u66F4\u65B0"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"  updateNickName() {\n    Request.put('userInfo/profile', {\n      nickName: this.user.nickName\n    }).then(res => {\n      promptAction.showToast({ message: '\u66F4\u65B0\u6635\u79F0\u6210\u529F' })\n      Auth.setUser(this.user)\n    })\n  }\n"})}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u81EA\u5B9A\u4E49\u5F39\u7A97"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="common/components/IvLoadingDialog.ets"',children:"import { vp2vp } from '../utils/Basic'\n\n@CustomDialog\nexport struct IvLoadingDialog {\n  message: string = ''\n  controller: CustomDialogController\n\n  build() {\n    Column() {\n      LoadingProgress()\n        .width(vp2vp(48))\n        .aspectRatio(1)\n        .color('#fff')\n      if (this.message) {\n        Text(this.message)\n          .fontSize(vp2vp(14))\n          .fontColor('#fff')\n      }\n    }\n    .width(vp2vp(120))\n    .aspectRatio(1)\n    .backgroundColor('rgba(0,0,0,0.5)')\n    .borderRadius(vp2vp(16))\n    .justifyContent(FlexAlign.Center)\n  }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"3\uFF09\u521D\u59CB\u5316\u52A0\u8F7D\u6846"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ProfilePage.ets"',children:"  dialog: CustomDialogController = new CustomDialogController({\n    builder: IvLoadingDialog({ message: '\u66F4\u65B0\u4E2D...' }),\n    customStyle: true,\n\n  })\n\n  updateNickName() {\n  this.dialog.open()\n  Request.post('userInfo/profile', {\n    nickName: this.user.nickName\n  }).then(res => {\n    Auth.setUser(this.user)\n    this.dialog.close()\n  })\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"3-\u4FEE\u6539\u5934\u50CF",children:["3. \u4FEE\u6539\u5934\u50CF",(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#3-\u4FEE\u6539\u5934\u50CF",children:"#"})]}),"\n",(0,i.jsx)(e.p,{children:"1\uFF09\u9009\u62E9\u6587\u4EF6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ProfilePage.ets"',children:"URI: string = null\n\npickerAvatar() {\n  const photoSelectOptions = new picker.PhotoSelectOptions()\n  photoSelectOptions.MIMEType = picker.PhotoViewMIMETypes.IMAGE_TYPE\n  photoSelectOptions.maxSelectNumber = 1\n\n  const photoViewPicker = new picker.PhotoViewPicker()\n  photoViewPicker.select(photoSelectOptions).then(result => {\n    // 1. \u5F97\u5230\u6587\u4EF6\u8DEF\u5F84\n    this.URI = result.photoUris[0]\n    this.uploadAvatar()\n  })\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"2\uFF09\u4E0A\u4F20\u56FE\u7247"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ProfilePage.ets"',children:"uploadAvatar() {\n  this.dialog.open()\n\n  const context = getContext(this)\n  const fileType = 'jpg'\n  const fileName = Date.now() + '.' + fileType\n  const copyFilePath = context.cacheDir + '/' + fileName\n\n  const file = fs.openSync(this.URI, fs.OpenMode.READ_ONLY)\n  fs.copyFileSync(file.fd, copyFilePath)\n\n  const config: request.UploadConfig = {\n    url: BaseURL + 'userInfo/avatar',\n    method: 'POST',\n    header: {\n      'Accept': '*/*',\n      'Authorization': `Bearer ${this.user.token}`,\n      'Content-Type': 'multipart/form-data'\n    },\n    files: [\n      { name: 'file', uri: `internal://cache/` + fileName, type: fileType, filename: fileName }\n    ],\n    data: []\n  }\n\n  request.uploadFile(context, config, (err, data) => {\n    if (err) return Logger.error('UPLOAD', err.message)\n    data.on('progress', (size) => {\n      Logger.info(size.toString())\n    })\n    data.on('complete', () => {\n      this.getUserInfo()\n    })\n  })\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"3\uFF09\u66F4\u65B0\u6570\u636E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",meta:'title="pages/ProfilePage.ets"',children:"getUserInfo () {\n  Request.get<{ avatar: string }>('userInfo').then(res => {\n    this.user.avatar = res.data.avatar\n    Auth.setUser(this.user)\n    this.dialog.close()\n  })\n}\n"})})]})}function p(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,a.useMDXComponents)(),n.components);return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}var d=p;p.__RSPRESS_PAGE_META={},p.__RSPRESS_PAGE_META["project%2Fmine.mdx"]={toc:[{text:"\u4E2A\u4EBA\u4E2D\u5FC3",id:"\u4E2A\u4EBA\u4E2D\u5FC3",depth:2},{text:"1. \u6211\u7684-\u9875\u9762\u7ED3\u6784",id:"1-\u6211\u7684-\u9875\u9762\u7ED3\u6784",depth:3},{text:"2. \u6211\u7684-\u9875\u9762\u903B\u8F91",id:"2-\u6211\u7684-\u9875\u9762\u903B\u8F91",depth:3},{text:"3. \u767B\u5F55-\u9875\u9762\u7ED3\u6784",id:"3-\u767B\u5F55-\u9875\u9762\u7ED3\u6784",depth:3},{text:"4. \u767B\u5F55-\u9875\u9762\u903B\u8F91",id:"4-\u767B\u5F55-\u9875\u9762\u903B\u8F91",depth:3},{text:"5. \u6211\u7684-\u9000\u51FA\u767B\u5F55",id:"5-\u6211\u7684-\u9000\u51FA\u767B\u5F55",depth:3},{text:"\u6253\u5361\u65E5\u5386",id:"\u6253\u5361\u65E5\u5386",depth:2},{text:"1. \u5B9E\u73B0\u6253\u5361",id:"1-\u5B9E\u73B0\u6253\u5361",depth:3},{text:"2. \u6253\u5361\u65E5\u5386-\u9875\u9762\u7ED3\u6784",id:"2-\u6253\u5361\u65E5\u5386-\u9875\u9762\u7ED3\u6784",depth:3},{text:"3. \u6253\u5361\u65E5\u5386-\u7B2C\u4E09\u65B9\u5E93",id:"3-\u6253\u5361\u65E5\u5386-\u7B2C\u4E09\u65B9\u5E93",depth:3},{text:"4. \u6253\u5361\u65E5\u5386-\u5171\u4EAB\u65E5\u5386\u672C\u5730\u5E93",id:"4-\u6253\u5361\u65E5\u5386-\u5171\u4EAB\u65E5\u5386\u672C\u5730\u5E93",depth:3},{text:"3. \u6253\u5361\u65E5\u5386-\u663E\u793A\u7B7E\u5230",id:"3-\u6253\u5361\u65E5\u5386-\u663E\u793A\u7B7E\u5230",depth:3},{text:"\u7F16\u8F91\u8D44\u6599",id:"\u7F16\u8F91\u8D44\u6599",depth:2},{text:"1. \u8D44\u6599\u9875\u9762",id:"1-\u8D44\u6599\u9875\u9762",depth:3},{text:"2. \u4FEE\u6539\u6635\u79F0",id:"2-\u4FEE\u6539\u6635\u79F0",depth:3},{text:"3. \u4FEE\u6539\u5934\u50CF",id:"3-\u4FEE\u6539\u5934\u50CF",depth:3}],title:"\u9762\u8BD5\u5B9D\u5178APP-\u6211\u7684\u6A21\u5757",frontmatter:{title:"HM - \u9762\u8BD5\u5B9D\u5178APP-\u6211\u7684\u6A21\u5757"}}}}]);