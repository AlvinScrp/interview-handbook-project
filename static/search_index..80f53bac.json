[{"id":0,"title":"HM - 鸿蒙-应用程序开发","routePath":"/interview-handbook-project/guide/app","lang":"","toc":[{"text":"路由与生命周期","id":"路由与生命周期","depth":2,"charIndex":3},{"text":"1. 路由-常用API","id":"1-路由-常用api","depth":3,"charIndex":14},{"text":"2. 路由-参数传递","id":"2-路由-参数传递","depth":3,"charIndex":1133},{"text":"3. UIAbility-生命周期","id":"3-uiability-生命周期","depth":3,"charIndex":2107},{"text":"4. 组件-生命周期","id":"4-组件-生命周期","depth":3,"charIndex":2661},{"text":"5. UIAbility跳转","id":"5-uiability跳转","depth":3,"charIndex":3130},{"text":"使用动画","id":"使用动画","depth":2,"charIndex":3668},{"text":"1. 属性动画","id":"1-属性动画","depth":3,"charIndex":3676},{"text":"2. 显示动画","id":"2-显示动画","depth":3,"charIndex":4485},{"text":"3. 元素共享转场","id":"3-元素共享转场","depth":3,"charIndex":5037},{"text":"4. 拖动手势-阻尼和磁吸","id":"4-拖动手势-阻尼和磁吸","depth":3,"charIndex":6127},{"text":"系统能力","id":"系统能力","depth":2,"charIndex":8224},{"text":"1. 数据管理-用户首选项","id":"1-数据管理-用户首选项","depth":3,"charIndex":8232},{"text":"2. 绘画能力-画布组件","id":"2-绘画能力-画布组件","depth":3,"charIndex":10464},{"text":"3. 公共事件与通知-通知管理","id":"3-公共事件与通知-通知管理","depth":3,"charIndex":12218},{"text":"4. 后台任务-后台代理提醒","id":"4-后台任务-后台代理提醒","depth":3,"charIndex":13791}],"domain":"","content":"#\n\n\n路由与生命周期#\n\n\n1. 路由-常用API#\n\n> 如何新建页面，如何跳转和回退操作\n\n1）新建页面\n\n@Entry\n@Component\nstruct DetailPage {\n  build() {\n    Column({ space: 15 }) {\n      Text('Detail Page')\n        .fontSize(40)\n      Button('Back')\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n{\n  \"src\": [\n    \"pages/Index\",\n+    \"pages/DetailPage\"\n  ]\n}\n\n\nTIP\n * 手动新建一个页面（ets）文件，需要在 main_pages.json 中手动配置\n * 可以自动创建\n\n2）跳转与后退 API\n\n * 跳转 router.pushUrl()\n * 后退 router.back()\n * 替换跳转 router.replaceUrl()\n\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Column({ space: 15 }) {\n      Text('Index Page')\n        .fontSize(40)\n      Button('Jump To Detail Page')\n        .onClick(() => {\n          // 1. 跳转，压入页面栈顶部\n          // router.pushUrl({\n          //   url: 'pages/DetailPage'\n          // })\n\n          // 2. 跳转，替换当前页面栈\n          // router.replaceUrl({\n          //   url: 'pages/DetailPage'\n          // })\n\n          // 3. 返回\n          // router.back()\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\nTIP\n * 页面栈的最大容量为32个页面。如果超过这个限制，可以调用 router.clear() 方法清空历史页面栈，释放内存空间。\n\n\n2. 路由-参数传递#\n\n> 页面参数传递和获取\n\n1）传参\n\n\n\nclass User {\n  name: string\n  age: number\n}\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  user: User = {\n    name: 'jack',\n    age: 18\n  }\n\n  build() {\n    Column({ space: 15 }) {\n      Text('Index Page')\n        .fontSize(40)\n      Button('Jump To Detail Page')\n        .onClick(() => {\n          router.pushUrl({\n            url: 'pages/DetailPage',\n            params: this.user\n          })\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n2）获取\n\n\n\n@Entry\n@Component\nstruct DetailPage {\n\n  aboutToAppear() {\n    const params = router.getParams()\n    promptAction.showToast({ message: params['name'] + params['age'] })\n  }\n\n  build() {\n    Column({ space: 15 }) {\n      Text('Detail Page')\n        .fontSize(40)\n      Button('Back')\n        .onClick(() => {\n          router.back()\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n3. UIAbility-生命周期#\n\n> 当用户打开、切换和返回到对应应用时，应用中的UIAbility实例会在其生命周期的不同状态之间转换。\n\n 1. UIAbility实例创建完成时触发，系统会调用 onCreate() 回调。\n    \n    * 可以在该回调中进行应用初始化操作，例如变量定义资源加载等，用于后续的UI界面展示。\n\n 2. onForeground() 回调，在 UIAbility 的UI界面可见之前，如 UIAbility 切换至前台时触发。\n    \n    * 可以在 onForeground() 回调中申请系统需要的资源，或者重新申请在 onBackground() 中释放的资源。\n\n 3. onBackground() 回调，在 UIAbility 的UI界面完全不可见之后，如 UIAbility 切换至后台时候触发。\n    \n    * 可以在 onBackground() 回调中释放UI界面不可见时无用的资源，或者在此回调中执行较为耗时的操作，例如状态保存等\n\n 4. Destroy 状态在 UIAbility 实例销毁时触发，系统会调用 onDestroy() 回调。\n    \n    * 可以在该回调中进行系统资源的释放、数据的保存等操作。\n\n\n4. 组件-生命周期#\n\n1）任何组件\n\naboutToAppear\n\n * aboutToAppear 函数在创建自定义组件的新实例后，在执行其 build 函数之前执行。\n * 允许在 aboutToAppear 函数中改变状态变量，更改将在后续执行 build 函数中生效。\n\naboutToDisappear\n\n * aboutToDisappear 函数在自定义组件析构销毁之前执行。\n\n * 不允许在 aboutToDisappear 函数中改变状态变量，特别是 @Link 变量的修改可能会导致应用程序行为不稳定。\n\n2）仅页面 @Entry 组件\n\nonPageShow\n\n * 页面每次显示时触发一次，包括路由过程、应用进入前后台等场景，仅 @Entry 修饰的自定义组件生效。\n\nonPageHide\n\n * 页面每次隐藏时触发一次，包括路由过程、应用进入前后台等场景，仅 @Entry 修饰的自定义组件生效。\n\nonBackPress\n\n * 当用户点击返回按钮时触发，仅 @Entry 修饰的自定义组件生效。\n\n\n5. UIAbility跳转#\n\n> UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互\n\n * UIAbility组件是系统调度的基本单元，为应用提供绘制界面的窗口；\n * 一个UIAbility组件中可以通过多个页面来实现一个功能模块；\n * 每一个UIAbility组件实例，都对应于一个最近任务列表中的任务。\n\nButton('Jump To PayAbility Page')\n  .onClick(() => {\n    const context = getContext(this) as common.UIAbilityContext\n    const want: Want = {\n      bundleName: 'com.itcast.myapplication',\n      abilityName: 'PayAbility'\n    }\n    context.startAbility(want)\n  })\n\n\nButton('Back')\n  .onClick(() => {\n    router.back()\n  })\n\n\nTIP\n * 后续消息通知跳转到应用也需要跳转到对应的 UIAbility 方式类似\n\n\n使用动画#\n\n\n1. 属性动画#\n\n> 组件的某些通用属性变化时，可以通过属性动画实现渐变过渡效果，提升用户体验。\n\n * 支持的属性包括width、height、backgroundColor、opacity、scale、rotate、translate等。\n\n@Entry\n@Component\nstruct Index {\n  @State\n  widthSize: number = 100\n  @State\n  heightSize: number = 40\n\n  build() {\n    Column({ space: 15 }) {\n      Button('元素动画')\n        .width(this.widthSize)\n        .height(this.heightSize)\n        .onClick(() => {\n          this.widthSize = 200\n          this.heightSize = 100\n        })\n        .animation({\n          // 动画时间\n          duration: 1000,\n          // 执行次数\n          iterations: -1,\n          // 动画曲线\n          curve: Curve.Ease,\n          // 延时时间\n          delay: 1000,\n          // 播放模式\n          playMode: PlayMode.Alternate\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n2. 显示动画#\n\n> 提供全局animateTo显式动画接口来指定由于闭包代码导致的状态变化插入过渡动效。\n\n@Entry\n@Component\nstruct Index {\n  @State\n  heightSize: number = 40\n\n  build() {\n    Column() {\n      Text('一级菜单')\n        .height(40)\n        .onClick(() => {\n          animateTo({\n            duration: 200\n          }, () => {\n            this.heightSize = this.heightSize === 40 ? 0 : 40\n          })\n        })\n      Column() {\n        Text('一级菜单')\n          .height(this.heightSize)\n        Text('一级菜单')\n          .height(this.heightSize)\n      }\n    }\n    .backgroundColor('#069')\n  }\n}\n\n\n\n3. 元素共享转场#\n\n> 当路由进行切换时，可以通过设置组件的 sharedTransition 属性将该元素标记为共享元素并设置对应的共享元素转场动效。\n\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Row({ space: 15 }) {\n      Column({ space: 10 }){\n        Image($rawfile('apple.png'))\n          .width('100%')\n          .aspectRatio(1)\n          .sharedTransition('apple', { duration: 500 })\n        Text('鸣春谷 正宗甘肃特产花牛水果苹果 【天水直发】 4.5-5斤中果A(约13-16个)')\n          .sharedTransition('text', { duration: 500 })\n      }\n      .padding(15)\n      .width('50%')\n      .onClick(() => {\n        router.pushUrl({\n          url: 'pages/DetailPage'\n        })\n      })\n    }\n    .width('100%')\n  }\n}\n\n\n@Entry\n@Component\nstruct DetailPage {\n  build() {\n    Column({ space: 15 }) {\n      Column({ space: 10 }){\n        Image($rawfile('apple.png'))\n          .width('100%')\n          .aspectRatio(1)\n          .sharedTransition('apple', { duration: 500 })\n        Text('鸣春谷 正宗甘肃特产花牛水果苹果 【天水直发】 4.5-5斤中果A(约13-16个)')\n          .fontSize(18)\n          .sharedTransition('text', { duration: 500 })\n      }\n      .padding(15)\n    }\n    .height('100%')\n    .width('100%')\n  }\n}\n\n\n\n4. 拖动手势-阻尼和磁吸#\n\n> 拖动手势（PanGesture）\n\n * 拖动手势用于触发拖动手势事件，滑动达到最小滑动距离（默认值为5vp）时拖动手势识别成功。\n\n实现下拉刷新效果：\n\n 1. 使用 Stack 堆叠下拉刷新容器和列表容器\n 2. 使用手势事件 PanGesture 实现拖动列表容器\n 3. 使用 animateTo 实现磁吸动画效果\n 4. 拖动距离超出阀值，模拟开启加载效果，控制文字显示和动画\n\n\n@Entry\n@Component\nstruct Index {\n  @State\n  translateY: number = 0\n  @State\n  text: string = '下拉即可刷新'\n  @State\n  loading: boolean = false\n\n  ease (originValue: number = 0) {\n    const space = 60\n    const damp = 0.3\n    if ( originValue > space ) {\n      return space + ( originValue - space ) * damp\n    }\n    return originValue\n  }\n\n  build() {\n    Stack({ alignContent: Alignment.Top }) {\n      Row() {\n        if (this.loading) {\n          LoadingProgress()\n            .width(32)\n            .aspectRatio(1)\n        }\n        Text(this.text)\n          .fontColor('#999')\n          .width(100)\n      }\n      .height(100)\n\n      List() {\n\n      }\n      .backgroundColor('#fff')\n      .height('100%')\n      .width('100%')\n      .translate({ y: this.translateY })\n      .gesture(\n        PanGesture()\n          .onActionUpdate((event: GestureEvent) => {\n            this.translateY = this.ease(event.offsetY)\n            if ( this.translateY > 100 ) {\n              this.text = '释放立即刷新'\n            }\n          })\n          .onActionEnd((event: GestureEvent) => {\n            if (this.translateY > 100) {\n              this.loading = true\n              this.text = '正在刷新中...'\n              animateTo({ duration: 300 }, () => {\n                this.translateY = 100\n              })\n              // 加载数据\n              setTimeout(() => {\n                this.loading = false\n                this.text = ''\n                animateTo({ duration: 300, onFinish: () => this.text = '下拉即可刷新' }, () => {\n                  this.translateY = 0\n                })\n                promptAction.showToast({ message: '刷新成功' })\n              }, 2000)\n            } else {\n              animateTo({ duration: 300 }, () => {\n                this.translateY = 0\n              })\n            }\n          })\n      )\n    }\n    .height('100%')\n    .width('100%')\n    .backgroundColor('#f3f4f5')\n  }\n}\n\n\n\n系统能力#\n\n\n1. 数据管理-用户首选项#\n\n> 用户首选项为应用提供 Key-Value 键值型的数据处理能力，支持应用持久化轻量级数据，并对其修改和查询。\n\n * Key 键为 string 类型，要求非空且长度不超过 80 个字节。\n * 如果 Value 值为 string 类型，可以为空，不为空时长度不超过 8192 个字节。\n * 内存会随着存储数据量的增大而增大，所以存储的数据量应该是轻量级的，建议存储的数据不超过一万条，否则会在内存方面产生较大的开销。\n\n1）知晓 API 用法\n\n// 获取首选项实例\ngetPreferences(context: Context, name: string): Promise\n\n// 首选项实→获取数据\nget(key: string, defValue: ValueType): Promise\n// 首选项实→设置|修改数据\nput(key: string, value: ValueType): Promise\n// 首选项实→删除数据\ndelete(key: string): Promise\n\n\n\n2）写一个存储用户的工具\n\n\n\nexport class User {\n  name?: string\n  age?: number\n}\n\nexport class UserStore {\n  KEY = 'user-store'\n\n  getStore() {\n    return preferences.getPreferences(getContext(this), 'userStore')\n  }\n\n  async setData(data: User) {\n    const store = await this.getStore()\n    await store.put(this.KEY, JSON.stringify(data))\n    await store.flush()\n  }\n\n  async getData() {\n    const store = await this.getStore()\n    const data = await store.get(this.KEY, '{}') as string\n    return JSON.parse(data) as User\n  }\n\n  async delData() {\n    const store = await this.getStore()\n    await store.delete(this.KEY)\n    await store.flush()\n  }\n\n}\n\n\n\n\n\n@Entry\n@Component\nstruct Index {\n  userStore: UserStore\n  @State\n  user: User = {}\n\n  aboutToAppear() {\n    this.userStore = new UserStore()\n    this.getUser()\n  }\n\n  async getUser () {\n    const user = await this.userStore.getData()\n    this.user = user\n  }\n\n  build() {\n    Column({ space: 15 }) {\n\n      if ( this.user?.name && this.user?.age ) {\n        Text(`${ this.user.name } 今年 ${ this.user.age } 岁`)\n      }\n\n      Button('设置 User')\n        .onClick(async () => {\n          await this.userStore.setData({ name: 'jack', age: 18 })\n          await this.getUser()\n        })\n\n      Button('修改 User')\n        .onClick(async () => {\n          await this.userStore.setData({ name: 'tom', age: 17 })\n          await this.getUser()\n        })\n\n      Button('删除 User')\n        .onClick(async () => {\n          await this.userStore.delData()\n          await this.getUser()\n        })\n\n      Button('换一页')\n        .onClick(() => {\n          router.pushUrl({\n            url: 'pages/DetailPage'\n          })\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n2. 绘画能力-画布组件#\n\n1）了解 画布 基本用法\n\n@Entry\n@Component\nstruct Index{\n\n  // 抗锯齿设置\n  private settings: RenderingContextSettings = new RenderingContextSettings(true)\n  // 画布实例\n  private context: CanvasRenderingContext2D = new CanvasRenderingContext2D(this.settings)\n\n  build() {\n    Column({ space: 15 }) {\n      // 画布组件\n      Canvas(this.context)\n        .width(252)\n        .aspectRatio(1)\n        .backgroundColor('#ccc')\n        .onReady(() => {\n          // 绘制边框盒子\n          this.context.strokeRect(100, 100, 50, 50)\n          // 绘制填充盒子\n          this.context.fillRect(150, 150, 50, 50)\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n2）绘制表盘和秒针\n\n前置知识：\n\n * drawImage(img: ImageBitmap, x, y, w, h) 图片需要 ImageBitmap 格式\n * rotate(angle: number) angle 是弧度，1° = Math.PI / 180，围绕 0 0 中心旋转\n\n@Entry\n@Component\nstruct Index{\n\n  private settings: RenderingContextSettings = new RenderingContextSettings(true)\n  private context: CanvasRenderingContext2D = new CanvasRenderingContext2D(this.settings)\n  private panImg: ImageBitmap = new ImageBitmap('/images/ic_clock_pan.png')\n  private secondImg: ImageBitmap = new ImageBitmap('/images/ic_second_pointer.png')\n\n\n  build() {\n    Column({ space: 15 }) {\n      Canvas(this.context)\n        .width(252)\n        .aspectRatio(1)\n        .onReady(() => {\n          // 参数：图片、绘制原点x坐标、绘制原点y坐标、图片绘制宽度、图片绘制高度\n          this.context.drawImage(this.panImg, 0 ,0 , 252, 252)\n\n          this.context.translate(126, 126)\n          this.context.rotate(Math.PI / 180 * 180)\n          this.context.translate(-126, -126)\n          this.context.drawImage(this.secondImg, 122, 0, 8, 252)\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n3. 公共事件与通知-通知管理#\n\n> 本模块提供通知管理的能力，包括发布、取消发布通知，创建、获取、移除通知通道，获取通知的使能状态、角标使能状态，获取通知的相关信息等。\n\n参考文档 链接\n\n1）发送通知和取消通知\n\n\n\n@Entry\n@Component\nstruct Index {\n  notifyId = 100\n\n  build() {\n    Column({ space: 15 }) {\n      Button('添加通知')\n        .onClick(async () => {\n          const request: notificationManager.NotificationRequest = {\n            id: this.notifyId,\n            content: {\n              contentType: notificationManager.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT,\n              normal: {\n                title: \"温馨提示\",\n                text: \"您的京东快递 100321120341233 快递已经达到北京！\",\n                additionalText: \"物流提醒\"\n              }\n            },\n          }\n          notificationManager.publish(request)\n        })\n      Button('取消通知')\n        .onClick(() => {\n          notificationManager.cancel(this.notifyId)\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\nTIP\n * 运行上面通知如果遇到闪崩现象，告知 Invalid Parameter 的话，请擦除模拟器数据。\n\n2）通知点击唤起应用\n\n\n\n\n// 获取 wantAgent\nconst want = await wantAgent.getWantAgent({\n  wants: [\n    {\n      bundleName: 'com.itcast.myapplication',\n      abilityName: 'EntryAbility'\n    }\n  ],\n  operationType: wantAgent.OperationType.START_ABILITY,\n  requestCode: 0\n})\n\n\nconst request: notificationManager.NotificationRequest = {\n  id: this.notifyId,\n  content: {\n    contentType: notificationManager.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT,\n    normal: {\n      title: \"温馨提示\",\n      text: \"您的京东快递 100321120341233 快递已经达到北京！\",\n      additionalText: \"物流提醒\"\n    }\n  },\n  // 跳转应用\n+  wantAgent: want\n}\n\n\n\n4. 后台任务-后台代理提醒#\n\n> 应用退到后台或进程终止后，仍然有一些提醒用户的定时类任务，\n> \n> 例如购物类应用抢购提醒等，为满足此类功能场景，系统提供了代理提醒（reminderAgentManager）的能力。\n\n参考文档 链接\n\n * 倒计时类：基于倒计时的提醒功能\n * 日历类：基于日历的提醒功能\n * 闹钟类：基于时钟的提醒功能\n\n需要开启 ohos.permission.PUBLISH_AGENT_REMINDER 权限\n\n1）闹铃\n\n\n\n\n@Entry\n@Component\nstruct Index {\n  reminderId = null\n\n  build() {\n    Column({ space: 15 }) {\n      Button('添加闹铃')\n        .onClick(async () => {\n          let targetReminderAgent: reminderAgentManager.ReminderRequestAlarm = {\n            // 提醒类型为闹钟类型\n            reminderType: reminderAgentManager.ReminderType.REMINDER_TYPE_ALARM, \n            // 指明提醒的目标时刻\n            hour: 19, \n            // 指明提醒的目标分钟\n            minute: 57, \n            // 指明每周哪几天需要重复提醒\n            daysOfWeek: [], \n            // 设置弹出的提醒通知信息上显示的按钮类型和标题\n            actionButton: [ \n              {\n                title: '停止',\n                type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_CLOSE\n              },\n            ],\n            // 响铃时长秒\n            ringDuration: 60, \n            // 点击通知跳转的 want\n            wantAgent: {\n              pkgName: 'com.itcast.myapplication',\n              abilityName: 'EntryAbility',\n            },\n          }\n          // 记录id 清理使用\n          this.reminderId = await reminderAgentManager.publishReminder(targetReminderAgent)\n          promptAction.showToast({ message: '添加闹铃成功' })\n        })\n      Button('取消闹铃')\n        .onClick(async () => {\n          // 不能退出应用，否则 this.reminderId 是 null，开发的时候可以持久化\n          await reminderAgentManager.cancelReminder(this.reminderId)\n          promptAction.showToast({ message: '取消闹铃成功' })\n        })\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n","frontmatter":{"title":"HM - 鸿蒙-应用程序开发"},"version":""},{"id":1,"title":"HM - 鸿蒙-组件基础","routePath":"/interview-handbook-project/guide/","lang":"","toc":[{"text":"开发环境","id":"开发环境","depth":2,"charIndex":3},{"text":"1. 起步-鸿蒙简介","id":"1-起步-鸿蒙简介","depth":3,"charIndex":11},{"text":"2. 起步-DevEco Studio","id":"2-起步-deveco-studio","depth":3,"charIndex":510},{"text":"3. 起步-HelloWorld","id":"3-起步-helloworld","depth":3,"charIndex":795},{"text":"4. 起步-效果预览","id":"4-起步-效果预览","depth":3,"charIndex":881},{"text":"5. 起步-工程结构","id":"5-起步-工程结构","depth":3,"charIndex":1580},{"text":"组件基础","id":"组件基础","depth":2,"charIndex":1761},{"text":"1. 组件-什么是ArkTS","id":"1-组件-什么是arkts","depth":3,"charIndex":1769},{"text":"2. 基础-组件结构","id":"2-基础-组件结构","depth":3,"charIndex":2292},{"text":"3. 基础-系统组件(ArkUI)","id":"3-基础-系统组件arkui","depth":3,"charIndex":3131},{"text":"4. 基础-组件状态","id":"4-基础-组件状态","depth":3,"charIndex":3644},{"text":"样式处理","id":"样式处理","depth":2,"charIndex":5093},{"text":"1. 样式-语法(链式&枚举)","id":"1-样式-语法链式枚举","depth":3,"charIndex":5101},{"text":"2. 样式-单位vp和适配","id":"2-样式-单位vp和适配","depth":3,"charIndex":5733},{"text":"2. 样式-@Styles 复用","id":"2-样式-styles-复用","depth":3,"charIndex":8893},{"text":"3. 样式-@Extends 复用","id":"3-样式-extends-复用","depth":3,"charIndex":11412},{"text":"4. 样式-多态","id":"4-样式-多态","depth":3,"charIndex":12355},{"text":"组件状态","id":"组件状态","depth":2,"charIndex":13999},{"text":"1. 状态-class语法","id":"1-状态-class语法","depth":3,"charIndex":14007},{"text":"2. 状态-复杂状态","id":"2-状态-复杂状态","depth":3,"charIndex":15062},{"text":"界面渲染","id":"界面渲染","depth":2,"charIndex":17043},{"text":"1. 渲染-条件渲染","id":"1-渲染-条件渲染","depth":3,"charIndex":17051},{"text":"2. 渲染-循环渲染","id":"2-渲染-循环渲染","depth":3,"charIndex":18318}],"domain":"","content":"#\n\n\n开发环境#\n\n\n1. 起步-鸿蒙简介#\n\n介绍：\n\n * HarmonyOS 是新一代的智能终端操作系统，为不同设备的智能化、互联与协同提供了统一的语言。带来简洁，流畅，连续，安全可靠的全场景交互体验。\n\n历程：\n\n时间       事件\n2019     HarmonyOS 1.0，华为在东莞举行华为开发者大会，正式发布操作系统鸿蒙 OS，主要用于物联网\n2020     HarmonyOS 2.0，基于开源项目 OpenHarmony 开发的面向多种全场景智能设备的商用版本\n2021     HarmonyOS 3.0，先后优化游戏流畅度、地图三维体验、系统安全，另外系统的稳定性也得到了增强\n2023.2   HarmonyOS 3.1，系统纯净能力进一步提升，对后台弹窗、 隐藏应用、后台跳转等情况\n2023.7   华为 Mate 50 系列手机获推 HarmonyOS 4.0\n2024     HarmonyOS Next 即将发布，将不在兼容安卓应用\n\n和我们有什么关系？\n\n * 环境弱行业卷，怎么办？\n * 纯鸿蒙应用开发潮，你跟不跟？\n * 前端技术迁移鸿蒙开发易上手，你学不学？\n\n\n2. 起步-DevEco Studio#\n\n安装 DevEco Studio 编辑器\n\n 1. 下载：https://developer.harmonyos.com/cn/develop/deveco-studio#download\n    * Windows(64-bit)\n    * Mac(X86)\n    * Mac(ARM)\n 2. 安装：DevEco Studio → 一路 Next\n 3. 运行：\n    * 基础安装：Node.js >= 16.9.1 + Install ohpm 鸿蒙包管理器\n    * SDK 安装\n    * 安装完毕\n\n\n3. 起步-HelloWorld#\n\n创建一个空项目:\n\n 1. Create Project\n\n 2. 选择项目模板\n\n 3. 填写项目信息\n\n 4. Finish\n\n\n4. 起步-效果预览#\n\n效果预览方法：\n\n * Previewer 预览模式\n * Local Emulator 本地模拟器\n * Remote Emulator 远程模拟器\n * Remote Device 远程真机\n * Local Device 本地真机\n\n推荐使用\n * Previewer 预览 和 Local Emulator 本地模拟器；\n * 尤其推荐使用 遥遥领先 真机调试；\n\n1）Previewer 预览\n\n> 场景：静态页面（没有组件间数据通信、不涉及到网络请求）\n> \n> 条件：有 @Entry 或 @Preview 装饰器页面\n\n * 预览和审查元素\n\n * 多设备预览\n\n2）Local Emulator 本地模拟器\n\n> 场景：动态页面（几乎全场景，一些无法模拟的硬件功能）\n\n * 新建模拟器\n   \n   一路 Next ...\n\n * 启动模拟器\n\n * 运行项目看效果\n\n * 更改后每次需要（打包 → 卸载 → 安装 → 预览），有没有热更新或者刷新这种预览方式？\n   \n   调试静态页面可以，一旦有了数据变化也需要重启，体验一般~ （学习需要耐心，期待 Next 做的更好~）\n\n其他方式\n * Remote Emulator 远程模拟器\n * Remote Device 远程真机\n * Local Device 本地真机\n\n条件：\n\n * 需要注册华为账号, 点这 https://developer.harmonyos.com/ 然后点击登录页面，去注册吧~\n * 登录之后，需要自动生成签名信息，这个我们后面讲真机调试再给大家演示。\n\n\n5. 起步-工程结构#\n\n> 我们在哪里写代码？\n\nStage 模型\n\n了解App结构关系，等后面我们项目阶段来讲一些工程配置文件作用，现在你要知道：\n\n * entry 是一个 Module 应用包\n\n * entryability 是一个 UIAbility 包含用户界面的应用组件\n\n * pages 是页面\n\n * components 可以是组件\n\n\n组件基础#\n\n\n1. 组件-什么是ArkTS#\n\nArkTS是HarmonyOS优选的主力应用开发语言。ArkTS围绕应用开发在TypeScript（简称TS）生态基础上做了进一步扩展，继承了TS的所有特性，是\nTS的超集。\n\n扩展能力如下：\n\n 1. 基本语法\n    * 定义声明式UI、自定义组件、动态扩展UI元素；\n    * 提供ArkUI系统组件，提供组件事件、方法、属性；\n    * 共同构成 UI 开发主体\n 2. 状态管理\n    * 组件状态、组件数据共享、应用数据共享、设备共享；\n 3. 渲染控制\n    * 条件渲染、循环渲染、数据懒加载；\n\n声明式UI？\n\n问题？通过一段 HTML 标签展示出对应的页面方便，还是使用 document.createElement('tag')创建标签构建页面方便？\n\n * 显然是 HTML , 其实 HTML 本身就是声明式的，通过描述的方式去声明 UI 界面。\n * 一些前端框架也是声明式UI，如 Vue 使用的 tempalte 模板，如 React 使用的 JSX。\n * 在例如现在的 Jetpack Compose SwiftUI Flutter 等APP开发技术也是声明式。\n\n\n2. 基础-组件结构#\n\nArkTS通过装饰器 @Component 和 @Entry 装饰 struct 关键字声明的数据结构，构成一个自定义组件。 自定义组件中提供了一个 build\n函数，开发者需在该函数内以链式调用的方式进行基本的 UI 描述，UI 描述的方法请参考 UI 描述规范。\n\n1）页面组件\n\n@Entry\n@Component\nstruct Index {\n  // 工程默认显示 `Index` 页面组件\n  // build 是声明UI的位置\n  build() {\n    Text('页面组件')\n  }\n}\n\n\n2）自定义组件\n\n\n// 定义 `Footer` 组件\n@Component\nstruct Footer {\n  build() {\n    Text('自定义组件')\n  }\n}\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Column(){\n      // 使用 `Footer` 组件\n      Footer()\n    }\n  }\n}\n\n\n为了更好维护，自定义组件通常会新建一个文件 Footer.ets，通过模块化语法导出导入(默认|按需)使用。\n\n@Component\nexport default struct Footer {\n  build() {\n    Text('自定义组件')\n  }\n}\n\n\n\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Column(){\n      // 使用 `Footer` 组件\n      Footer()\n    }\n  }\n}\n\n\nTIP\n * @Entry @Component 是页面组件，将来需要页面跳转就需要再定义一个页面。\n * @Component 自定义组件，一个页面组件下可以有多个自定义组件。\n * build(){} 只能有一个根元素\n\n\n3. 基础-系统组件(ArkUI)#\n\n常用系统组件 Text Column Row Button TextInput 更多组件\n\n * Text 文本组件\n * Column 列组件，纵向排列，Flex布局主轴是Y\n * Row 行组件，横向向排列，Flex布局主轴是X\n * Button 按钮组件\n * InputText 输入框组件\n\n实现一个简易登录界面：\n\n@Entry\n@Component\nstruct Index {\n\n  build() {\n    Column(){\n      Row(){\n        Text('手机号')\n        TextInput()\n      }\n      Row(){\n        Text('验证码')\n        TextInput()\n      }\n      Row(){\n        Button('重置').backgroundColor('#ccc')\n        Button('登录')\n      }\n    }\n  }\n}\n\n\nTIP\n * ArkUI 组件一般都是 Flex 模式，大部分布局可以由行和列组成。\n\n\n4. 基础-组件状态#\n\n> 如何使用 @State 定义一个状态变量？\n\n1）组件变量，不具备驱动UI更新能力。\n\n@Entry\n@Component\nstruct Index {\n  count = 100\n\n  build() {\n    Text(this.count.toString())\n      .onClick(() => this.count++)\n  }\n}\n\n\n2）状态变量，指驱动UI更新的数据，加上 @State 装饰器即可，注意：加上类型和初始值。\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  count: number = 100\n\n  build() {\n    Text(this.count.toString())\n      .onClick(() => this.count++)\n  }\n}\n\n\nTIP\n * 加上类型和初始值\n * 状态变量不可设置的类型有：any undefined null 与复杂类型的联合类型\n\n其他：\n\n * 绑定事件在系统组件后链式使用 onXxxxx 进行绑定即可\n * 使用 @ohos.promptAction 可以进行轻提示 promptAction.showToast({ message: 'Tip' })\n\n📕📕📕 练习案例→实现登录表单数据收集、重置、模拟提交。\n\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  mobile: string = ''\n  @State\n  code: string = ''\n\n  build() {\n    Column(){\n      Row(){\n        Text('手机号')\n        TextInput({ text: this.mobile })\n          .onChange((value)=>this.mobile = value)\n      }\n      Row(){\n        Text('验证码')\n        TextInput({ text: this.code })\n          .onChange((value)=>this.code = value)\n      }\n      Row(){\n        Button('重置')\n          .backgroundColor('#ccc')\n          .onClick(()=>{\n            this.mobile = ''\n            this.code = ''\n          })\n        Button('登录')\n          .onClick(()=>{\n            if (this.mobile && this.code) {\n              promptAction.showToast({ message: `${this.mobile} 登录成功` })\n            } else {\n              promptAction.showToast({ message: `请输入手机号或验证码` })\n            }\n          })\n      }\n    }\n  }\n}\n\n\n\n样式处理#\n\n\n1. 样式-语法(链式&枚举)#\n\n> ArkTS以声明方式组合和扩展组件来描述应用程序的UI；\n> \n> 同时还提供了基本的属性、事件和子组件配置方法，帮助开发者实现应用交互逻辑。\n\n1）样式属性\n\n * 属性方法以 . 链式调用的方式配置系统组件的样式和其他属性，建议每个属性方法单独写一行。\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Text('演示')\n      .backgroundColor('red')\n      .fontSize(50)\n      .width('100%')\n      .height(100)\n  }\n}\n\n\n2）枚举值\n\n * 对于系统组件，ArkUI还为其属性预定义了一些枚举类型。文档链接\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Text('演示')\n      .fontSize(50)\n      .width('100%')\n      .height(100)\n      .backgroundColor(Color.Blue)\n      .textAlign(TextAlign.Center)\n      .fontColor(Color.White)\n  }\n}\n\n\nTIP\n * 样式相关属性通过链式函数的方式进行设置\n * 如果类型是枚举的，通过枚举传入对应的值\n\n\n2. 样式-单位vp和适配#\n\n> 知道 vp 单位，以及适配思想\n\n1） vp 是什么？virtual pixel\n\n * 屏幕密度相关像素，根据屏幕像素密度转换为屏幕物理像素，当数值不带单位时，默认单位 vp；在实际宽度为1440物理像素的屏幕上，1vp 约等于\n   3px（物理像素）\n\n * 上图的意思是，使用这个单位在不同屏幕物理分辨率的实际尺寸一致(A设备1英寸，B设备1英寸)。\n\n2）之前 vw 、rem 和 rpx 相对于屏幕宽度的单位，可以实现等比例适配，vp 可以吗？\n\n\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Text('演示')\n      .width('100%')\n      .backgroundColor('red')\n      .onAreaChange((oldArea, newArea) => {\n        promptAction.showToast({\n          // 1. onAreaChange改变尺寸后会触发\n          // 2. newArea为现在元素尺寸\n          message: newArea.width.toString()\n        })\n      })\n  }\n}\n\n\n我们发现：不同的设备屏幕的宽度 vp 是不一致的，那怎么适配呢？\n\n3）根据官方的文档，结合自己的理解，采用：伸缩布局，网格系统，栅格系统进行布局适配。\n\n伸缩 layoutWeight(flex: number) 占剩余空间多少份，可以理解成CSS的 flex: 1\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Row(){\n      Text('left')\n        .layoutWeight(1)\n        .backgroundColor('red')\n      Text('right')\n        .layoutWeight(2)\n        .backgroundColor('green')\n    }\n    .width('100%')\n  }\n}\n\n\n等比例，设置元素宽高比 aspectRatio(ratio: number)\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Text('left')\n      .width('50%')\n        // 宽高比例\n      .aspectRatio(1)\n      .backgroundColor('red')\n  }\n}\n\n\nTIP\n * vp 是鸿蒙默认单位，和屏幕像素有关，最终表现视觉大小在任何设备一致\n * 鸿蒙一般以伸缩 layoutWeight、网格、栅格进行布局适配，如要等比例缩放可以设置高宽比 aspectRatio\n\n📕📕📕 练习案例→实现知乎评论回复-评论区域\n\n设计稿一般是1080px：(这里没有设计稿，提供了一些尺寸)\n\n * Nav\n   * 左侧返回按钮24vp高宽背景颜色#f5f5f5，图标12vp尺寸颜色#848484\n   * 标题18vp\n * Comment\n   * 头像尺寸32vp高宽，右侧间距10vp\n   * 标题15vp，颜色默认\n   * 内容16vp，颜色#565656\n   * 底部12vp，颜色#c3c4c5\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Column(){\n      // 导航\n      Row(){\n        Row(){\n          Image($r('app.media.ic_public_arrow_left'))\n            .width(16)\n            .aspectRatio(1)\n            // svg 图标可以使用填充颜色\n            // .fillColor('red')\n        }\n        .width(24)\n        .aspectRatio(1)\n        .backgroundColor('#f5f5f5')\n        .borderRadius(12)\n        .justifyContent(FlexAlign.Center)\n        .margin({ left: 16 })\n\n        Text('评论回复')\n          .layoutWeight(1)\n          .textAlign(TextAlign.Center)\n          .padding({ right: 40 })\n      }\n      .height(40)\n      .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })\n      // 评论\n      Row(){\n        Image($r('app.media.avatar'))\n          .width(32)\n          .aspectRatio(1)\n          .borderRadius(16)\n        Column({ space: 5 }){\n          Text('周杰伦')\n            .width('100%')\n            .fontWeight(FontWeight.Bold)\n            .fontSize(15)\n          Text('大理石能雕刻出肌肉和皮肤的质感，那个年代的工匠好牛啊')\n            .width('100%')\n          Row(){\n            Text('10-21 · IP属地北京')\n              .fontSize(12)\n              .fontColor('#c3c4c5')\n            Row({ space: 4 }){\n              Image($r('app.media.ic_public_heart'))\n                .width(14)\n                .aspectRatio(1)\n                .fillColor('#c3c4c5')\n              Text('100')\n                .fontSize(12)\n                .fontColor('#c3c4c5')\n            }\n          }\n          .width('100%')\n          .justifyContent(FlexAlign.SpaceBetween)\n        }\n        .layoutWeight(1)\n        .padding({ left: 10 })\n      }\n      .padding(15)\n      .alignItems(VerticalAlign.Top)\n    }\n  }\n}\n\n\nTIP\n * 华为官方图标下载 链接\n\n\n2. 样式-@Styles 复用#\n\n> 在开发过程中会出现大量代码在进行重复样式设置，@Styles 可以帮我们进行样式复用\n\n * 当前 @Styles 仅支持 通用属性 和 通用事件。\n * 支持 全局 定义和 组件内 定义，同时存在组件内覆盖全局生效。\n\n// 全局\n@Styles \nfunction functionName() { ... }\n\n@Entry\n@Component\nsturt Index{\n  // 组件内\n  @Styles \n  functionName() { ... }\n\n  build() {\n    Text('Text')\n      .functionName()\n  }\n}\n\n\n需求：文字和按钮相同背景，点击+1\n\n1）全局\n\n@Styles function sameStyle() {\n  .backgroundColor(Color.Green)\n  .onClick(() => {\n    this.count++\n  })\n}\n\n@Entry\n@Component\nstruct Index {\n  @State\n  count: number = 10\n\n  build() {\n    Column() {\n      Text(this.count.toString())\n        .width(100)\n        .height(50)\n        .margin({ bottom: 10 })\n        .textAlign(TextAlign.Center)\n        .sameStyle()\n\n      Button('+1')\n        .sameStyle()\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n2）组件内\n\n@Entry\n@Component\nstruct Index {\n  @State\n  count: number = 10\n\n  // 不需要 `function` 关键字，覆盖全局\n  @Styles\n  sameStyle (){\n    .backgroundColor(Color.Pink)\n    .onClick(() => {\n      this.count += 10\n    })\n  }\n\n  build() {\n    Column() {\n      Text(this.count.toString())\n        .width(100)\n        .height(50)\n        .margin({ bottom: 10 })\n        .textAlign(TextAlign.Center)\n        .sameStyle()\n\n      Button('+1')\n        .sameStyle()\n    }\n    .height('100%')\n    .width('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n📕📕📕 练习案例-登录表单-样式优化\n\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  mobile: string = ''\n  @State\n  code: string = ''\n\n\n  @Styles\n  inputStyle () {\n    .border({ width: 1, color: Color.Gray })\n    .layoutWeight(1)\n    .margin({ left: 10, bottom: 10, top: 10 })\n    .backgroundColor(Color.White)\n  }\n\n  build() {\n    Column(){\n      Row(){\n        Text('手机号')\n        TextInput({ text: this.mobile })\n          .inputStyle()\n          .onChange((value)=>this.mobile = value)\n      }\n      Row(){\n        Text('验证码')\n        TextInput({ text: this.code })\n          .inputStyle()\n          .onChange((value)=>this.code = value)\n      }\n      Row({ space: 15 }){\n        Button('重置')\n          .backgroundColor('#ccc')\n          .onClick(()=>{\n            this.mobile = ''\n            this.code = ''\n          })\n        Button('登录')\n          .onClick(()=>{\n            if (this.mobile && this.code) {\n              promptAction.showToast({ message: `${this.mobile} 登录成功` })\n            } else {\n              promptAction.showToast({ message: `请输入手机号或验证码` })\n            }\n          })\n      }\n    }\n    .padding({ left: 15, right: 15 })\n  }\n}\n\n\n\n3. 样式-@Extends 复用#\n\n> @Extend 用于扩展原生组件样式，通过传参提供更灵活的样式复用\n\n * 使用 @Extend 装饰器修饰的函数只能是 全局\n * 函数可以进行 传参，如果参数是状态变量，状态更新后会刷新UI\n * 且参数可以是一个函数，实现复用事件且可处理不同逻辑\n\n// 全局  原生组件                     参数\n//  ↓     ↓                          ↓ \n@Extend(Text) function functionName(w: number) { \n  .width(w)\n}\n\n\n需求：把 Text 改成按钮样式，且绑定 click 事件执行不同逻辑\n\n\n\n@Extend(Text) function myClick(color: string, cb: () => void) {\n  .backgroundColor(color)\n  .width(100)\n  .height(50)\n  .textAlign(TextAlign.Center)\n  .borderRadius(25)\n  .onClick(() => cb())\n}\n\n@Entry\n@Component\nstruct Other {\n  @State\n  color: string = '#ccc'\n\n  build() {\n    Column({ space: 20 }) {\n      Text('Text1')\n        .myClick(this.color, () => {\n          this.color = '#069'\n        })\n      Text('Text2')\n        .myClick('green', () => {\n          promptAction.showToast({ message: '做其他事~' })\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n4. 样式-多态#\n\n> stateStyles() 可以依据组件的内部状态的不同，快速设置不同样式。\n\nstateStyles 是属性方法，可以根据UI内部状态来设置样式，类似于 css 伪类，但语法不同。ArkUI 提供以下四种状态：\n\n * focused：获焦态。\n\n * normal：正常态。\n\n * pressed：按压态。\n\n * disabled：不可用态。\n\n\n\n// 胶囊按钮\n@Extend(Text)\nfunction capsule(){\n  .height(40)\n  .borderRadius(20)\n  .backgroundColor(Color.Gray)\n  .padding({ left: 15, right: 15 })\n  .margin({ bottom: 15 })\n}\n\n@Entry\n@Component\nstruct Index {\n  @State\n  disabled: boolean = false\n  @State\n  focused: boolean = false\n\n  build() {\n    Column() {\n\n      // Button TextInput 默认开启获取焦点，页面中默认第一个这样的元素获取焦点\n      // Button 比较多限制，一个是默认开启获取焦点能看，二是禁用状态下样式无法修改\n      // Button('Button').focusable(false)\n\n      Text('toggle disabled：' + this.disabled)\n        .capsule()\n        .onClick(()=>{\n          this.disabled = !this.disabled\n        })\n      Text('toggle focused：' + this.focused)\n        .capsule()\n        .onClick(()=>{\n          this.focused = !this.focused\n        })\n      Text('clickMe')\n        .capsule()\n        .enabled(!this.disabled)\n        .focusable(this.focused)\n        .onClick(() => {\n          promptAction.showToast({ message: 'click' })\n        })\n        .fontColor('#fff')\n        .stateStyles({\n          normal: {\n            .backgroundColor(Color.Blue)\n          },\n          focused: {\n            .backgroundColor(Color.Red)\n          },\n          disabled: {\n            .backgroundColor(Color.Black)\n          },\n          pressed: {\n            .backgroundColor(Color.Orange)\n          }\n        })\n    }\n  }\n}\n\n\nTIP\n * 使用比较多的应该是 normal pressed 结合下的按压效果\n * enabled(true|false) 开启|禁用 focusable(true|false) 开启获取焦点能力|关闭\n\n注意：\n\n * 页面初始化的时候，默认第一个能获取焦点的元素，会自动获取焦点\n\n\n组件状态#\n\n\n1. 状态-class语法#\n\n> 在鸿蒙开发中关于对象状态范式采用 class 方式，后续组件传值遇到深层对象嵌套需要利用 class\n\n1）class 创建对象和 class 类型\n\nclass Person {\n  age: number;\n  name: string;\n\n  constructor(name: string, age: number) {\n    this.name = name\n    this.age = age\n  }\n}\n\n// 当类型使用和构当造函数使用\nconst p: Person = new Person('jack', 18)\n// 当类型使用这种使用后续居多，我们使用字面量对象居多，可以省略 constructor\nconst p1: Person = {\n  name: 'tom',\n  age: 20\n}\n\n\n2）implements 实现 interface 接口\n\ninterface IPerson {\n  name: string,\n  age: number,\n  say: () => void\n}\n\n// 实现 IPerson 接口，需要符合接口约定\nclass Person implements IPerson{\n  age: number;\n  name: string;\n\n  constructor(name: string, age: number) {\n    this.name = name\n    this.age = age\n  }\n\n  say () {\n    promptAction.showToast({ message: this.name })\n  }\n}\n\n\n3）extends 继承\n\nclass HmPerson extends Person {\n  github: string = 'https://github.com/zhousg'\n\n  coding () {\n    promptAction.showToast({ message: this.name + ': coding' })\n  }\n}\n\n\nTIP\n * 定义类 class 类名 { 属性 + 构造器 + 方法 }，类可以创建对象，也可以当类型使用。\n\n扩展：\n\n * class 可以实现 implements 接口，需要受到接口约束\n * class 可以继承 extends 另外一个class的属性和方法\n\n\n2. 状态-复杂状态#\n\n> 当装饰的数据类型为class或者Object时，可以观察到自身的赋值的变化，和其属性赋值的变化，即Object.keys(observedObject)返回\n> 的所有属性。\n\n1）对象类型状态\n\n// 对象模型\nclass User {\n  nickname: string\n  age: number\n}\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  user: User = { nickname: 'jack', age: 18 }\n\n  build() {\n    Column({ space: 20 }){\n      Text(this.user.nickname)\n      Text(this.user.age.toString())\n      Button('age++')\n        .onClick(() => {\n          this.user.age ++\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n2）嵌套对象类型状态\n\n// 对象模型\nclass User {\n  nickname: string\n  age: number\n}\n\nclass UserData {\n  code: number\n  message: string\n  // 嵌套对象\n  data: User\n}\n\n@Entry\n@Component\nstruct Index {\n  @State\n  res: UserData = {\n    code: 10000,\n    message: '获取用户信息成功',\n    // 嵌套对象\n    data: { nickname: 'jack', age: 18 }\n  }\n\n  build() {\n    Column({ space: 20 }) {\n      Text(this.res.data.nickname)\n      Text(this.res.data.age.toString())\n      Button('age++')\n        .onClick(() => {\n          // ❌ this.res.data.age ++\n          const user = this.res.data\n          // 替换属性，触发UI更新\n          this.res.data = { ...user, age: user.age + 1 }\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n3）对象数组类型状态\n\n// 对象模型\nclass User {\n  nickname: string\n  age: number\n}\n\n@Entry\n@Component\nstruct Index {\n  @State\n  list: User[] = [\n    { nickname: 'jack', age: 18 },\n    { nickname: 'tom', age: 16 }\n  ]\n  build() {\n    Column({ space: 20 }) {\n      Text(JSON.stringify(this.list[0]))\n      Text(JSON.stringify(this.list[1]))\n      Button('age++')\n        .onClick(() => {\n          // ❌ this.list[1].age ++\n          const user = this.list[1]\n          this.list[1] = { ...user, age: user.age + 1 }\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\nTIP\n * 使用 class 来约束对象类型，和嵌套对象和对象数组。\n * 嵌套对象和对象数组，采用赋值的方式进行更新，可以更新UI。\n * 🚦 后期如果学习组件传值，会给大家补充另外一种深层数据变更更新UI的方式\n\n\n界面渲染#\n\n\n1. 渲染-条件渲染#\n\n> 条件渲染可根据应用的不同状态，使用if、else和else if渲染对应状态下的UI内容。\n\n * 条件渲染，是根据状态数据进行判断展示不同UI\n * 条件渲染，是会销毁和创建组件，组件状态将不会保留\n\n1）使用 if else 实现 loading 效果\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  loading: boolean = false\n\n  build() {\n    Column({ space: 20 }){\n      if (this.loading) {\n        LoadingProgress()\n          .width(100)\n          .height(100)\n      } else  {\n        Text('后台数据')\n        Text('后台数据')\n        Text('后台数据')\n      }\n      Button('更新数据')\n        .onClick(() => {\n          this.loading = true\n          setTimeout(() => {\n            this.loading = false\n          }, 2000)\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n2）添加渲染会销毁和重新创建组件，组件状态将不会保留。\n\n@Component\nstruct CounterComp {\n  @State\n  count: number = 0\n\n  build() {\n    Text(this.count.toString())\n      .onClick(() => {\n        this.count ++\n      })\n  }\n}\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  show: boolean = true\n\n  build() {\n    Column({ space: 20 }){\n      if (this.show) {\n        // 累计的 count 切换时候不会保留\n        CounterComp()\n      }\n      Button('toggle')\n        .onClick(() => {\n          this.show = !this.show\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n2. 渲染-循环渲染#\n\n> ForEach 接口基于数组类型数据来进行循环渲染，需要与容器组件配合使用。\n\n语法：\n\nForEach(\n  // 数据源\n  arr: Array,\n  // 组件生成函数\n  itemGenerator: (item: Array, index?: number) => void,\n  // 键值生成函数\n  keyGenerator?: (item: Array, index?: number): string => string\n)\n\n\n应用：\n\nclass User {\n  id: string\n  name: string\n  age: number\n}\n\n\n@Entry\n@Component\nstruct Index {\n  @State\n  userList: User[] = []\n\n  build() {\n    Scroll() {\n      Column({ space: 20 }) {\n        // 循环渲染\n        ForEach(\n          // 1. 数据源\n          this.userList,\n          // 2. 组件生成函数\n          (item: User) => {\n            // 内容\n            Text(`${item.name} 今年 ${item.age} 岁`)\n          },\n          // 3. 键值生成函数\n          item => item.id\n        )\n        Button('加载更多')\n          .onClick(() => {\n            const arr: User[] = []\n            for (let index = 0; index < 10; index++) {\n              arr.push({ id: Math.random().toString(), name: 'jack', age: Math.ceil(Math.random() * 100) })\n            }\n            this.userList.push(...arr)\n          })\n      }\n    }\n    .width('100%')\n  }\n}\n\n\nTIP\n\n关于 keyGenerator 键生成函数的一些建议：\n\n * 不能缺省\n * 避免最终生成的键包含 index\n * 对象数组，建议使用对象中 id 唯一标识\n * 基本数据数字，建议转换成具有 id 唯一标识的对象，再使用","frontmatter":{"title":"HM - 鸿蒙-组件基础"},"version":""},{"id":2,"title":"HM - 鸿蒙-美团外卖","routePath":"/interview-handbook-project/guide/meituan","lang":"","toc":[{"text":"阶段案例-美团外卖","id":"阶段案例-美团外卖","depth":2,"charIndex":3},{"text":"1. 页面结构-入口页面","id":"1-页面结构-入口页面","depth":3,"charIndex":34},{"text":"2. 页面结构-底部组件","id":"2-页面结构-底部组件","depth":3,"charIndex":393},{"text":"3. 页面结构-导航组件","id":"3-页面结构-导航组件","depth":3,"charIndex":1706},{"text":"4. 页面结构-商品菜单和商品列表","id":"4-页面结构-商品菜单和商品列表","depth":3,"charIndex":2994},{"text":"5. 业务逻辑-渲染商品菜单和列表","id":"5-业务逻辑-渲染商品菜单和列表","depth":3,"charIndex":5332},{"text":"6. 页面结构-购物车","id":"6-页面结构-购物车","depth":3,"charIndex":8971},{"text":"7. 业务逻辑-加入购物车","id":"7-业务逻辑-加入购物车","depth":3,"charIndex":11526},{"text":"8. 业务逻辑-购物车管理","id":"8-业务逻辑-购物车管理","depth":3,"charIndex":13014}],"domain":"","content":"#\n\n\n阶段案例-美团外卖#\n\n商品页   购物车\n      \n\n\n1. 页面结构-入口页面#\n\n\n\n\n\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  showCart: boolean = false\n\n  build() {\n    Stack({ alignContent: Alignment.Bottom }) {\n      Column() {\n        Nav()\n        MenuWrapper()\n      }\n      .width('100%')\n      .height('100%')\n      if (this.showCart) {\n        Cart()\n      }\n      Footer({ showCart: $showCart })\n    }\n  }\n}\n\n\n\n2. 页面结构-底部组件#\n\n@Component\nexport struct Footer {\n  @Link\n  showCart: boolean\n\n  build() {\n    Row() {\n      Row() {\n        Badge({\n          value: '0',\n          position: BadgePosition.Right,\n          style: { badgeSize: 18 }\n        }) {\n          Image('https://zqran.gitee.io/images/waimai/cart-2.png')\n            .width(47)\n            .height(69)\n            .position({ y: -19 })\n        }\n        .width(50)\n        .height(50)\n        .margin({ left: 25, right: 10 })\n        .onClick(() => {\n          this.showCart = !this.showCart\n        })\n\n        Column() {\n          Text() {\n            Span('¥')\n              .fontColor('#fff')\n              .fontSize(12)\n            Span('0.00')\n              .fontColor('#fff')\n              .fontSize(24)\n          }\n\n          Text('预估另需配送费 ¥5')\n            .fontSize(12)\n            .fontColor('#999')\n        }\n        .layoutWeight(1)\n        .alignItems(HorizontalAlign.Start)\n\n        Text('去结算')\n          .backgroundColor('#f8c74e')\n          .alignSelf(ItemAlign.Stretch)\n          .padding(15)\n          .borderRadius({\n            topRight: 25,\n            bottomRight: 25\n          })\n      }\n      .height(50)\n      .layoutWeight(1)\n      .backgroundColor('#222426')\n      .borderRadius(25)\n    }\n    .padding(15)\n    .height(80)\n  }\n}\n\n\n\n3. 页面结构-导航组件#\n\n@Component\nexport struct Nav {\n  @Builder\n  NavItem(active: boolean, title: string, subTitle?: string) {\n    Column() {\n      Text() {\n        Span(title)\n        if (subTitle) {\n          Span(' ' + subTitle)\n            .fontSize(10)\n            .fontColor(active ? '#000' : '#666')\n        }\n      }.layoutWeight(1)\n      .fontColor(active ? '#000' : '#666')\n      .fontWeight(active ? FontWeight.Bold : FontWeight.Normal)\n\n      Text()\n        .height(1)\n        .width(20)\n        .margin({ left: 6 })\n        .backgroundColor(active ? '#fa0' : 'transparent')\n    }\n    .width(73)\n    .alignItems(HorizontalAlign.Start)\n    .padding({ top: 3 })\n  }\n\n  build() {\n    Row() {\n      this.NavItem(true, '点菜')\n      this.NavItem(false, '评价', '1796')\n      this.NavItem(false, '商家')\n\n      Row() {\n        Image($r('app.media.ic_public_input_search'))\n          .width(14)\n          .aspectRatio(1)\n          .fillColor('#999')\n        Text('请输入菜品名称')\n          .fontSize(12)\n          .fontColor('#999')\n      }\n      .backgroundColor('#eee')\n      .height(25)\n      .borderRadius(13)\n      .padding({ left: 5, right: 5 })\n      .layoutWeight(1)\n    }\n    .padding({ left: 15, right: 15 })\n    .height(40)\n    .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })\n  }\n}\n\n\n\n4. 页面结构-商品菜单和商品列表#\n\n\n\n\n@Component\nexport struct MenuWrapper {\n  list: string[] = ['一人套餐', '特色烧烤', '杂粮主食']\n  @State\n  activeIndex: number = 0\n\n  build() {\n    Row() {\n      Column() {\n        ForEach(this.list, (item: string, index: number) => {\n          Text(item)\n            .height(50)\n            .width('100%')\n            .textAlign(TextAlign.Center)\n            .fontSize(14)\n            .backgroundColor(this.activeIndex === index ? '#fff' : '#f5f5f5')\n            .onClick(() => {\n              this.activeIndex = index\n            })\n        })\n      }\n      .width(90)\n\n      List() {\n        ListItem(){\n          MenuWrapperItem()\n        }\n      }\n      .layoutWeight(1)\n      .height('100%')\n      .backgroundColor('#fff')\n    }\n    .layoutWeight(1)\n    .alignItems(VerticalAlign.Top)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\n\n\n@Component\nexport struct MenuWrapperItem {\n  build() {\n    Row() {\n      Image('https://zqran.gitee.io/images/waimai/8078956697.jpg')\n        .width(90)\n        .aspectRatio(1)\n      Column({ space: 5 }) {\n        Text('小份酸汤莜面鱼鱼+肉夹馍套餐')\n          .textOverflow({\n            overflow: TextOverflow.Ellipsis,\n          })\n          .maxLines(2)\n          .fontWeight(600)\n        Text('酸汤莜面鱼鱼，主料：酸汤、莜面 肉夹馍，主料：白皮饼、猪肉')\n          .textOverflow({\n            overflow: TextOverflow.Ellipsis,\n          })\n          .maxLines(1)\n          .fontSize(12)\n          .fontColor('#333')\n        Text('点评网友推荐')\n          .fontSize(10)\n          .backgroundColor('#fff5e2')\n          .fontColor('#ff8000')\n          .padding({ top: 2, bottom: 2, right: 5, left: 5 })\n          .borderRadius(2)\n        Text() {\n          Span('月销售40')\n          Span(' ')\n          Span('好评度100%')\n        }\n        .fontSize(12)\n        .fontColor('#999')\n\n        Row() {\n          Text() {\n            Span('¥ ')\n              .fontColor('#ff8000')\n              .fontSize(10)\n            Span('34.23')\n              .fontColor('#ff8000')\n              .fontWeight(FontWeight.Bold)\n          }\n\n          CalcBtn({ icon: $r('app.media.ic_public_add_filled') })\n        }\n        .justifyContent(FlexAlign.SpaceBetween)\n        .width('100%')\n      }\n      .layoutWeight(1)\n      .alignItems(HorizontalAlign.Start)\n      .padding({ left: 10, right: 10 })\n    }\n    .padding(10)\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n\n\n5. 业务逻辑-渲染商品菜单和列表#\n\n1）定义 model 数据模型\n\nexport class FoodItem {\n  id: number\n  name: string\n  like_ratio_desc: string\n  food_tag_list: string[]\n  price: number\n  picture: string\n  description: string\n  tag: string\n  month_saled: number\n}\n\nexport class Category {\n  tag: string\n  name: string\n  foods: FoodItem[]\n}\n\n\n2）使用 http 发送请求，获取数据\n\n\n\n\n\n\n\n\nconst req = http.createHttp()\n\n@Entry\n@Component\nstruct Index {\n  @State\n  showCart: boolean = false\n\n  @State\n  categoryList: Category[] = []\n\n  aboutToAppear() {\n    req.request('http://172.16.39.26:3000/takeaway')\n      .then(res => {\n        const data = JSON.parse(res.result as string) as Category[]\n        this.categoryList = data\n      })\n      .catch(err => {\n        console.error('MEITU', err.message)\n      })\n  }\n\n  build() {\n    Stack({ alignContent: Alignment.Bottom }) {\n      Column() {\n        Nav()\n        MenuWrapper({ categoryList: $categoryList })\n      }\n      .width('100%')\n      .height('100%')\n\n      if (this.showCart) {\n        Cart()\n      }\n      Footer({ showCart: $showCart })\n    }\n  }\n}\n\n\n3）传入列表数据给，商品菜单组件，进行渲染\n\n\n\n\n@Component\nexport struct MenuWrapper {\n  @Link\n  categoryList: Category[]\n  @State\n  activeIndex: number = 0\n\n  build() {\n    Row() {\n      Column() {\n        ForEach(this.categoryList, (item: Category, index: number) => {\n          Text(item.name)\n            .height(50)\n            .width('100%')\n            .textAlign(TextAlign.Center)\n            .fontSize(14)\n            .backgroundColor(this.activeIndex === index ? '#fff' : '#f5f5f5')\n            .onClick(() => {\n              this.activeIndex = index\n            })\n        })\n      }\n      .width(90)\n\n      List() {\n        ForEach(this.categoryList[this.activeIndex]?.foods, (item: FoodItem) => {\n          ListItem() {\n            MenuWrapperItem({ food: item })\n          }\n        })\n      }\n      .layoutWeight(1)\n      .height('100%')\n      .backgroundColor('#fff')\n    }\n    .layoutWeight(1)\n    .alignItems(VerticalAlign.Top)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\n\n\n\n@Component\nexport struct MenuWrapperItem {\n\n  @ObjectLink\n  food: FoodItem\n\n  build() {\n    Row() {\n      Image(this.food.picture)\n        .width(90)\n        .aspectRatio(1)\n      Column({ space: 5 }) {\n        Text(this.food.name)\n          .textOverflow({\n            overflow: TextOverflow.Ellipsis,\n          })\n          .maxLines(2)\n          .fontWeight(600)\n        Text(this.food.description)\n          .textOverflow({\n            overflow: TextOverflow.Ellipsis,\n          })\n          .maxLines(1)\n          .fontSize(12)\n          .fontColor('#333')\n        ForEach(this.food.food_tag_list, (tag) => {\n          Text(tag)\n            .fontSize(10)\n            .backgroundColor('#fff5e2')\n            .fontColor('#ff8000')\n            .padding({ top: 2, bottom: 2, right: 5, left: 5 })\n            .borderRadius(2)\n        })\n        Text() {\n          Span('月销售'+this.food.month_saled)\n          Span(' ')\n          Span(this.food.like_ratio_desc)\n        }\n        .fontSize(12)\n        .fontColor('#999')\n\n        Row() {\n          Text() {\n            Span('¥ ')\n              .fontColor('#ff8000')\n              .fontSize(10)\n            Span(this.food.price.toFixed(2))\n              .fontColor('#ff8000')\n              .fontWeight(FontWeight.Bold)\n          }\n\n          CalcBtn({ icon: $r('app.media.ic_public_add_filled') })\n        }\n        .justifyContent(FlexAlign.SpaceBetween)\n        .width('100%')\n      }\n      .layoutWeight(1)\n      .alignItems(HorizontalAlign.Start)\n      .padding({ left: 10, right: 10 })\n    }\n    .padding(10)\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n\n\n6. 页面结构-购物车#\n\n * 抽取计算案例组件\n * 搭建购物车页面\n\n@Component\nexport struct CalcBtn {\n\n  icon: Resource\n\n  plain?: boolean\n\n  build() {\n    Row() {\n      Image(this.icon)\n        .width(10)\n        .aspectRatio(1)\n    }\n    .width(16)\n    .aspectRatio(1)\n    .backgroundColor(this.plain ? '#fff' : '#f8c74e')\n    .border(this.plain ? { width: 0.5 , color: '#f8c74e'}: {})\n    .borderRadius(4)\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n@Component\nexport struct Cart {\n  build() {\n    Column(){\n      Column(){\n        Row(){\n          Text('购物车')\n            .fontSize(14)\n          Text('清空购物车')\n            .fontSize(14)\n            .fontColor('#999')\n        }\n        .width('100%')\n        .height(40)\n        .justifyContent(FlexAlign.SpaceBetween)\n        .padding({ left: 15, right: 15 })\n        .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })\n        // 购物车列表\n        List(){\n          ListItem(){\n            CartItem()\n          }\n          ListItem(){\n            CartItem()\n          }\n          ListItem(){\n            CartItem()\n          }\n        }\n        .divider({\n          strokeWidth: 0.5,\n          color: '#e4e4e4'\n        })\n        .padding({ left: 15, right: 15 })\n      }\n      .width('100%')\n      .padding({ bottom: 100 })\n      .backgroundColor('#fff')\n      .borderRadius({\n        topLeft: 16,\n        topRight: 16\n      })\n    }\n    .height('100%')\n    .width('100%')\n    .backgroundColor('rgba(0,0,0,0.5)')\n    .justifyContent(FlexAlign.End)\n  }\n}\n\n\n\n@Component\nexport struct CartItem {\n  build() {\n    Row(){\n      Image('https://zqran.gitee.io/images/waimai/7384994864.jpg')\n        .width(60)\n        .aspectRatio(1)\n      Column({ space: 10 }){\n        Text('小份酸汤莜面鱼鱼+肉夹馍套餐')\n          .textOverflow({\n            overflow: TextOverflow.Ellipsis\n          })\n          .maxLines(2)\n        Row(){\n          Text(){\n            Span('¥ ')\n              .fontSize(10)\n              .fontColor('#ff8000')\n            Span('23.23')\n              .fontWeight(600)\n              .fontColor('#ff8000')\n          }\n\n          Row({ space: 10 }){\n            CalcBtn({ icon: $r('app.media.ic_screenshot_line'), plain: true })\n            Text('0')\n              .fontSize(14)\n            CalcBtn({ icon: $r('app.media.ic_public_add_filled') })\n          }\n        }\n        .width('100%')\n        .justifyContent(FlexAlign.SpaceBetween)\n      }\n      .layoutWeight(1)\n      .alignItems(HorizontalAlign.Start)\n      .padding({ left: 10 })\n    }\n    .padding({ top: 15, bottom: 15 })\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n\n\n7. 业务逻辑-加入购物车#\n\n1）购物车数据模型\n\nexport class CartItemModel {\n  id: number\n  name: string\n  price: number\n  picture: string\n  count: number\n}\n\n\n2）购物车添加逻辑\n\n\n\nexport const CART_KEY = 'CART_KEY'\n\nexport const getCart = () => {\n  return JSON.parse(AppStorage.Get(CART_KEY) || '[]') as CartItemModel[]\n}\n\nexport const addCart = (food: FoodItem) => {\n  const cart = getCart()\n  const f = cart.find(f => f.id === food.id)\n  if (f) {\n    f.count++\n  } else {\n    const { id, price, picture, name } = food\n    cart.unshift({\n      id,\n      price,\n      picture,\n      name,\n      count: 1\n    })\n  }\n  AppStorage.Set(CART_KEY, JSON.stringify(cart))\n}\n\n\n3）购物车状态持久化\n\n\n\n\nPersistentStorage.PersistProp(CART_KEY, '[]')\n\n\n4）监听购物车数据变化，设置购物车状态，底部组件显示数量和总价\n\n  @StorageProp(CART_KEY)\n  @Watch('onUpdateCart')\n  cartJson: string = '[]'\n  @State\n  cart: CartItem[] = JSON.parse(this.cartJson)\n  onUpdateCart () {\n    this.cart = JSON.parse(this.cartJson)\n  }\n\n\nFooter({ showCart: $showCart, cart: $cart })\n\n\n@Link\ncart: CartItem[]\n\n  // ...\n          Badge({\n          value: this.cart.reduce((p, c) => p + c.count, 0) + '',\n          })\n\n  // ...\n          Span(this.cart.reduce((p, c) => p + (c.count * c.price * 100) / 100, 0).toFixed(2))\n          .fontColor('#fff')\n          .fontSize(24)\n\n\n\n5）添加购物车\n\n          CalcBtn({ icon: $r('app.media.ic_public_add_filled') })\n            .onClick(() => {\n              addCart(this.food)\n              promptAction.showToast({ message: '添加购物车成功' })\n            })\n\n\n\n8. 业务逻辑-购物车管理#\n\n1）渲染购物车\n\n      if (this.showCart) {\n        Cart({ cart: $cart })\n      }\n\n\n@Component\nexport struct Cart {\n  @Link\n  cart: CartItemModel[]\n\n  // ...\n\n          List({ space: 30 }) {\n          ForEach(this.cart, (item:CartItemModel) => {\n            ListItem() {\n              CartItemComp({ item })\n            }\n          })\n        }\n\n\n\n\n\n@Component\nexport struct CartItem {\n\n  @ObjectLink\n  item: CartItemModel\n\n  build() {\n    Row() {\n      Image(this.item.picture)\n        .width(60)\n        .aspectRatio(1)\n        .borderRadius(8)\n      Column({ space: 5 }) {\n        Text(this.item.name)\n          .fontSize(14)\n          .textOverflow({\n            overflow: TextOverflow.Ellipsis\n          })\n          .maxLines(2)\n        Row() {\n          Text() {\n            Span('¥ ')\n              .fontColor('#ff8000')\n              .fontSize(10)\n            Span(this.item.price.toFixed(2))\n              .fontColor('#ff8000')\n              .fontWeight(FontWeight.Bold)\n          }\n\n          Row() {\n            CalcBtn({ icon: $r('app.media.ic_screenshot_line'), plain: true })\n            Text(this.item.count+'')\n              .padding(10)\n              .fontSize(12)\n            CalcBtn({ icon: $r('app.media.ic_public_add_filled') })\n          }\n        }\n        .justifyContent(FlexAlign.SpaceBetween)\n        .width('100%')\n      }\n      .layoutWeight(1)\n      .alignItems(HorizontalAlign.Start)\n      .padding({ left: 10, right: 10 })\n    }\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n\n2）购物车数量修改\n\nexport const addCart = (food: FoodItem | CartItemModel) => { ... }\n\nexport const delCart = (id: number) => {\n  const cart = getCart()\n  const f = cart.find(f => f.id === id)\n  if (f && f.count > 0) {\n    f.count--\n  }\n  AppStorage.Set(CART_KEY, JSON.stringify(cart))\n}\n\n\n            CalcBtn({ icon: $r('app.media.ic_screenshot_line'), plain: true })\n              .onClick(() => {\n                delCart(this.item.id)\n              })\n            Text(this.item.count+'')\n              .padding(10)\n              .fontSize(12)\n            CalcBtn({ icon: $r('app.media.ic_public_add_filled') })\n              .onClick(()=>{\n                addCart(this.item)\n              })\n\n\n3）清空购物车\n\nexport const clearCart  = () => {\n  AppStorage.Set(CART_KEY, '[]')\n}\n\n\n          Text('清空购物车')\n            .fontSize(12)\n            .fontColor('#999')\n            .onClick(() => {\n              clearCart()\n            })\n","frontmatter":{"title":"HM - 鸿蒙-美团外卖"},"version":""},{"id":3,"title":"HM - 鸿蒙-华为闹钟","routePath":"/interview-handbook-project/guide/naozhong","lang":"","toc":[{"text":"阶段案例-华为闹钟","id":"阶段案例-华为闹钟","depth":2,"charIndex":3},{"text":"1. 页面结构-首页结构","id":"1-页面结构-首页结构","depth":3,"charIndex":32},{"text":"2. 页面结构-绘制闹钟","id":"2-页面结构-绘制闹钟","depth":3,"charIndex":1104},{"text":"3. 页面结构-绘制闹钟任务列表","id":"3-页面结构-绘制闹钟任务列表","depth":3,"charIndex":2900},{"text":"4. 页面结构-详情页","id":"4-页面结构-详情页","depth":3,"charIndex":3675},{"text":"5. 业务逻辑-首选项存储工具","id":"5-业务逻辑-首选项存储工具","depth":3,"charIndex":4918},{"text":"6. 业务逻辑-添加闹钟任务","id":"6-业务逻辑-添加闹钟任务","depth":3,"charIndex":5750},{"text":"7. 业务逻辑-渲染闹钟任务列表","id":"7-业务逻辑-渲染闹钟任务列表","depth":3,"charIndex":6767},{"text":"8. 业务逻辑-修改闹铃任务","id":"8-业务逻辑-修改闹铃任务","depth":3,"charIndex":7778},{"text":"9. 业务逻辑-删除闹钟任务","id":"9-业务逻辑-删除闹钟任务","depth":3,"charIndex":9030},{"text":"10. 业务逻辑-通知唤起应用和关闭延时","id":"10-业务逻辑-通知唤起应用和关闭延时","depth":3,"charIndex":9826},{"text":"11. 业务逻辑-停止和开启闹钟任务","id":"11-业务逻辑-停止和开启闹钟任务","depth":3,"charIndex":11590}],"domain":"","content":"#\n\n\n阶段案例-华为闹钟#\n\n首页   详情页\n     \n\n\n1. 页面结构-首页结构#\n\n\n\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Stack({ alignContent: Alignment.Bottom }){\n      Column({ space: 15 }) {\n        Text('闹钟')\n          .fontSize('24')\n          .width('100%')\n\n        CanvasComp()\n\n        ForEach([1, 2, 3], () => {\n          ClockItemComp()\n            .onClick(() => {\n              router.pushUrl({\n                url: 'pages/DetailPage',\n              })\n            })\n        })\n      }\n      .padding(15)\n      .height('100%')\n      .width('100%')\n      .backgroundColor('#f5f5f5')\n      // 添加\n      Text('+')\n        .width(50)\n        .aspectRatio(1)\n        .backgroundColor('#06f')\n        .fontSize(40)\n        .fontWeight(100)\n        .fontColor('#fff')\n        .borderRadius(25)\n        .textAlign(TextAlign.Center)\n        .margin({ bottom: 50 })\n        .onClick(() => {\n          router.pushUrl({\n            url: 'pages/DetailPage',\n          })\n        })\n    }\n  }\n}\n\n\n@Component\nexport struct CanvasComp {\n  build() {\n    \n  }\n}\n\n\n@Component\nexport struct ClockItemComp {\n  build() {\n    \n  }\n}\n\n\n\n2. 页面结构-绘制闹钟#\n\n 1. 绘制表盘\n 2. 绘制 时分秒 指针\n 3. 走起来\n\n@Component\nexport struct CanvasComp {\n  private settings = new RenderingContextSettings(true)\n  private context = new CanvasRenderingContext2D(this.settings)\n  private panImg = new ImageBitmap('/images/ic_clock_pan.png')\n  private hourImg = new ImageBitmap('/images/ic_hour_pointer.png')\n  private minuteImg = new ImageBitmap('/images/ic_minute_pointer.png')\n  private secondImg = new ImageBitmap('/images/ic_second_pointer.png')\n\n  // 画布尺寸\n  canvasSize = 252\n  // 指针尺寸\n  pointerWidth = 8\n\n  startDraw() {\n    this.drawClock()\n    setInterval(() => {\n      this.drawClock()\n    }, 1000)\n  }\n\n  /**\n   * 绘制闹钟\n   */\n  drawClock() {\n    this.context.clearRect(0, 0, this.canvasSize, this.canvasSize)\n    this.context.drawImage(this.panImg, 0, 0, this.canvasSize, this.canvasSize)\n    // 根据时间绘制指针\n    const date = new Date()\n    const hour = date.getHours()\n    const minute = date.getMinutes()\n    const second = date.getSeconds()\n    this.drawPointer(this.hourImg, hour % 12 * 360)\n    this.drawPointer(this.minuteImg, minute / 60 * 360)\n    this.drawPointer(this.secondImg, second / 60 * 360)\n  }\n\n  /**\n   * 绘制指针\n   * @param img - 指针图片\n   * @param angle - 旋转角度，起点是 Y 轴上方向\n   */\n  drawPointer(img: ImageBitmap, angle: number) {\n    this.context.save()\n    this.context.translate(this.canvasSize / 2, this.canvasSize / 2)\n    this.context.rotate((angle + 180) * Math.PI / 180)\n    this.context.translate(-this.canvasSize / 2, -this.canvasSize / 2)\n    this.context.drawImage(img, this.canvasSize / 2 - this.pointerWidth / 2, 0, this.pointerWidth, this.canvasSize)\n    this.context.restore()\n  }\n\n  build() {\n    Canvas(this.context)\n      .width(this.canvasSize)\n      .aspectRatio(1)\n      .onReady(() => {\n        this.startDraw()\n      })\n  }\n}\n\n\n\n3. 页面结构-绘制闹钟任务列表#\n\n@Component\nexport struct ClockItemComp {\n  build() {\n    Row(){\n      Column({ space: 5 }) {\n        Row({ space: 5 }){\n          Text('下午')\n            .fontColor('#666')\n          Text('04:30')\n            .fontWeight(600)\n            .fontSize(18)\n        }\n        Row({ space: 15 }){\n          Text('闹钟')\n            .fontColor('#999')\n            .fontSize(14)\n          Text('不重复')\n            .fontColor('#999')\n            .fontSize(14)\n        }\n      }\n      .alignItems(HorizontalAlign.Start)\n\n      // 开关\n      Toggle({ type: ToggleType.Switch , isOn: true })\n    }\n    .height(64)\n    .padding({ left: 20, right: 15 })\n    .width('100%')\n    .backgroundColor('#fff')\n    .borderRadius(30)\n    .justifyContent(FlexAlign.SpaceBetween)\n  }\n}\n\n\n\n4. 页面结构-详情页#\n\n@Entry\n@Component\nstruct DetailPage {\n\n  submit () {\n    // TODO\n  }\n\n  @Builder\n  CellBuilder (title: string, value: string) {\n    Row(){\n      Text(title)\n        .layoutWeight(1)\n      Text(value)\n        .fontColor('#999')\n      Image('/images/ic_public_arrow_right.svg')\n        .width(18)\n        .aspectRatio(1)\n        .fillColor('#999')\n    }\n    .height(60)\n    .padding({ left: 15, right: 15 })\n    .backgroundColor('#fff')\n  }\n\n  build() {\n    Navigation(){\n      Column({ space: 15 }){\n        TimePicker()\n          .borderRadius(16)\n          .clip(true)\n\n        Column({ space: 1 }){\n          this.CellBuilder('闹铃名称', '闹铃')\n          this.CellBuilder('重复', '不重复')\n        }\n        .borderRadius(16)\n        .clip(true)\n\n        Text('删除闹铃')\n          .width(100)\n          .height(40)\n          .borderRadius(20)\n          .backgroundColor('#c3c4c5')\n          .textAlign(TextAlign.Center)\n          .fontColor('#f00')\n          .opacity(0.3)\n      }\n      .padding(15)\n    }\n    .title('新建闹钟')\n    .titleMode(NavigationTitleMode.Mini)\n    .mode(NavigationMode.Stack)\n    .backgroundColor('#f5f5f5')\n    .menus([\n      { value: '', icon: '/images/ic_confirm.png', action: () => this.submit() }\n    ])\n  }\n}\n\n\n\n5. 业务逻辑-首选项存储工具#\n\n * 创建首选项存储工具类\n * 获取首选项实例\n * 设置和修改闹钟信息\n * 删除闹钟信息\n * 获取所有的闹钟信息\n\n\n\nexport class ClockItem {\n  hour?: number\n  minute?: number\n  id?: string\n  reminderId?: number\n  enabled?: boolean\n}\n\nexport class ClockStore {\n\n  getStore() {\n    return preferences.getPreferences(getContext(this), 'clockStore')\n  }\n\n  async addClock(clockItem: ClockItem) {\n    const store = await this.getStore()\n    await store.put(clockItem.id, JSON.stringify(clockItem))\n    await store.flush()\n  }\n\n  async delClock(id: string) {\n    const store = await this.getStore()\n    await store.delete(id)\n    await store.flush()\n  }\n\n  async getAllClock() {\n    const store = await this.getStore()\n    const data = await store.getAll()\n    const list = Object.keys(data).map(key => {\n      return JSON.parse(data[key])\n    })\n    return list\n  }\n}\n\n\n\n6. 业务逻辑-添加闹钟任务#\n\n * 绑定时间选择组件，回收选中后的时间数据\n * 开启提醒\n * 保存到首选项\n\n  @State\n  clockItem: ClockItem = {}\n\n  // Date 不能直接使用 @State 装饰器\n  @State\n  state: { now: Date } = { now: new Date() }\n  clockStore = new ClockStore()\n\n  async submit() {\n\n    // 1. 开启提醒\n    const hour = this.state.now.getHours()\n    const minute = this.state.now.getMinutes()\n    const request: reminderAgentManager.ReminderRequestAlarm = {\n      reminderType: reminderAgentManager.ReminderType.REMINDER_TYPE_ALARM,\n      hour,\n      minute,\n      title: '闹钟',\n      ringDuration: 60\n    }\n    const reminderId = await reminderAgentManager.publishReminder(request)\n    // 2. 记录数据\n    this.clockItem = {\n      hour,\n      minute,\n      id: util.generateRandomUUID(),\n      reminderId,\n      enabled: true\n    }\n    await this.clockStore.addClock(this.clockItem)\n    promptAction.showToast({ message: '添加闹钟成功' })\n    router.back()\n  } \n\n\n        TimePicker({\n          selected: this.state.now\n        })\n          .borderRadius(16)\n          .clip(true)\n\n\n\n7. 业务逻辑-渲染闹钟任务列表#\n\n * 获取首选项闹钟数据\n * 遍历数组\n * 去闹钟项组件渲染\n\n1） 获取首选项闹钟数据\n\n  @State\n  clockList: ClockItem[] = []\n\n  clockStore = new ClockStore()\n\n  aboutToAppear() {\n    this.initData()\n  }\n  onPageShow() {\n    this.initData()\n  }\n  async initData() {\n    this.clockList = await this.clockStore.getAllClock()\n  }\n\n\n2） 遍历数组\n\n        ForEach(this.clockList, (item: ClockItem) => {\n          ClockItemComp({ item })\n            .onClick(() => {\n              router.pushUrl({\n                url: 'pages/DetailPage',\n                params: item\n              })\n            })\n        })\n\n\n3） 去闹钟项组件渲染\n\n  @State\n  item: ClockItem = {}\n\n  padZero(val: number = 0) {\n    return val.toString().padStart(2, '0')\n  }\n\n\n        Row({ space: 5 }) {\n          Text(this.item.hour > 12 ? '下午' : '上午')\n            .fontColor('#666')\n          Text(`${this.padZero(this.item.hour > 12 ? this.item.hour - 12 : this.item.hour)}:${this.padZero(this.item.minute)}`)\n            .fontWeight(600)\n            .fontSize(18)\n        }\n\n\n\n8. 业务逻辑-修改闹铃任务#\n\n * 传递闹铃数据到详情页，需要接收下\n\n * 页面上的标题需要判断显示\n\n * 在 submit 函数中加入编辑逻辑\n\n1）传递闹铃数据到详情页，需要接收下\n\n  aboutToAppear() {\n    const params = router.getParams() as ClockItem\n    if (params && params.id) {\n      this.clockItem = { ...params }\n      this.state.now.setHours(this.clockItem.hour)\n      this.state.now.setMinutes(this.clockItem.minute)\n    }\n  }\n\n\n2）页面上的标题需要判断显示\n\n+    .title((this.clockItem.id ? '编辑' : '添加') + '闹钟')\n    .titleMode(NavigationTitleMode.Mini)\n    .mode(NavigationMode.Stack)\n\n\n3）在 submit 函数中加入编辑逻辑\n\n      // 2. 记录数据\n      if (this.clockItem.id) {\n        this.clockItem.hour = hour\n        this.clockItem.minute = minute\n        this.clockItem.enabled = true\n        // 不加 await 让它异步执行，因为可能存在失效的代理提醒，这样不会阻碍后续逻辑\n        reminderAgentManager.cancelReminder(this.clockItem.reminderId)\n        this.clockItem.reminderId = reminderId\n        await this.clockStore.addClock(this.clockItem)\n        promptAction.showToast({ message:'编辑闹钟成功' })\n      } else {\n        this.clockItem = {\n          hour,\n          minute,\n          id: util.generateRandomUUID(),\n          reminderId,\n          enabled: true\n        }\n        await this.clockStore.addClock(this.clockItem)\n        promptAction.showToast({ message:'添加闹钟成功' })\n      }\n\n\n\n9. 业务逻辑-删除闹钟任务#\n\n * 删除按钮在编辑条件下展示，绑定事件函数\n\n * 实现删除功能\n\n1）删除按钮在编辑条件下展示，绑定事件函数\n\n        if ( this.clockItem.id ) {\n          Text('删除闹铃')\n            .width(100)\n            .height(40)\n            .borderRadius(20)\n            .backgroundColor('#c3c4c5')\n            .textAlign(TextAlign.Center)\n            .fontColor('#f00')\n            .opacity(0.3)\n            .onClick(() => {\n              this.remove()\n            })\n        }\n\n\n2）实现删除功能\n\n  async remove () {\n    try {\n      await this.clockStore.delClock(this.clockItem.id)\n      promptAction.showToast({ message: '删除闹钟成功' })\n      // 不加 await 让它异步执行，因为可能存在失效的代理提醒，这样不会阻碍跳转\n      reminderAgentManager.cancelReminder(this.clockItem.reminderId)\n      router.back()\n    } catch (e) {\n      console.error('CLOCK-REMOVE', e.message)\n    }\n  }\n\n\n\n10. 业务逻辑-通知唤起应用和关闭延时#\n\n * 抽取创建后台代理工具类\n * 加入唤起配置，加入延时和关闭配置\n * 进行复用\n\n1）加入唤起配置，加入延时和关闭配置\n\n      // 跳转\n      wantAgent: {\n        pkgName: 'com.itcast.myapplication',\n        abilityName: 'EntryAbility'\n      },\n      // 操作按钮\n      actionButton: [\n        { title: '关闭', type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_CLOSE },\n        { title: '延时提醒', type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_SNOOZE }\n      ],\n      snoozeTimes: 1,\n      timeInterval: 10 * 60\n\n\n2）抽取创建后台代理工具类\n\n\n\nexport class AlarmManager {\n\n  // 添加代理提醒\n  static async addReminder (hour: number, minute: number) {\n    // 1. 添加后台代理提醒-闹钟\n    const reminderRequest: reminderAgentManager.ReminderRequestAlarm = {\n      reminderType: reminderAgentManager.ReminderType.REMINDER_TYPE_ALARM,\n      hour,\n      minute,\n      ringDuration: 60,\n      title: '闹铃',\n      // 跳转\n      wantAgent: {\n        pkgName: 'com.itcast.hmday05',\n        abilityName: 'EntryAbility'\n      },\n      // 延时和关闭\n      actionButton: [\n        { title: '关闭', type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_CLOSE },\n        { title: '延时提醒', type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_SNOOZE }\n      ],\n      snoozeTimes: 2,\n      timeInterval: 10 * 60\n    }\n\n    const reminderId = await reminderAgentManager.publishReminder(reminderRequest)\n    return reminderId\n  }\n}\n\n\n\n3）进行复用\n\n      // 1. 开启提醒\n      const hour = this.state.now.getHours()\n      const minute = this.state.now.getMinutes()\n+      const reminderId = await AlarmManager.createAlarmTask(hour, minute)\n      // 2. 记录数据\n\n\n    if (this.item.enabled) {\n+      const reminderId = await AlarmManager.createAlarmTask(this.item.hour, this.item.minute)\n      this.item.reminderId = reminderId\n    }\n\n\n\n11. 业务逻辑-停止和开启闹钟任务#\n\n  clockStore = new ClockStore()\n\n  async toggle(isOn: boolean) {\n    reminderAgentManager.cancelReminder(this.item.reminderId)\n\n    this.item.enabled = isOn\n    if (this.item.enabled) {\n      const request: reminderAgentManager.ReminderRequestAlarm = {\n        reminderType: reminderAgentManager.ReminderType.REMINDER_TYPE_ALARM,\n        hour: this.item.hour,\n        minute: this.item.minute,\n        title: '闹钟',\n        ringDuration: 60\n      }\n      const reminderId = await reminderAgentManager.publishReminder(request)\n      this.item.reminderId = reminderId\n    }\n    this.clockStore.addClock(this.item)\n    promptAction.showToast({ message: isOn ? '已开启' : '已关闭' })\n  }\n\n\n      // 开关\n      Toggle({ type: ToggleType.Switch, isOn: this.item.enabled })\n        .onChange(isOn => this.toggle(isOn))\n","frontmatter":{"title":"HM - 鸿蒙-华为闹钟"},"version":""},{"id":4,"title":"HM - 鸿蒙-状态管理","routePath":"/interview-handbook-project/guide/state","lang":"","toc":[{"text":"自定义构建函数","id":"自定义构建函数","depth":2,"charIndex":3},{"text":"1. 构建函数-@Builder","id":"1-构建函数-builder","depth":3,"charIndex":14},{"text":"2. 构建函数-传参传递","id":"2-构建函数-传参传递","depth":3,"charIndex":3172},{"text":"3. 构建函数-@BuilderParam 传递UI","id":"3-构建函数-builderparam-传递ui","depth":3,"charIndex":5542},{"text":"4. 构建函数-系统组件自定义UI","id":"4-构建函数-系统组件自定义ui","depth":3,"charIndex":8867},{"text":"组件状态共享","id":"组件状态共享","depth":2,"charIndex":10287},{"text":"1. 状态共享-父子单向","id":"1-状态共享-父子单向","depth":3,"charIndex":10297},{"text":"2. 状态共享-父子双向","id":"2-状态共享-父子双向","depth":3,"charIndex":11022},{"text":"3. 状态共享-后代组件","id":"3-状态共享-后代组件","depth":3,"charIndex":12363},{"text":"4. 状态共享-状态监听器","id":"4-状态共享-状态监听器","depth":3,"charIndex":13237},{"text":"5. @Observed与@ObjectLink","id":"5-observed与objectlink","depth":3,"charIndex":14040},{"text":"应用状态","id":"应用状态","depth":2,"charIndex":21203},{"text":"1. UIAbility内状态-LocalStorage","id":"1-uiability内状态-localstorage","depth":3,"charIndex":21241},{"text":"2. 应用状态-AppStorage","id":"2-应用状态-appstorage","depth":3,"charIndex":24269},{"text":"3. 状态持久化-PersistentStorage","id":"3-状态持久化-persistentstorage","depth":3,"charIndex":26455},{"text":"4. 设备环境-Environment","id":"4-设备环境-environment","depth":3,"charIndex":28020},{"text":"网络管理","id":"网络管理","depth":2,"charIndex":28579},{"text":"1. 应用权限","id":"1-应用权限","depth":3,"charIndex":28587},{"text":"2. HTTP请求","id":"2-http请求","depth":3,"charIndex":29034}],"domain":"","content":"#\n\n\n自定义构建函数#\n\n\n1. 构建函数-@Builder#\n\n> ArkUI还提供了一种更轻量的UI元素复用机制 @Builder，可以将重复使用的UI元素抽象成一个方法，在 build 方法里调用。\n\n * 组件内定义\n * 全局定义\n\n1）组件内定义\n\n@Builder MyBuilderFunction() {}\n\n\nthis.MyBuilderFunction()\n\n\n2）全局定义\n\n@Builder function MyGlobalBuilderFunction() {}\n\n\nMyGlobalBuilderFunction()\n\n\n📕📕📕 练习案例→商品详情-更多按钮\n\n * 待实现页面\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Column() {\n      GridRow({ columns: 2, gutter: 15 }) {\n        GridCol({ span: 2 }) {\n          Column() {\n            Row() {\n              Text('评价（2000+）')\n                .layoutWeight(1)\n                .fontWeight(600)\n              // TODO\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n\n        GridCol() {\n          Column() {\n            Row() {\n              Text('推荐')\n                .layoutWeight(1)\n                .fontWeight(600)\n              // TODO\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n\n        GridCol() {\n          Column() {\n            Row() {\n              Text('体验')\n                .layoutWeight(1)\n                .fontWeight(600)\n              // TODO\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n      }\n    }\n    .height('100%')\n    .padding(15)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\n * 使用 @Builder 提取UI结构\n\n@Entry\n@Component\nstruct Index {\n\n  @Builder\n  MoreBuilder () {\n    Row() {\n      Text('查看更多')\n        .fontSize(14)\n        .fontColor('#666666')\n      Image($r('app.media.ic_public_arrow_right'))\n        .width(16)\n        .fillColor('#666666')\n    }\n  }\n\n  build() {\n    Column() {\n      GridRow({ columns: 2, gutter: 15 }) {\n        GridCol({ span: 2 }) {\n          Column() {\n            Row() {\n              Text('评价（2000+）')\n                .layoutWeight(1)\n                .fontWeight(600)\n              this.MoreBuilder()\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n\n        GridCol() {\n          Column() {\n            Row() {\n              Text('推荐')\n                .layoutWeight(1)\n                .fontWeight(600)\n              this.MoreBuilder()\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n\n        GridCol() {\n          Column() {\n            Row() {\n              Text('体验')\n                .layoutWeight(1)\n                .fontWeight(600)\n              this.MoreBuilder()\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n      }\n    }\n    .height('100%')\n    .padding(15)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\nTIP\n\n小结：\n\n * 遇到非遍历情况下，一个组件分散着相同的UI结构，可以使用 @Builder 更轻量\n\n其他：\n\n * GridRow GridCol 栅格布局\n\n\n2. 构建函数-传参传递#\n\n1）按值传递（场景：构建不同的UI）\n\n@Builder MyBuilderFunction( title: string ) {}\n\n\nthis.MyBuilderFunction('Title')\n\n\n需求：不同板块查看更多文案不一样\n\n * 评价 好评率 98%\n\n * 推荐 查看全部\n\n * 体验 4 条测评\n\n  @Builder\n  MoreBuilder (title: string) {\n    Row() {\n      Text(title)\n        .fontSize(14)\n        .fontColor('#666666')\n      Image($r('app.media.ic_public_arrow_right'))\n        .width(16)\n        .fillColor('#666666')\n    }\n  }\n\n\nthis.MoreBuilder('好评率 98%')\nthis.MoreBuilder('查看全部')\nthis.MoreBuilder('4 条测评')\n\n\n2）引用传递（场景：当传递的数据更新，需要更新UI）\n\n需求：\n\n * 点击按钮后模拟加载好评率数据\n\n@Entry\n@Component\nstruct Index {\n  @State\n  rate: number = 0\n\n  @Builder\n  MoreBuilder(params: { title: string }) {\n    Row() {\n      Text(params.title)\n        .fontSize(14)\n        .fontColor('#666666')\n      Image($r('app.media.ic_public_arrow_right'))\n        .width(16)\n        .fillColor('#666666')\n    }\n  }\n\n  build() {\n    Column() {\n      Button('获取数据')\n        .margin({ bottom: 15 })\n        .onClick(() => {\n          this.rate = 99\n        })\n      GridRow({ columns: 2, gutter: 15 }) {\n        GridCol({ span: 2 }) {\n          Column() {\n            Row() {\n              Text('评价（2000+）')\n                .layoutWeight(1)\n                .fontWeight(600)\n              this.MoreBuilder({ title: `好评率 ${this.rate} %` })\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n\n        GridCol() {\n          Column() {\n            Row() {\n              Text('推荐')\n                .layoutWeight(1)\n                .fontWeight(600)\n              this.MoreBuilder({ title: '查看全部' })\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n\n        GridCol() {\n          Column() {\n            Row() {\n              Text('体验')\n                .layoutWeight(1)\n                .fontWeight(600)\n              this.MoreBuilder({ title: '4 条测评' })\n            }\n            .padding(10)\n\n            Row()\n              .height(100)\n          }\n          .borderRadius(12)\n          .backgroundColor('#fff')\n        }\n      }\n    }\n    .height('100%')\n    .padding(15)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\nTIP\n * 使用 @Builder 复用逻辑的时候，支持传参可以更灵活的渲染UI\n * 参数可以使用状态数据，不过建议通过对象的方式传入 @Builder\n\n\n3. 构建函数-@BuilderParam 传递UI#\n\n> @BuilderParam 该装饰器用于声明任意UI描述的一个元素，类似 slot 占位符\n\n前置知识\n\n组件属性初始化：\n\n * 定义组件声明属性 title: string\n * 使用组件初始化属性 Comp({ title: string })\n\n * 尾随闭包初始化组件\n   \n   * 组件内有且仅有一个使用 @BuilderParam 装饰的属性\n\n * 参数初始化组件\n   \n   * 组件内有多个使用 @BuilderParam 装饰器属性\n\n1）尾随闭包初始化组件(默认插槽)\n\n需求：\n\n * 标题文字和更多文案通过属性传入\n\n * 内容结构需要传入\n\n@Component\nstruct PanelComp {\n  title: string\n  more: string\n  @BuilderParam\n  panelContent: () => void = this.DefaultPanelContent\n\n  // 备用 Builder\n  @Builder\n  DefaultPanelContent () {\n    Text('默认内容')\n  }\n\n  build() {\n    Column() {\n      Row() {\n        Text(this.title)\n          .layoutWeight(1)\n          .fontWeight(600)\n        Row() {\n          Text(this.more)\n            .fontSize(14)\n            .fontColor('#666666')\n          Image($r('app.media.ic_public_arrow_right'))\n            .width(16)\n            .fillColor('#666666')\n        }\n      }\n      .padding(10)\n\n      Row() {\n        this.panelContent()\n      }\n      .height(100)\n    }\n    .borderRadius(12)\n    .backgroundColor('#fff')\n  }\n}\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Column() {\n      GridRow({ columns: 2, gutter: 15 }) {\n        GridCol({ span: 2 }) {\n          PanelComp({ title: '评价（2000+）', more: '好评率98%' })\n        }\n\n        GridCol() {\n          PanelComp({ title: '推荐', more: '查看全部' }){\n            Text('推荐内容')\n          }\n        }\n\n        GridCol() {\n          PanelComp({ title: '体验', more: '4 条测评' }){\n            Text('体验内容')\n          }\n        }\n      }\n    }\n    .height('100%')\n    .padding(15)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\n2）参数初始化组件（具名插槽）\n\n需求：需要传入内容结构和底部结构\n\n@Component\nstruct PanelComp {\n  title: string\n  more: string\n  @BuilderParam\n  panelContent: () => void\n  @BuilderParam\n  panelFooter: () => void\n\n  build() {\n    Column() {\n      Row() {\n        Text(this.title)\n          .layoutWeight(1)\n          .fontWeight(600)\n        Row() {\n          Text(this.more)\n            .fontSize(14)\n            .fontColor('#666666')\n          Image($r('app.media.ic_public_arrow_right'))\n            .width(16)\n            .fillColor('#666666')\n        }\n      }\n      .padding(10)\n\n      Row() {\n        this.panelContent()\n      }\n      .height(100)\n      Row() {\n        this.panelFooter()\n      }\n      .height(50)\n    }\n    .borderRadius(12)\n    .backgroundColor('#fff')\n  }\n}\n\n@Entry\n@Component\nstruct Index {\n  @Builder\n  ContentBuilderA() {\n    Text('评价内容')\n  }\n  @Builder\n  FooterBuilderA() {\n    Text('评价底部')\n  }\n\n  build() {\n    Column() {\n      GridRow({ columns: 2, gutter: 15 }) {\n        GridCol({ span: 2 }) {\n          PanelComp({\n            title: '评价（2000+）',\n            more: '好评率98%',\n            panelFooter: this.FooterBuilderA,\n            panelContent: this.ContentBuilderA\n          })\n        }\n\n        // GridCol() {\n        //   PanelComp({ title: '推荐', more: '查看全部' }){\n        //     Text('推荐内容')\n        //   }\n        // }\n        //\n        // GridCol() {\n        //   PanelComp({ title: '体验', more: '4 条测评' }){\n        //     Text('体验内容')\n        //   }\n        // }\n      }\n    }\n    .height('100%')\n    .padding(15)\n    .backgroundColor('#f5f5f5')\n  }\n}\n\n\nTIP\n * 当子组件使用一个 @BuilderParam 的时候，使用组件的时候在尾随 {} 插入UI结构\n * 当子组件使用多个 @BuilderParam 的时候，使用组件的时候 Comp({ xxx: this.builderFn }) 传入\n * 子组件本身可以提供一个默认的 @Builder 函数作为 @BuilderParam 备用函数，当做备用内容使用\n\n\n4. 构建函数-系统组件自定义UI#\n\n> 在一些系统组件中，根据配置无法达到预期UI，可以使用 @Builder 构建函数自定义UI，前提该组件支持自定义。\n\n需求：自定义 Tabs 组件的 TabBar UI结构\n\nclass ToolBarItem {\n  defaultIcon: string | Resource\n  activeIcon: string | Resource\n  label: string\n}\n\n@Entry\n@Component\nstruct Index {\n  @State\n  activeIndex: number = 0\n  toolBars: ToolBarItem[] = [\n    { defaultIcon: $r('app.media.home'), activeIcon: $r('app.media.home_select'), label: '首页' },\n    { defaultIcon: $r('app.media.project'), activeIcon: $r('app.media.project_select'), label: '项目' },\n    { defaultIcon: $r('app.media.interview'), activeIcon: $r('app.media.interview_select'), label: '面经' },\n    { defaultIcon: $r('app.media.mine'), activeIcon: $r('app.media.mine_select'), label: '我的' }\n  ]\n\n  @Builder\n  TabBarBuilder(item: ToolBarItem, index: number) {\n    Column() {\n      Image(this.activeIndex === index ? item.activeIcon : item.defaultIcon)\n        .width(24)\n      Text(item.label)\n        .fontSize(12)\n        .margin({ top: 4 })\n        .lineHeight(12)\n        .fontColor(this.activeIndex === index ? '#000' : '#aaa')\n    }\n  }\n\n  build() {\n    Tabs({\n      index: this.activeIndex\n    }) {\n      ForEach(this.toolBars, (item: ToolBarItem, index: number) => {\n        TabContent() {\n          Text(index.toString())\n        }\n        .tabBar(this.TabBarBuilder(item, index))\n      })\n    }\n    .barPosition(BarPosition.End)\n    .onChange(index => this.activeIndex = index)\n  }\n}\n\n\n\n组件状态共享#\n\n\n1. 状态共享-父子单向#\n\n> @Prop 装饰的变量可以和父组件建立单向的同步关系。@Prop 装饰的变量是可变的，但是变化不会同步回其父组件。\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  money: number = 0\n\n  build() {\n    Column({ space: 20 }){\n      Text('父组件：' + this.money)\n        .onClick(() => {\n          this.money ++\n        })\n      Child({ money: this.money })\n    }\n    .width('100%')\n    .height('100%')\n    .alignItems(HorizontalAlign.Center)\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n@Component\nstruct Child {\n\n  @Prop\n  money: number\n\n  build() {\n    Text('子组件：' + this.money)\n      .onClick(() => {\n        this.money ++\n      })\n  }\n}\n\n\nTIP\n * 支持类型 string、number、boolean、enum 类型\n * 子组件可修改 Prop 数据值，但不同步到父组件，父组件更新后覆盖子组件 Prop 数据\n * 子组件可以初始化默认值，注意：目前编译器会提示错误，请忽略，下个版本将修复\n\n\n2. 状态共享-父子双向#\n\n> 子组件中被@Link装饰的变量与其父组件中对应的数据源建立双向数据绑定。\n\n1）简单类型 string、number、boolean、enum\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  money: number = 0\n\n  build() {\n    Column({ space: 20 }){\n      Text('父组件：' + this.money)\n        .onClick(() => {\n          this.money ++\n        })\n      Child({ money: $money })\n    }\n    .width('100%')\n    .height('100%')\n    .alignItems(HorizontalAlign.Center)\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n@Component\nstruct Child {\n\n  @Link\n  money: number\n\n  build() {\n    Text('子组件：' + this.money)\n      .onClick(() => {\n        this.money ++\n      })\n  }\n}\n\n\n2）复杂类型 Object、class\n\nclass Person {\n  name: string\n  age: number\n}\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  person: Person = { name: 'jack', age: 18 }\n\n  build() {\n    Column({ space: 20 }){\n      Text('父组件：' + `${this.person.name} 今年 ${ this.person.age } 岁`)\n        .onClick(() => {\n          this.person.age ++\n        })\n      Child({ person: $person })\n    }\n    .width('100%')\n    .height('100%')\n    .alignItems(HorizontalAlign.Center)\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n@Component\nstruct Child {\n\n  @Link\n  person: Person\n\n  build() {\n    Text('子组件：' +  `${this.person.name} 今年 ${ this.person.age } 岁`)\n      .onClick(() => {\n        this.person.age ++\n      })\n  }\n}\n\n\nTIP\n * 父组件传值的时候需要 this. 改成 $，子组件 @Link 修饰数据\n\n\n3. 状态共享-后代组件#\n\n> @Provide 和 @Consume，应用于与后代组件的双向数据同步，应用于状态数据在多个层级之间传递的场景。\n\n1）通过相同的变量名绑定\n\n@Entry\n@Component\nstruct Index {\n  @Provide\n  money: number = 0\n\n  build() {\n    Column({ space: 20 }) {\n      Text('父组件：' + this.money)\n        .onClick(() => {\n          this.money++\n        })\n      Parent()\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n@Component\nstruct Parent {\n  @Consume\n  money: number\n\n  build() {\n    Column({ space: 20 }) {\n      Text('父组件：' + this.money)\n        .onClick(() => {\n          this.money++\n        })\n      Child()\n    }\n  }\n}\n\n@Component\nstruct Child {\n  @Consume\n  money: number\n\n  build() {\n    Text('子组件：' + this.money)\n      .onClick(() => {\n        this.money++\n      })\n  }\n}\n\n\nTIP\n * Object、class、string、number、boolean、enum 类型均支持\n * 通过相同的变量别名绑定 @Provide('key') 和 @Consume('key') key需要保持一致\n\n\n4. 状态共享-状态监听器#\n\n> 如果开发者需要关注某个状态变量的值是否改变，可以使用 @Watch 为状态变量设置回调函数。\n\n * @State、@Prop、@Link 等装饰器在 @Watch 装饰之前\n\n\n\n@Component\nstruct Child {\n  @Prop\n  @Watch('onActiveIndex')\n  activeIndex: number\n\n  onActiveIndex() {\n    promptAction.showToast({ message: '监听变化' })\n  }\n\n  build() {\n    Column() {\n      Text('Child' + this.activeIndex)\n    }\n  }\n}\n\n@Entry\n@Component\nstruct Index {\n  @State activeIndex: number = 0\n\n  onChange (index: number) {\n    this.activeIndex = index\n    promptAction.showToast({ message: '点击' })\n  }\n\n  build() {\n    Navigation() {\n      Child({ activeIndex: this.activeIndex })\n    }.toolBar({\n      items: [\n        { value: '首页', action: () => this.onChange(0) },\n        { value: '我的', action: () => this.onChange(1) },\n      ]\n    })\n  }\n}\n\n\nTIP\n * 在第一次初始化的时候，@Watch装饰的方法不会被调用\n\n\n5. @Observed与@ObjectLink#\n\n> 之前我们通过 赋值的方式 修改嵌套对象或对象数组这类复杂数据来更新UI，会影响对象对应所有UI更新； 通过 @Observed 与 @ObjectLink\n> 可以优化这个问题；\n\n使用步骤：\n\n * 类 class 数据模拟需要定义通过构造函数，使用 @Observed 修饰这个类\n\n * 初始化数据：需要通过初始化构造函数的方式添加\n\n * 通过 @ObjectLink 关联对象，可以直接修改被关联对象来更新UI\n\n需求：改造下知乎评论案例\n\n1）定义构造函数和使用@Observed 修饰符，以及初始化数据\n\n@Observed\nexport class ReplyItem {\n  id: number\n  avatar: string | Resource\n  author: string\n  content: string\n  time: string\n  area: string\n  likeNum: number\n  likeFlag?: boolean\n\n  constructor(item: ReplyItem) {\n    for (const key in item) {\n      this[key] = item[key]\n    }\n  }\n}\n\nexport const replyList: ReplyItem[] = [\n  new ReplyItem({\n    id: 1,\n    avatar: 'https://picx.zhimg.com/027729d02bdf060e24973c3726fea9da_l.jpg?source=06d4cd63',\n    author: '偏执狂-妄想家',\n    content: '更何况还分到一个摩洛哥[惊喜]',\n    time: '11-30',\n    area: '海南',\n    likeNum: 34\n  }),\n  new ReplyItem({\n    id: 2,\n    avatar: 'https://pic1.zhimg.com/v2-5a3f5190369ae59c12bee33abfe0c5cc_xl.jpg?source=32738c0c',\n    author: 'William',\n    content: '当年希腊可是把1：0发挥到极致了',\n    time: '11-29',\n    area: '北京',\n    likeNum: 58\n  }),\n  new ReplyItem({\n    id: 3,\n    avatar: 'https://picx.zhimg.com/v2-e6f4605c16e4378572a96dad7eaaf2b0_l.jpg?source=06d4cd63',\n    author: 'Andy Garcia',\n    content: '欧洲杯其实16队球队打正赛已经差不多，24队打正赛意味着正赛阶段在小组赛一样有弱队。',\n    time: '11-28',\n    area: '上海',\n    likeNum: 10\n  }),\n  new ReplyItem({\n    id: 4,\n    avatar: 'https://picx.zhimg.com/v2-53e7cf84228e26f419d924c2bf8d5d70_l.jpg?source=06d4cd63',\n    author: '正宗好鱼头',\n    content: '确实眼红啊，亚洲就没这种球队，让中国队刷',\n    time: '11-27',\n    area: '香港',\n    likeNum: 139\n  }),\n  new ReplyItem({\n    id: 5,\n    avatar: 'https://pic1.zhimg.com/v2-eeddfaae049df2a407ff37540894c8ce_l.jpg?source=06d4cd63',\n    author: '柱子哥',\n    content: '我是支持扩大的，亚洲杯欧洲杯扩到32队，世界杯扩到64队才是好的，世界上有超过200支队伍，欧洲区55支队伍，亚洲区47支队伍，即使如此也就六成出现率',\n    time: '11-27',\n    area: '旧金山',\n    likeNum: 29\n  }),\n  new ReplyItem({\n    id: 6,\n    avatar: 'https://picx.zhimg.com/v2-fab3da929232ae911e92bf8137d11f3a_l.jpg?source=06d4cd63',\n    author: '飞轩逸',\n    content: '禁止欧洲杯扩军之前，应该先禁止世界杯扩军，或者至少把亚洲名额一半给欧洲。',\n    time: '11-26',\n    area: '里约',\n    likeNum: 100\n  })\n]\n\n\n2）嵌套的对象，或者数组中的对象，传入子组件，组件使用 @ObjectLink 修饰符获取数据\n\n\n\n\n\n@Entry\n@Component\nstruct Index {\n  @State\n  replyList: ReplyItem[] = replyList\n  @State\n  content: string = ''\n\n  onReply() {\n    const reply: ReplyItem = new ReplyItem({\n      id: Math.random(),\n      content: this.content,\n      author: 'Zhousg',\n      avatar: $r('app.media.avatar'),\n      time: '12-01',\n      likeNum: 0,\n      area: '北京'\n    })\n    this.replyList.unshift(reply)\n    this.content = ''\n    promptAction.showToast({ message: '回复成功' })\n  }\n\n  build() {\n    Stack() {\n      Scroll() {\n        Column() {\n          NavComp()\n          CommentComp()\n          // space\n          Divider()\n            .strokeWidth(8)\n            .color('#f5f5f5')\n          // reply\n          Column() {\n            Text('回复 7')\n              .width('100%')\n              .margin({ bottom: 15 })\n              .fontWeight(500)\n            ForEach(this.replyList, (item: ReplyItem) => {\n              ReplyComp({ item })\n            })\n          }\n          .padding({ left: 15, right: 15, top: 15 })\n        }\n      }\n      .padding({ bottom: 50 })\n\n      Row() {\n        TextInput({ placeholder: '回复~', text: this.content })\n          .placeholderColor('#c3c4c5')\n          .layoutWeight(1)\n          .onChange((value) => {\n            this.content = value\n          })\n        Text('发布')\n          .fontSize(14)\n          .fontColor('#09f')\n          .margin({ left: 15 })\n          .onClick(() => {\n            this.onReply()\n          })\n      }\n      .width('100%')\n      .height(50)\n      .padding({ left: 15, right: 15 })\n      .position({ y: '100%' })\n      .translate({ y: -50 })\n      .backgroundColor('#fff')\n      .border({ width: { top: 0.5 }, color: '#e4e4e4' })\n    }\n\n  }\n}\n\n@Component\nstruct ReplyComp {\n  @ObjectLink\n  item: ReplyItem\n\n  onLike() {\n    if (this.item.likeFlag) {\n      this.item.likeNum--\n      this.item.likeFlag = false\n      promptAction.showToast({ message: '取消点赞' })\n    } else {\n      this.item.likeNum++\n      this.item.likeFlag = true\n      promptAction.showToast({ message: '点赞成功' })\n    }\n  }\n\n  build() {\n    Row() {\n      Image(this.item.avatar)\n        .width(32)\n        .height(32)\n        .borderRadius(16)\n      Column() {\n        Text(this.item.author)\n          .fontSize(15)\n          .fontWeight(FontWeight.Bold)\n          .margin({ bottom: 5 })\n        Text(this.item.content)\n          .margin({ bottom: 5 })\n          .fontColor('#565656')\n          .lineHeight(20)\n        Row() {\n          Text(`${this.item.time}•IP 属地${this.item.area}`)\n            .layoutWeight(1)\n            .fontSize(14)\n            .fontColor('#c3c4c5')\n          Row() {\n            Image($r('app.media.heart'))\n              .width(14)\n              .height(14)\n              .fillColor(this.item.likeFlag ? '#ff6600' : '#c3c4c5')\n              .margin({ right: 4 })\n            Text(this.item.likeNum.toString())\n              .fontSize(14)\n              .fontColor(this.item.likeFlag ? '#ff6600' : '#c3c4c5')\n          }\n          .onClick(() => {\n            this.onLike()\n          })\n        }\n      }\n      .layoutWeight(1)\n      .padding({ left: 10 })\n      .alignItems(HorizontalAlign.Start)\n    }\n    .width('100%')\n    .padding({ bottom: 15 })\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n@Component\nstruct NavComp {\n  build() {\n    // nav\n    Row() {\n      Row() {\n        Image($r('app.media.ic_public_arrow_left'))\n          .width(12)\n          .height(12)\n          .fillColor('#848484')\n      }\n      .width(24)\n      .height(24)\n      .borderRadius(12)\n      .backgroundColor('#f5f5f5')\n      .justifyContent(FlexAlign.Center)\n      .margin({ left: 13 })\n\n      Text('评论回复')\n        .padding({ right: 50 })\n        .textAlign(TextAlign.Center)\n        .fontSize(18)\n        .layoutWeight(1)\n    }\n    .height(50)\n\n  }\n}\n\n@Component\nstruct CommentComp {\n  build() {\n    // comment\n    Row() {\n      Image('https://picx.zhimg.com/1754b6bd9_xl.jpg?source=c885d018')\n        .width(32)\n        .height(32)\n        .borderRadius(16)\n      Column() {\n        Text('欧洲足球锦标赛')\n          .fontSize(15)\n          .fontWeight(FontWeight.Bold)\n          .margin({ bottom: 5 })\n        Text('14-0！欧洲杯超级惨案+刷爆纪录！姆巴佩帽子戏法，法国7连胜，怎么评价这场比赛？')\n          .margin({ bottom: 5 })\n          .fontColor('#565656')\n          .lineHeight(20)\n        Row() {\n          Text('10-21•IP 属地辽宁')\n            .layoutWeight(1)\n            .fontSize(14)\n            .fontColor('#c3c4c5')\n          Row() {\n            Image($r('app.media.heart'))\n              .width(14)\n              .height(14)\n              .fillColor('#c3c4c5')\n              .margin({ right: 4 })\n            Text('100')\n              .fontSize(14)\n              .fontColor('#c3c4c5')\n          }\n        }\n      }\n      .layoutWeight(1)\n      .padding({ left: 10 })\n      .alignItems(HorizontalAlign.Start)\n    }\n    .width('100%')\n    .padding({ left: 15, right: 15, bottom: 15 })\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n\n注意：\n * 对象需要通过构造函数初始化\n * 需要嵌套组件，因为需要使用 @ObjectLink\n\n\n应用状态#\n\nTIP\n\n关于应用状态相关的内容需要使用模拟器或真机调试\n\n\n1. UIAbility内状态-LocalStorage#\n\n> LocalStorage 是页面级的UI状态存储，通过 @Entry 装饰器接收的参数可以在页面内共享同一个 LocalStorage 实例。\n> LocalStorage 也可以在 UIAbility 内，页面间共享状态。\n\n1）页面内共享\n\n * 创建 LocalStorage 实例：const storage = new LocalStorage({ key: value })\n * 单向 @LocalStorageProp('user') 组件内可变\n * 双向 @LocalStorageLink('user') 全局均可变\n\nclass User {\n  name?: string\n  age?: number\n}\nconst storage = new LocalStorage({\n  user: { name: 'jack', age: 18 }\n})\n\n@Entry(storage)\n@Component\nstruct Index {\n  @LocalStorageProp('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }){\n      Text('Index：')\n      Text(this.user.name + this.user.age)\n      Divider()\n      ChildA()\n      Divider()\n      ChildB()\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n@Component\nstruct ChildA {\n  @LocalStorageProp('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }){\n      Text('ChildA：')\n      Text(this.user.name + this.user.age)\n        .onClick(()=>{\n          this.user.age ++\n        })\n    }\n  }\n}\n\n@Component\nstruct ChildB {\n  @LocalStorageLink('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }){\n      Text('ChildB：')\n      Text(this.user.name + this.user.age)\n        .onClick(()=>{\n          this.user.age ++\n        })\n    }\n  }\n}\n\n\n2）页面间共享\n\n * 在 UIAbility 创建 LocalStorage 通过 loadContent 提供给加载的窗口\n\n * 在页面使用 const storage = LocalStorage.GetShared() 得到实例，通过 @Entry(storage) 传入页面\n\n+  storage = new LocalStorage({\n+    user: { name: 'jack', age: 18 }\n+  })\n\n  onWindowStageCreate(windowStage: window.WindowStage) {\n    // Main window is created, set main page for this ability\n    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onWindowStageCreate');\n\n+    windowStage.loadContent('pages/Index', this.storage , (err, data) => {\n      if (err.code) {\n        hilog.error(0x0000, 'testTag', 'Failed to load the content. Cause: %{public}s', JSON.stringify(err) ?? '');\n        return;\n      }\n      hilog.info(0x0000, 'testTag', 'Succeeded in loading the content. Data: %{public}s', JSON.stringify(data) ?? '');\n    });\n  }\n\n\nexport class User {\n  name?: string\n  age?: number\n}\n\n\n\nconst storage = LocalStorage.GetShared()\n\n@Entry(storage)\n@Component\nstruct Index {\n  @LocalStorageProp('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }) {\n      Text('Index：')\n      Text(this.user.name + this.user.age)\n        .onClick(()=>{\n          this.user.age ++\n        })\n      Navigator({ target: 'pages/OtherPage' }){\n        Text('Go Other Page')\n      }\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\nconst storage = LocalStorage.GetShared()\n\n@Entry(storage)\n@Component\nstruct OtherPage {\n  @LocalStorageLink('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }) {\n      Text('OtherPage：')\n      Text(this.user.name + this.user.age)\n        .onClick(()=>{\n          this.user.age ++\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\nTIP\n * 页面间共享需要要模拟器测试\n * 应用逻辑中使用参考 链接\n\n\n2. 应用状态-AppStorage#\n\n> AppStorage 是应用全局的UI状态存储，是和应用的进程绑定的，由UI框架在应用程序启动时创建，为应用程序UI状态属性提供中央存储。\n\n * 如果是初始化使用 AppStorage.SetOrCreate(key,value)\n * 单向 @StorageProp('user') 组件内可变\n * 双向 @StorageLink('user') 全局均可变\n\n1）通过UI装饰器使用\n\n\n\nAppStorage.SetOrCreate('user', { name: 'jack', age: 18 })\n\n@Entry\n@Component\nstruct Index {\n  @StorageProp('user')\n  // 可忽略，编辑器类型错误\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }) {\n      Text('Index：')\n      Text(this.user.name + this.user.age)\n        .onClick(() => {\n          this.user.age++\n        })\n      Divider()\n      ChildA()\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n@Component\nstruct ChildA {\n  @StorageLink('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }){\n      Text('ChildA：')\n      Text(this.user.name + this.user.age)\n        .onClick(()=>{\n          this.user.age ++\n        })\n    }\n  }\n}\n\n\n2）通过逻辑使用\n\n * AppStorage.Get(key) 获取数据\n * AppStorage.Set(key,value) 覆盖数据\n * const link: SubscribedAbstractProperty = AppStorage.Link(key) 覆盖数据\n   * link.set(value) 修改\n   * link.get() 获取\n\n\n\n\nAppStorage.SetOrCreate('user', { name: 'jack', age: 18 })\n\n@Entry\n@Component\nstruct Index {\n  @StorageLink('user')\n  user: User = {}\n\n  build() {\n    Column({ space: 15 }) {\n      Text('Index：')\n      Text(this.user.name + this.user.age)\n        .onClick(() => {\n          this.user.age++\n        })\n      Divider()\n      Text('Get()')\n        .onClick(() => {\n          // 仅获取\n          const user = AppStorage.Get('user')\n          promptAction.showToast({\n            message: JSON.stringify(user)\n          })\n        })\n      Text('Set()')\n        .onClick(() => {\n          // 直接设置\n          AppStorage.Set('user', {\n            name: 'tom',\n            age: 100\n          })\n          // 观察页面更新没\n        })\n      Text('Link()')\n        .onClick(() => {\n          // 获取user的prop\n          const user: SubscribedAbstractProperty = AppStorage.Link('user')\n          user.set({\n            name: user.get().name,\n            // 获取后修改\n            age: user.get().age + 1\n          })\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n3. 状态持久化-PersistentStorage#\n\n> PersistentStorage 将选定的 AppStorage 属性保留在设备磁盘上。\n\nDETAILS\n\nUI和业务逻辑不直接访问 PersistentStorage 中的属性，所有属性访问都是对 AppStorage 的访问，AppStorage\n中的更改会自动同步到 PersistentStorage。\n\nWARNING\n * 支持：number, string, boolean, enum 等简单类型;\n * 如果：要支持对象类型，可以转换成json字符串\n * 持久化变量最好是小于2kb的数据，如果开发者需要存储大量的数据，建议使用数据库api。\n\n1）简单数据类型的持久化，和获取和修改\n\n\n\nPersistentStorage.PersistProp('count', 100)\n\n@Entry\n@Component\nstruct Index {\n  @StorageLink('count')\n  count: number = 0\n\n  build() {\n    Column({ space: 15 }) {\n      Text(this.count.toString())\n        .onClick(() => {\n          this.count++\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n2）复杂数据类型的持久化，和获取和修改\n\n\n\n\nPersistentStorage.PersistProp('userJson', `{ \"name\": \"jack\", \"age\": 18 }`)\n\n@Entry\n@Component\nstruct Index {\n  @StorageProp('userJson')\n  @Watch('onUpdateUser')\n  userJson: string = '{}'\n  @State\n  user: User = JSON.parse(this.userJson)\n\n  onUpdateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n\n  build() {\n    Column({ space: 15 }) {\n      Text('Index：')\n      Text(this.user.name + this.user.age)\n        .onClick(() => {\n          this.user.age++\n          // 修改\n          AppStorage.Set('userJson', JSON.stringify(this.user))\n        })\n      Divider()\n      Text('Get()')\n        .onClick(() => {\n          // 获取\n          const user = AppStorage.Get('userJson')\n          promptAction.showToast({ message: user })\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\nTIP\n * 测试：需要在真机或模拟器调试\n\n\n4. 设备环境-Environment#\n\n> 开发者如果需要应用程序运行的设备的环境参数，以此来作出不同的场景判断，比如多语言，暗黑模式等，需要用到 Environment 设备环境查询。\n\n * Environment 的所有属性都是不可变的（即应用不可写入），所有的属性都是简单类型。\n\n\n// 获取系统语言\nconst lang = i18n.getSystemLanguage()\n// 设置环境状态\nEnvironment.EnvProp('lang', lang);\n\n@Entry\n@Component\nstruct Index{\n  @StorageProp('lang')\n  lang: string = ''\n\n  build() {\n    Column() {\n      Text(this.lang)\n        .onClick(()=>{\n          // 不能修改\n          // Environment.EnvProp('lang', 'en');\n        })\n    }\n    .width('100%')\n    .height('100%')\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n\n网络管理#\n\n\n1. 应用权限#\n\n> ATM (AccessTokenManager) 是HarmonyOS上基于AccessToken构建的统一的应用权限管理能力。\n\n应用权限保护的对象可以分为数据和功能：\n\n * 数据包含了个人数据（如照片、通讯录、日历、位置等）、设备数据（如设备标识、相机、麦克风等）、应用数据。\n\n * 功能则包括了设备功能（如打电话、发短信、联网等）、应用功能（如弹出悬浮框、创建快捷方式等）等。\n\n根据授权方式的不同，权限类型可分为system_grant（系统授权）和user_grant（用户授权）。\n\n * 配置文件权限声明\n\n * 向用户申请授权\n\n例如：访问网络需要联网权限\n\n{\n  \"module\" : {\n    // ...\n    \"requestPermissions\":[\n      {\n        \"name\" : \"ohos.permission.INTERNET\"\n      }\n    ]\n  }\n}\n\n\nTIP\n * 应用权限列表\n\n\n2. HTTP请求#\n\n> 请求服务器需要使用 IP 地址，或者域名。不可使用 localhost 或 127.0.0.1\n\n1）启动 json-server 服务，npm i json-server -g 全局安装。\n\n * 新建 data.json 文件在任意目录，比如 server 文件夹\n\n{\n  \"takeaway\": [\n    {\n      \"tag\": \"318569657\",\n      \"name\": \"一人套餐\",\n      \"foods\": [\n        {\n          \"id\": 8078956697,\n          \"name\": \"烤羊肉串(10串)\",\n          \"like_ratio_desc\": \"好评度100%\",\n          \"month_saled\": 40,\n          \"unit\": \"10串\",\n          \"food_tag_list\": [\n            \"点评网友推荐\"\n          ],\n          \"price\": 90,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/8078956697.jpg\",\n          \"description\": \"\",\n          \"tag\": \"318569657\",\n          \"count\": 1\n        },\n        {\n          \"id\": 7384994864,\n          \"name\": \"腊味煲仔饭\",\n          \"like_ratio_desc\": \"好评度81%\",\n          \"month_saled\": 100,\n          \"unit\": \"1人份\",\n          \"food_tag_list\": [],\n          \"price\": 39,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/7384994864.jpg\",\n          \"description\": \"\",\n          \"tag\": \"318569657\",\n          \"count\": 1\n        },\n        {\n          \"id\": 2305772036,\n          \"name\": \"鸡腿胡萝卜焖饭\",\n          \"like_ratio_desc\": \"好评度91%\",\n          \"month_saled\": 300,\n          \"unit\": \"1人份\",\n          \"food_tag_list\": [],\n          \"price\": 34.32,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/2305772036.jpg\",\n          \"description\": \"主料：大米、鸡腿、菜心、胡萝卜\",\n          \"tag\": \"318569657\",\n          \"count\": 1\n        },\n        {\n          \"id\": 2233861812,\n          \"name\": \"小份酸汤莜面鱼鱼+肉夹馍套餐\",\n          \"like_ratio_desc\": \"好评度73%\",\n          \"month_saled\": 600,\n          \"unit\": \"1人份\",\n          \"food_tag_list\": [\n            \"“口味好,包装很好～点赞”\"\n          ],\n          \"price\": 34.32,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/2233861812.jpg\",\n          \"description\": \"酸汤莜面鱼鱼，主料：酸汤、莜面 肉夹馍，主料：白皮饼、猪肉\",\n          \"tag\": \"318569657\",\n          \"count\": 1\n        }\n      ]\n    },\n    {\n      \"tag\": \"82022594\",\n      \"name\": \"特色烧烤\",\n      \"foods\": [\n        {\n          \"id\": 3823780596,\n          \"name\": \"藤椒鸡肉串\",\n          \"like_ratio_desc\": \"\",\n          \"month_saled\": 200,\n          \"unit\": \"10串\",\n          \"food_tag_list\": [\n            \"点评网友推荐\"\n          ],\n          \"price\": 6,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/3823780596.jpg\",\n          \"description\": \"1串。藤椒味，主料：鸡肉\",\n          \"tag\": \"82022594\",\n          \"count\": 1\n        },\n        {\n          \"id\": 6592009498,\n          \"name\": \"烤羊排\",\n          \"like_ratio_desc\": \"\",\n          \"month_saled\": 50,\n          \"unit\": \"1人份\",\n          \"food_tag_list\": [],\n          \"price\": 169,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/6592009498.jpg\",\n          \"description\": \"6-8个月草原羔羊肋排，烤到皮脆肉香\",\n          \"tag\": \"82022594\",\n          \"count\": 1\n        }\n      ]\n    },\n    {\n      \"tag\": \"98147100\",\n      \"name\": \"杂粮主食\",\n      \"foods\": [\n        {\n          \"id\": 4056954171,\n          \"name\": \"五常稻花香米饭\",\n          \"like_ratio_desc\": \"\",\n          \"month_saled\": 1000,\n          \"unit\": \"约300克\",\n          \"food_tag_list\": [],\n          \"price\": 5,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/4056954171.jpg\",\n          \"description\": \"浓浓的稻米清香，软糯Q弹有嚼劲\",\n          \"tag\": \"98147100\",\n          \"count\": 1\n        },\n        {\n          \"id\": 740430262,\n          \"name\": \"小米发糕(3个)\",\n          \"like_ratio_desc\": \"好评度100%\",\n          \"month_saled\": 100,\n          \"unit\": \"3块\",\n          \"food_tag_list\": [],\n          \"price\": 13,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/740430262.jpg\",\n          \"description\": \"柔软蓬松，葡萄干和蔓越莓酸甜适口\",\n          \"tag\": \"98147100\",\n          \"count\": 1\n        },\n        {\n          \"id\": 7466390504,\n          \"name\": \"沙枣玉米窝头(3个)\",\n          \"like_ratio_desc\": \"好评度100%\",\n          \"month_saled\": 100,\n          \"unit\": \"3个\",\n          \"food_tag_list\": [],\n          \"price\": 13,\n          \"picture\": \"https://zqran.gitee.io/images/waimai/7466390504.jpg\",\n          \"description\": \"\",\n          \"tag\": \"98147100\",\n          \"count\": 1\n        }\n      ]\n    }\n  ]\n}\n\n\n * 进入 server 文件夹，按照下面命令启动接口服务器，查看本机IP ipconfig | ifconfig\n\njson-server data.json --host 192.168.0.1\n\n\n2）使用 @ohos.net.http 模块发请求\n\nTIP\n\n备用地址：https://zhoushugang.gitee.io/fe2022/takeaway.json\n\n\n\nconst req = http.createHttp()\nreq.request('https://zhoushugang.gitee.io/fe2022/takeaway.json')\n  .then(res => {\n    console.log('MEITUAN', res.result.toString().replace(/\\n/g, '').substr(0, 250))  // === 3  注意：字符长度大于1024字节，控制台不可见。\n    const data = JSON.parse(res.result as string)\n    console.log('MEITUAN', data.length)\n  })\n  .catch(err => {\n    console.error('MEITUAN', err.message)\n  })\n","frontmatter":{"title":"HM - 鸿蒙-状态管理"},"version":""},{"id":5,"title":"HM - 鸿蒙-知乎评论","routePath":"/interview-handbook-project/guide/zhihu","lang":"","toc":[{"text":"阶段案例-知乎回复","id":"阶段案例-知乎回复","depth":2,"charIndex":3},{"text":"1. 底部输入区域","id":"1-底部输入区域","depth":3,"charIndex":16},{"text":"2. 静态回复列表","id":"2-静态回复列表","depth":3,"charIndex":2471},{"text":"3. 实现渲染","id":"3-实现渲染","depth":3,"charIndex":3571},{"text":"4. 实现点赞","id":"4-实现点赞","depth":3,"charIndex":8325},{"text":"6. 进行回复","id":"6-进行回复","depth":3,"charIndex":9074}],"domain":"","content":"#\n\n\n阶段案例-知乎回复#\n\n\n1. 底部输入区域#\n\n * 抽离 Nav Comment 组件\n * 使用 Stack 组件底部输入框固定在下方\n * 加上 Scroll 将来页面内容可以滚动\n\n@Entry\n@Component\nstruct Index {\n  build() {\n    Stack({ alignContent: Alignment.Bottom }) {\n      Column() {\n        Scroll() {\n          Column() {\n            // 导航\n            NavComp()\n            // 评论\n            CommentComp()\n            // 分割线\n            Divider()\n              .strokeWidth(8)\n              .color('#f5f5f5')\n            // 回复列表\n            \n          }\n          .padding({ bottom: 50 })\n        }\n      }\n      .width('100%')\n      .height('100%')\n\n      Row({ space: 15 }){\n        TextInput({ placeholder: '回复~' })\n          .layoutWeight(1)\n        Text('发布')\n          .fontColor('#069')\n      }\n      .padding({ left: 15, right: 15 })\n      .width('100%')\n      .height(50)\n      .backgroundColor('#fff')\n      .border({ width: { top: 0.5 }, color: '#e4e4e4' })\n    }\n\n  }\n}\n\n// 导航\n@Component\nstruct NavComp {\n  build() {\n    Row() {\n      Row() {\n        Image($r('app.media.ic_public_arrow_left'))\n          .width(16)\n          .aspectRatio(1)\n        // svg 图标可以使用填充颜色\n        // .fillColor('red')\n      }\n      .width(24)\n      .aspectRatio(1)\n      .backgroundColor('#f5f5f5')\n      .borderRadius(12)\n      .justifyContent(FlexAlign.Center)\n      .margin({ left: 16 })\n\n      Text('评论回复')\n        .layoutWeight(1)\n        .textAlign(TextAlign.Center)\n        .padding({ right: 40 })\n    }\n    .height(40)\n    .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })\n  }\n}\n\n// 评论\n@Component\nstruct CommentComp {\n  build() {\n    Row() {\n      Image($r('app.media.avatar'))\n        .width(32)\n        .aspectRatio(1)\n        .borderRadius(16)\n      Column({ space: 5 }) {\n        Text('周杰伦')\n          .width('100%')\n          .fontWeight(FontWeight.Bold)\n          .fontSize(15)\n        Text('大理石能雕刻出肌肉和皮肤的质感，那个年代的工匠好牛啊')\n          .width('100%')\n        Row() {\n          Text('10-21 · IP属地北京')\n            .fontSize(12)\n            .fontColor('#c3c4c5')\n          Row({ space: 4 }) {\n            Image($r('app.media.ic_public_heart'))\n              .width(14)\n              .aspectRatio(1)\n              .fillColor('#c3c4c5')\n            Text('100')\n              .fontSize(12)\n              .fontColor('#c3c4c5')\n          }\n        }\n        .width('100%')\n        .justifyContent(FlexAlign.SpaceBetween)\n      }\n      .layoutWeight(1)\n      .padding({ left: 10 })\n    }\n    .padding(15)\n    .alignItems(VerticalAlign.Top)\n  }\n}\n\n\n\n2. 静态回复列表#\n\n * 参考评论组件，使用 ForEach 循环相同的回复容器\n\nColumn() {\n  Text('回复 100')\n    .width('100%')\n    .fontWeight(600)\n  ForEach([1, 2, 3, 4, 5, 6, 7], () => {\n    Row() {\n      Image($r('app.media.avatar'))\n        .width(32)\n        .aspectRatio(1)\n        .borderRadius(16)\n      Column({ space: 5 }) {\n        Text('周杰伦')\n          .width('100%')\n          .fontWeight(FontWeight.Bold)\n          .fontSize(15)\n        Text('大理石能雕刻出肌肉和皮肤的质感，那个年代的工匠好牛啊')\n          .width('100%')\n        Row() {\n          Text('10-21 · IP属地北京')\n            .fontSize(12)\n            .fontColor('#c3c4c5')\n          Row({ space: 4 }) {\n            Image($r('app.media.ic_public_heart'))\n              .width(14)\n              .aspectRatio(1)\n              .fillColor('#c3c4c5')\n            Text('100')\n              .fontSize(12)\n              .fontColor('#c3c4c5')\n          }\n        }\n        .width('100%')\n        .justifyContent(FlexAlign.SpaceBetween)\n      }\n      .layoutWeight(1)\n      .padding({ left: 10 })\n    }\n    .padding({ top: 15, bottom: 15 })\n    .alignItems(VerticalAlign.Top)\n  })\n\n}\n.padding(15)\n\n\n\n3. 实现渲染#\n\n * 使用 class 定义好回复数据模型 ReplyItem\n * 初始化一些模拟数据\n * 完成页面渲染\n\nexport class ReplyItem {\n  id: number\n  avatar: string\n  author: string\n  content: string\n  time: string\n  area: string\n  likeNum: number\n  likeFlag?: boolean\n}\n\nexport const replyList: ReplyItem[] = [\n  {\n    id: 1,\n    avatar: 'https://picx.zhimg.com/027729d02bdf060e24973c3726fea9da_l.jpg?source=06d4cd63',\n    author: '偏执狂-妄想家',\n    content: '更何况还分到一个摩洛哥[惊喜]',\n    time: '11-30',\n    area: '海南',\n    likeNum: 34\n  },\n  {\n    id: 2,\n    avatar: 'https://pic1.zhimg.com/v2-5a3f5190369ae59c12bee33abfe0c5cc_xl.jpg?source=32738c0c',\n    author: 'William',\n    content: '当年希腊可是把1：0发挥到极致了',\n    time: '11-29',\n    area: '北京',\n    likeNum: 58\n  },\n  {\n    id: 3,\n    avatar: 'https://picx.zhimg.com/v2-e6f4605c16e4378572a96dad7eaaf2b0_l.jpg?source=06d4cd63',\n    author: 'Andy Garcia',\n    content: '欧洲杯其实16队球队打正赛已经差不多，24队打正赛意味着正赛阶段在小组赛一样有弱队。',\n    time: '11-28',\n    area: '上海',\n    likeNum: 10\n  },\n  {\n    id: 4,\n    avatar: 'https://picx.zhimg.com/v2-53e7cf84228e26f419d924c2bf8d5d70_l.jpg?source=06d4cd63',\n    author: '正宗好鱼头',\n    content: '确实眼红啊，亚洲就没这种球队，让中国队刷',\n    time: '11-27',\n    area: '香港',\n    likeNum: 139\n  },\n  {\n    id: 5,\n    avatar: 'https://pic1.zhimg.com/v2-eeddfaae049df2a407ff37540894c8ce_l.jpg?source=06d4cd63',\n    author: '柱子哥',\n    content: '我是支持扩大的，亚洲杯欧洲杯扩到32队，世界杯扩到64队才是好的，世界上有超过200支队伍，欧洲区55支队伍，亚洲区47支队伍，即使如此也就六成出现率',\n    time: '11-27',\n    area: '旧金山',\n    likeNum: 29\n  },\n  {\n    id: 6,\n    avatar: 'https://picx.zhimg.com/v2-fab3da929232ae911e92bf8137d11f3a_l.jpg?source=06d4cd63',\n    author: '飞轩逸',\n    content: '禁止欧洲杯扩军之前，应该先禁止世界杯扩军，或者至少把亚洲名额一半给欧洲。',\n    time: '11-26',\n    area: '里约',\n    likeNum: 100\n  }\n]\n\n\n\n@Entry\n@Component\nstruct Index {\n\n  @State\n  replyList: ReplyItem[] = replyList\n\n  build() {\n    Stack({ alignContent: Alignment.Bottom }) {\n      Column() {\n        Scroll() {\n          Column() {\n            // 导航\n            NavComp()\n            // 评论\n            CommentComp()\n            // 分割线\n            Divider()\n              .strokeWidth(8)\n              .color('#f5f5f5')\n            // 回复列表\n            Column() {\n              Text('回复 100')\n                .width('100%')\n                .fontWeight(600)\n              ForEach(\n                this.replyList, \n                (item: ReplyItem) => {\n                  Row() {\n                    Image(item.avatar)\n                      .width(32)\n                      .aspectRatio(1)\n                      .borderRadius(16)\n                    Column({ space: 5 }) {\n                      Text(item.author)\n                        .width('100%')\n                        .fontWeight(FontWeight.Bold)\n                        .fontSize(15)\n                      Text(item.content)\n                        .width('100%')\n                      Row() {\n                        Text(`${item.time} · IP属地${item.area}`)\n                          .fontSize(12)\n                          .fontColor('#c3c4c5')\n                        Row({ space: 4 }) {\n                          Image($r('app.media.ic_public_heart'))\n                            .width(14)\n                            .aspectRatio(1)\n                            .fillColor('#c3c4c5')\n                          Text(item.likeNum.toString())\n                            .fontSize(12)\n                            .fontColor('#c3c4c5')\n                        }\n                      }\n                      .width('100%')\n                      .justifyContent(FlexAlign.SpaceBetween)\n                    }\n                    .layoutWeight(1)\n                    .padding({ left: 10 })\n                  }\n                  .padding({ top: 15, bottom: 15 })\n                  .alignItems(VerticalAlign.Top)\n                },\n                // key 有默认你规则\n                // key 为了元素复用\n                // 如果没有写，会自动生成一个key，index_ + JSON.stringify(item)，不建议不写\n                // (item: ReplyItem) => item.id.toString() 写一个ID做唯一标识，需要key也更新才能更新对应UI\n                // item => id + likeNum + likeFlag 把需要更新的字段合在一起当做key\n                // ({ id, likeNum, likeFlag }) => JSON.stringify({ id, likeNum, likeFlag })\n\n                // 学习了 @Observed @ObjectLink 这样也可以更新~\n                // (item: ReplyItem) => item.id.toString()\n              )\n\n            }\n            .padding(15)\n          }\n          .padding({ bottom: 50 })\n        }\n      }\n      .width('100%')\n      .height('100%')\n\n      Row({ space: 15 }){\n        TextInput({ placeholder: '回复~' })\n          .layoutWeight(1)\n        Text('发布')\n          .fontColor('#069')\n      }\n      .padding({ left: 15, right: 15 })\n      .width('100%')\n      .height(50)\n      .backgroundColor('#fff')\n      .border({ width: { top: 0.5 }, color: '#e4e4e4' })\n    }\n\n  }\n}\n\n\n\n4. 实现点赞#\n\n * 注册点赞区域点击事件\n * 通过索引复制的方式完成数据的更新和UI的更新\n\nonLike(item: ReplyItem) {\n  const reply = { ...item }\n  if (reply.likeFlag) {\n    reply.likeNum--\n    reply.likeFlag = false\n    promptAction.showToast({ message: '取消点赞' })\n  } else {\n    reply.likeNum++\n    reply.likeFlag = true\n    promptAction.showToast({ message: '点赞成功' })\n  }\n  const index = this.replyList.findIndex(rep => rep.id === reply.id)\n  this.replyList[index] = reply\n}\n\n\nRow({ space: 4 }) {\n  Image($r('app.media.heart'))\n    .width(14)\n    .height(14)\n    .fillColor(item.likeFlag ? '#ff6600' : '#c3c4c5')\n    .margin({ right: 4 })\n  Text(item.likeNum.toString())\n    .fontSize(14)\n    .fontColor(item.likeFlag ? '#ff6600' : '#c3c4c5')\n}\n.onClick(() => {\n  this.onLike(item)\n})\n\n\n\n6. 进行回复#\n\n * 收集输入框数据\n * 发布评论内容，和情况输入内容\n * 需要扩展头像类型兼容 Resource 类型\n\nexport class ReplyItem {\n  id: number\n+  avatar: string | Resource\n  author: string\n  content: string\n  time: string\n  area: string\n  likeNum: number\n  likeFlag?: boolean\n}\n\n\nonReply () {\n  const reply: ReplyItem = {\n    id: Math.random(),\n    content: this.content,\n    author: 'Zhousg',\n    avatar: $r('app.media.avatar'),\n    time: '12-01',\n    likeNum: 0,\n    area: '北京'\n  }\n  this.replyList.unshift(reply)\n  this.content = ''\n  promptAction.showToast({ message: '回复成功' })\n}\n\n\nRow({ spcae: 15 }) {\n  TextInput({ placeholder: '回复~', text: this.content })\n    .placeholderColor('#c3c4c5')\n    .layoutWeight(1)\n    .onChange((value) => {\n      this.content = value\n    })\n  Text('发布')\n    .fontSize(14)\n    .fontColor('#09f')\n    .onClick(()=>{\n      this.onReply()\n    })\n}\n","frontmatter":{"title":"HM - 鸿蒙-知乎评论"},"version":""},{"id":7,"title":"HM - 面试宝典APP-首页模块","routePath":"/interview-handbook-project/project/home","lang":"","toc":[{"text":"首页模块","id":"首页模块","depth":2,"charIndex":3},{"text":"1. 静态结构","id":"1-静态结构","depth":3,"charIndex":11},{"text":"2. 分类 Tabs 动态展示","id":"2-分类-tabs-动态展示","depth":3,"charIndex":1770},{"text":"3. 试题列表组件抽取","id":"3-试题列表组件抽取","depth":3,"charIndex":3688},{"text":"4. 试题列表加载","id":"4-试题列表加载","depth":3,"charIndex":6103},{"text":"5. 加载更多","id":"5-加载更多","depth":3,"charIndex":9049},{"text":"6. LazyForEach 性能优化","id":"6-lazyforeach-性能优化","depth":3,"charIndex":10132}],"domain":"","content":"#\n\n\n首页模块#\n\n\n1. 静态结构#\n\n1）轮播图\n\nRow() {\n  Swiper() {\n    Flex() {\n      Image('/common/images/banner_ai.png')\n        .objectFit(ImageFit.Fill)\n    }\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n\n    Flex() {\n      Image('/common/images/banner_pj.png')\n        .objectFit(ImageFit.Fill)\n    }\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n\n    Flex() {\n      Image('/common/images/banner_qa.png')\n        .objectFit(ImageFit.Fill)\n    }\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n  }\n  .autoPlay(true)\n  .indicator(false)\n}\n.aspectRatio(2.8)\n\n\n2）骨架效果\n\n  @Builder\n  SkeletonBuilder() {\n    Column() {\n      Row({ space: vp2vp(15) }) {\n        IvSkeleton()\n        IvSkeleton({ widthValue: vp2vp(60) })\n        IvSkeleton({ widthValue: vp2vp(80) })\n      }\n      .width('100%')\n      .margin({ bottom: vp2vp(15) })\n\n      List({ space: vp2vp(15) }){\n        ForEach([1, 2, 3, 4, 5, 6, 7], () => {\n          ListItem(){\n            Column({ space: vp2vp(15) }){\n              Row({ space: vp2vp(15) }){\n                IvSkeleton({ widthValue: vp2vp(30) })\n                IvSkeleton({ widthValue: '100%' }).layoutWeight(1)\n              }\n              Row({ space: vp2vp(15) }){\n                IvSkeleton({ widthValue: vp2vp(50) })\n                IvSkeleton({ widthValue: vp2vp(50) })\n                IvSkeleton({ widthValue: vp2vp(50) })\n              }\n              .width('100%')\n            }\n            .padding({ top: vp2vp(10), bottom: vp2vp(10) })\n          }\n        })\n      }\n      .divider({ strokeWidth: 0.5, color: $r('app.color.gray_bg') })\n    }\n    .width('100%')\n    .padding(vp2vp(15))\n    .layoutWeight(1)\n  }\n\n\n  @State\n  loading: boolean = false\n\n\n  if (this.loading) {\n    this.SkeletonBuilder()\n  } else {\n    // Tabs\n  }\n\n\n\n2. 分类 Tabs 动态展示#\n\n1）数据类型\n\nexport class TagModel {\n  tagName: string\n  nameColor: string\n  borderColor: string\n}\n\nexport class QuestionTypeModel {\n  public id: number\n  public name: string\n  public icon?: string\n  public describeInfo?: string\n  public displayNewestFlag?: 0 | 1\n  public tags?: TagModel[]\n}\n\n\n3） 获取数据\n\n  @State\n  questionTypeList: QuestionTypeModel[] = []\n  @State\n  activeIndex: number = 0\n\n  aboutToAppear() {\n    this.loading = true\n    Request.get('question/type')\n      .then(res => {\n        this.questionTypeList = res.data\n      })\n      .finally(() => {\n        this.loading = false\n      })\n  }\n\n\n4）渲染 tabs\n\n    if (this.loading) {\n        this.SkeletonBuilder()\n      } else {\n        Tabs() {\n          ForEach(this.questionTypeList, (item: QuestionTypeModel, index) => {\n            TabContent() {\n              // 列表组件\n            }\n            .tabBar(this.TabItemBuilder(item, index))\n            .height('100%')\n          })\n        }\n        .layoutWeight(1)\n        .barMode(BarMode.Scrollable)\n        .onChange(i => this.activeIndex = i)\n      }\n\n\n5）自定义构建函数\n\n\n  @Builder\n  TabItemBuilder(q: QuestionTypeModel, index: number) {\n    Row() {\n      Stack({ alignContent: Alignment.Bottom }) {\n        Text(q.name)\n          .fontSize(vp2vp(15))\n          .height(vp2vp(44))\n          .fontColor(this.activeIndex === index ? $r('app.color.black') : $r('app.color.gray'))\n        Text()\n          .width(this.activeIndex === index ? vp2vp(20) : 0)\n          .height(vp2vp(2))\n          .backgroundColor($r('app.color.black'))\n          .animation({ duration: this.activeIndex === index ? 300 : 0 })\n      }\n      .padding({ left: vp2vp(index === 0 ? 15 : 0) })\n\n      if (q.displayNewestFlag === 1) {\n        Image($r('app.media.new'))\n          .width(vp2vp(34))\n          .height(vp2vp(14))\n          .padding({ left: vp2vp(5) })\n      }\n    }\n    .padding({ right: vp2vp(15) })\n  }\n\n\n\n3. 试题列表组件抽取#\n\n1）标签组件\n\n\n\n@Component\nexport struct IvTag {\n  text: string\n  difficulty: number = 1\n\n  getTag() {\n    if (this.difficulty === 3 || this.difficulty === 4) {\n      return { text: '一般', color: $r('app.color.blue') }\n    } else if (this.difficulty === 5) {\n      return { text: '困难', color: $r('app.color.orange') }\n    }\n    return { text: this.text ? this.text : '简单', color: $r('app.color.green') }\n  }\n\n  build() {\n    Text(this.getTag().text)\n      .fontColor(this.getTag().color)\n      .fontSize(vp2vp(10))\n      .width(vp2vp(34))\n      .height(vp2vp(18))\n      .backgroundColor($r('app.color.gray_bg'))\n      .borderRadius(vp2vp(2))\n      .textAlign(TextAlign.Center)\n      .margin({ right: vp2vp(7) })\n  }\n}\n\n\n2）试题项组件\n\n\n\n\n\n@Component\nexport struct IvQuestionItem {\n  @Builder\n  SplitBuilder() {\n    Text('|')\n      .width(vp2vp(30))\n      .textAlign(TextAlign.Center)\n      .fontColor('#C3C3C5')\n      .fontSize(vp2vp(12))\n  }\n\n  @Builder\n  TextBuilder(text: string) {\n    Text(text)\n      .fontColor('#C3C3C5')\n      .fontSize(vp2vp(12))\n  }\n\n  build() {\n    Column() {\n      Row() {\n        IvTag({ difficulty: 4 })\n        Text('闭包你是怎么理解的？')\n          .fontSize(vp2vp(15))\n          .layoutWeight(1)\n          .textOverflow({ overflow: TextOverflow.Ellipsis })\n          .maxLines(1)\n      }.width('100%')\n\n      Row() {\n        this.TextBuilder(`点赞 100`)\n        this.SplitBuilder()\n        this.TextBuilder(`浏览 200`)\n        this.SplitBuilder()\n        this.TextBuilder(`已看过`)\n      }\n      .width('100%')\n      .margin({ top: vp2vp(10) })\n    }\n    .height(vp2vp(80))\n    .justifyContent(FlexAlign.Center)\n    .width('100%')\n    .onClick(() => {\n      Auth.pushUrl({\n        url: 'pages/QuestionDetail',\n      })\n    })\n  }\n}\n\n\n3）试题列表组件\n\n\n\n\n@Component\nexport struct IvQuestionList {\n  build() {\n    List() {\n      ForEach([1, 2, 3, 4, 5, 6, 7, 8], () => {\n        ListItem() {\n          IvQuestionItem()\n        }\n      })\n    }\n    .divider({\n      strokeWidth: 0.5,\n      color: $r('app.color.gray_bg')\n    })\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n    .height('100%')\n    .width('100%')\n  }\n}\n\n\n4）首页使用组件\n\n          ForEach(this.questionTypeList, (item: QuestionTypeModel, index) => {\n            TabContent() {\n              // 列表组件\n              IvQuestionList()\n            }\n            .tabBar(this.TabItemBuilder(item, index))\n            .height('100%')\n          })\n\n\n\n4. 试题列表加载#\n\n1）请求参数类型\n\nexport class QueryQuestionListParams {\n  type: number\n  page: number\n  questionBankType: number\n  sort?: number\n  keyword?: string\n}\n\n@Observed\nexport class QuestionItemModel {\n  public id: string\n  public stem: string\n  public difficulty: number\n  public likeCount: number\n  public views: number\n  public readFlag?: 0 | 1\n}\n\n\n2）试题列表组件\n\n\n\n\n\n\n\n@Component\nexport struct IvQuestionList {\n  @Prop\n  questionType: number\n  @Prop\n  @Watch('initQuestionList')\n  activeIndex: number\n  @Prop\n  selfIndex: number\n\n  params: QueryQuestionListParams = {\n    questionBankType: 10,\n    type: this.questionType,\n    page: 1,\n    sort: 0,\n  }\n  @State\n  questionList: QuestionItemModel[] = []\n\n  aboutToAppear() {\n    this.initQuestionList()\n  }\n\n  initQuestionList () {\n    if (this.activeIndex === this.selfIndex && this.questionList.length === 0) {\n      this.getQuestionList(this.params)\n    }\n  }\n\n  getQuestionList() {\n    return Request.get<{\n      total: number,\n      pageTotal: number,\n      rows: QuestionItemModel[]\n    }>('question/list', this.params)\n      .then(res => {\n        this.questionList = res.data.rows\n      })\n      .catch(e => {\n        promptAction.showToast({ message: JSON.stringify(e) })\n      })\n  }\n\n  build() {\n    List() {\n      ForEach(this.questionList, (item: QuestionItemModel) => {\n        ListItem() {\n          IvQuestionItem({ item })\n        }\n      },\n        ({id, likeCount, readFlag, views}: QuestionItemModel) => {\n          return JSON.stringify({ id, likeCount, readFlag, views })\n        }\n      )\n    }\n    .divider({\n      strokeWidth: 0.5,\n      color: $r('app.color.gray_bg')\n    })\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n    .height('100%')\n    .width('100%')\n  }\n}\n\n\n3）试题选项组件\n\n\n\n\n\n\n@Component\nexport struct IvQuestionItem {\n  @ObjectLink\n  item: QuestionItemModel\n\n  @Builder\n  SplitBuilder() {\n    Text('|')\n      .width(vp2vp(30))\n      .textAlign(TextAlign.Center)\n      .fontColor('#C3C3C5')\n      .fontSize(vp2vp(12))\n  }\n\n  @Builder\n  TextBuilder(text: string) {\n    Text(text)\n      .fontColor('#C3C3C5')\n      .fontSize(vp2vp(12))\n  }\n\n  build() {\n    Column() {\n      Row() {\n        IvTag({ difficulty: this.item.difficulty })\n        Text(this.item.stem)\n          .fontSize(vp2vp(15))\n          .layoutWeight(1)\n          .textOverflow({ overflow: TextOverflow.Ellipsis })\n          .maxLines(1)\n      }.width('100%')\n\n      Row() {\n        this.TextBuilder(`点赞 ${this.item.likeCount}`)\n        this.SplitBuilder()\n        this.TextBuilder(`浏览 ${this.item.views}`)\n        this.SplitBuilder()\n        if (this.item.readFlag === 1) {\n          this.TextBuilder(`已看过`)\n        }\n      }\n      .width('100%')\n      .margin({ top: vp2vp(10) })\n    }\n    .height(vp2vp(80))\n    .justifyContent(FlexAlign.Center)\n    .width('100%')\n    .onClick(() => {\n      Auth.pushUrl({\n        url: 'pages/QuestionDetail',\n        params: this.item\n      })\n    })\n  }\n}\n\n\n\n5. 加载更多#\n\n1）加载和完成状态\n\n  @State\n  finished: boolean = false\n  @State\n  loading: boolean = false\n\n\n2）判断是否可以加载更多\n\n  getQuestionList() {\n+    if (this.loading || this.finished)  return\n\n\n        if ( this.params.page < res.data.pageTotal ) {\n          this.params.page ++\n        } else {\n          this.finished = true\n        }\n        this.loading = false\n\n\n3）监听滚动到最下方\n\n    .onReachEnd(() => {\n      this.getQuestionList()\n    })\n\n\n4）加上加载UI结构\n\n@Builder\n  LoadingBuilder () {\n    if (this.finished) {\n      Row() {\n        Text('没有更多了~')\n          .fontColor($r('app.color.gray'))\n          .fontSize(vp2vp(14))\n      }\n      .width('100%')\n      .height(vp2vp(50))\n      .justifyContent(FlexAlign.Center)\n    } else {\n      if (this.loading) {\n        Row() {\n          LoadingProgress()\n            .width(vp2vp(24))\n            .margin({ right: vp2vp(5) })\n          Text('加载中...')\n            .fontColor($r('app.color.gray'))\n            .fontSize(vp2vp(14))\n        }\n        .width('100%')\n        .height(vp2vp(50))\n        .justifyContent(FlexAlign.Center)\n      }\n    }\n  }\n\n\n\n6. LazyForEach 性能优化#\n\n1）实现数据源\n\nexport class BasicDataSource implements IDataSource {\n  private listeners: DataChangeListener[] = [];\n\n  public totalCount(): number {\n    return 0;\n  }\n\n  public getData(index: number): any {\n\n  }\n\n  registerDataChangeListener(listener: DataChangeListener): void {\n    if (this.listeners.indexOf(listener) < 0) {\n      console.info('add listener');\n      this.listeners.push(listener);\n    }\n  }\n\n  unregisterDataChangeListener(listener: DataChangeListener): void {\n    const pos = this.listeners.indexOf(listener);\n    if (pos >= 0) {\n      console.info('remove listener');\n      this.listeners.splice(pos, 1);\n    }\n  }\n\n  notifyDataReload(): void {\n    this.listeners.forEach(listener => {\n      listener.onDataReloaded();\n    })\n  }\n\n  notifyDataAdd(index: number): void {\n    this.listeners.forEach(listener => {\n      listener.onDataAdd(index);\n    })\n  }\n\n  notifyDataChange(index: number): void {\n    this.listeners.forEach(listener => {\n      listener.onDataChange(index);\n    })\n  }\n\n  notifyDataDelete(index: number): void {\n    this.listeners.forEach(listener => {\n      listener.onDataDelete(index);\n    })\n  }\n}\n\n\n2）继承数据源进行扩展\n\n\nclass QuestionListDataSource extends BasicDataSource {\n\n  private questionList: QuestionItemModel[] = []\n\n  totalCount () {\n    return this.questionList.length\n  }\n\n  getData(index: number): QuestionItemModel  {\n    return this.questionList[index]\n  }\n\n  public addData(index: number, data: QuestionItemModel): void {\n    this.questionList.splice(index, 0, data);\n    this.notifyDataAdd(index);\n  }\n\n  public pushData(data: QuestionItemModel): void {\n    this.questionList.push(data);\n    this.notifyDataAdd(this.questionList.length - 1);\n  }\n\n}\n\n\n3）改用数据源渲染列表\n\n  questionListDataSource = new QuestionListDataSource()\n\n\n  initQuestionList () {\n+    if (this.activeIndex === this.selfIndex && this.questionListDataSource.totalCount() === 0) {\n      this.getQuestionList()\n    }\n  }\n\n\n    }>('question/list', this.params)\n      .then(res => {\n\n+        res.data.rows.forEach(item => {\n+          this.questionListDataSource.pushData(item)\n+        })\n\n\n+      LazyForEach(this.questionListDataSource, (item: QuestionItemModel) => {\n        ListItem() {\n          IvQuestionItem({ item })\n        }\n      },\n","frontmatter":{"title":"HM - 面试宝典APP-首页模块"},"version":""},{"id":8,"title":"HM - 面试宝典APP-通用设施","routePath":"/interview-handbook-project/project/","lang":"","toc":[{"text":"项目物料","id":"项目物料","depth":2,"charIndex":3},{"text":"基础能力","id":"基础能力","depth":2,"charIndex":242},{"text":"1. 创建项目","id":"1-创建项目","depth":3,"charIndex":250},{"text":"2. 日志工具类","id":"2-日志工具类","depth":3,"charIndex":771},{"text":"3. 访问权限工具类","id":"3-访问权限工具类","depth":3,"charIndex":2466},{"text":"4. 请求工具类-请求处理","id":"4-请求工具类-请求处理","depth":3,"charIndex":3557},{"text":"5. 请求工具类-响应处理","id":"5-请求工具类-响应处理","depth":3,"charIndex":4905},{"text":"UI 管理","id":"ui-管理","depth":2,"charIndex":6732},{"text":"1. 界面一多","id":"1-界面一多","depth":3,"charIndex":6741},{"text":"2. 手机侧适配","id":"2-手机侧适配","depth":3,"charIndex":8503},{"text":"3. 配置文件","id":"3-配置文件","depth":3,"charIndex":9814},{"text":"4. 准备页面","id":"4-准备页面","depth":3,"charIndex":10696},{"text":"5. 通用展示型组件","id":"5-通用展示型组件","depth":3,"charIndex":11522}],"domain":"","content":"#\n\n\n项目物料#\n\n * 参考设计\n\n【腾讯 CoDesign】面试宝典 https://codesign.qq.com/s/2kY5j3LVeb9ExNd 访问密码：2YDD\n\n * 接口文档\n\n【apifox】面试宝典\nhttps://apifox.com/apidoc/shared-31e6a8d7-316a-4c5a-83c1-e5c7a2c343bf\n\n * 效果例图\n\n登录   首页\n     \n\n我的   打卡\n     \n\n面试题   学习时间\n      \n\n\n基础能力#\n\n\n1. 创建项目#\n\n> 创建项目，参考华为 Codelabs 优秀案例结合项目自身情况对项目结构进行维护\n\n1）创建项目\n\n2）准备好项目结构\n\nets\n├── common                      // 通用模块\n│   ├── components              // - 通用组件\n│   ├── constants               // - 常量数据\n│   ├── images                  // - 图片资源\n│   └── utils                   // - 工具类\n├── entryability                // 入口UIAbility\n│   └── EntryAbility.ts\n├── models                      // - 数据模型\n├── pages                       // - 页面组件\n│   └── Index.ets\n└── views                       // - 页面对应自定义组件\n    └── Index\n\n\n\n2. 日志工具类#\n\n1）封装 logger 工具类\n\n\n\nconst DOMAIN = 0xFF00\nconst PREFIX = 'INTERVIEW'\nconst FORMAT = '%{public}s, %{public}s'\n\nexport class Logger {\n  static debug(...args: string[]) {\n    hilog.debug(DOMAIN, PREFIX, FORMAT, args)\n  }\n\n  static info(...args: string[]) {\n    hilog.info(DOMAIN, PREFIX, FORMAT, args)\n  }\n\n  static warn(...args: string[]) {\n    hilog.warn(DOMAIN, PREFIX, FORMAT, args)\n  }\n\n  static error(...args: string[]) {\n    hilog.error(DOMAIN, PREFIX, FORMAT, args)\n  }\n\n  static fatal(...args: string[]) {\n    hilog.fatal(DOMAIN, PREFIX, FORMAT, args)\n  }\n\n  static isLoggable(level: hilog.LogLevel) {\n    return hilog.isLoggable(DOMAIN, PREFIX, level)\n  }\n}\n\n\n2）修改 entryAbility 的日志打印\n\n\n\n\n\nexport default class EntryAbility extends UIAbility {\n  onCreate(want, launchParam) {\n    Logger.info('Ability onCreate')\n  }\n\n  onDestroy() {\n    Logger.info('Ability onDestroy')\n  }\n\n  onWindowStageCreate(windowStage: window.WindowStage) {\n    // Main window is created, set main page for this ability\n    Logger.info('Ability onWindowStageCreate')\n\n    windowStage.loadContent('pages/Index', (err, data) => {\n      if (err.code) {\n        Logger.info('Failed to load the content', JSON.stringify(err) ?? '')\n        return;\n      }\n      Logger.info('Succeeded in loading the content', JSON.stringify(data) ?? '');\n    });\n  }\n\n  onWindowStageDestroy() {\n    // Main window is destroyed, release UI related resources\n    Logger.info( 'Ability onWindowStageDestroy');\n  }\n\n  onForeground() {\n    // Ability has brought to foreground\n    Logger.info('Ability onForeground');\n  }\n\n  onBackground() {\n    // Ability has back to background\n    Logger.info('Ability onBackground');\n  }\n} \n\n\n\n3. 访问权限工具类#\n\n1）用户信息持久化，获取用户，设置用户，删除用户以及用户访问页面控制\n\nexport class UserModel {\n  id: string\n  username: string\n  avatar: string\n  refreshToken: string\n  token: string\n  totalTime?: number\n  nickName?: string\n  clockinNumbers?: number\n}\n\n\n\n\n\nconst USER_KEY = 'interview-user'\nconst PASS_LIST = ['pages/LoginPage']\n\nexport class Auth {\n  static initLocalUser() {\n    PersistentStorage.PersistProp(USER_KEY, '{}')\n  }\n\n  static setUser(user: UserModel) {\n    AppStorage.Set(USER_KEY, JSON.stringify(user))\n  }\n\n  static getUser() {\n    const str = AppStorage.Get(USER_KEY) || '{}'\n    return JSON.parse(str) as UserModel\n  }\n\n  static delUser() {\n    AppStorage.Set(USER_KEY, '{}')\n  }\n\n  // 需要登录页面使用\n  static pushUrl(options: router.RouterOptions) {\n    const user = this.getUser()\n    if (!PASS_LIST.includes(options.url) && !user.token) {\n      return router.pushUrl({\n        url: 'pages/LoginPage',\n        params: {\n          ...options.params,\n          return_url: options.url\n        }\n      })\n    }\n    return router.pushUrl(options)\n  }\n}\n\n\n2）在 Index 初始化持久化用户\n\n  Auth.initLocalUser()\n\n\n\n4. 请求工具类-请求处理#\n\n * 维护基准地址\n * get 传参拼接地址上，其他请求方式在 extraData 上\n * 提供快捷调用静态方法\n\n\n\n\nconst BASE_URL = 'https://api-harmony-teach.itheima.net/hm/'\n\nconst req = http.createHttp()\n\nconst request = (\n  url: string,\n  method: http.RequestMethod = http.RequestMethod.GET,\n  params: object = {}\n) => {\n  let fullUrl = BASE_URL + url\n  const options: http.HttpRequestOptions = {\n    header: {\n      'Content-Type': 'application/json',\n    },\n    readTimeout: 30000,\n    method,\n  }\n\n  // 如果是对象数据拼接URL，如果是其他则携带在 extraData\n  if (method === http.RequestMethod.GET) {\n    const urlParams = Object.keys(params).map(key => `${key}=${params[key]}`)\n    fullUrl += `?${urlParams.join('&')}`\n  } else {\n    options.extraData = params\n  }\n\n  // 携带 token\n  const user = Auth.getUser()\n  if (user.token) {\n    options.header['Authorization'] = `Bearer ${user.token}`\n  }\n\n  return req.request(fullUrl, options)\n\n}\n\nexport class Request {\n  static get(url: string, params?: object) {\n    return request(url, http.RequestMethod.GET, params)\n  }\n\n  static post(url: string, params?: object) {\n    return request(url, http.RequestMethod.POST, params)\n  }\n\n  static put(url: string, params?: object) {\n    return request(url, http.RequestMethod.PUT, params)\n  }\n\n  static delete(url: string, params?: object) {\n    return request(url, http.RequestMethod.DELETE, params)\n  }\n}\n\n\n\n5. 请求工具类-响应处理#\n\n * 处理业务失败\n * 处理登录失效\n * 添加日志行为\n\n  return req.request(fullUrl, options)\n    .then(res => {\n      if (res.result) {\n        // 1. 处理响应\n        const response = JSON.parse(res.result as string) as {\n          code: number\n          message: string\n          data: T\n        }\n        if (response.code === 10000) {\n          return response\n        }\n        // 2. 处理 token 失效\n        if (response.code === 401) {\n          Auth.delUser()\n          router.pushUrl({\n            url: 'pages/Login'\n          }, router.RouterMode.Single)\n        }\n      }\n      return Promise.reject(res.result)\n    })\n    .catch(err => {\n      promptAction.showToast({ message: '网络错误' })\n      return Promise.reject(err)\n    })\n    .finally(() => {\n      // 销毁请求释放资源\n      req.destroy()\n    })\n\n\n  // 请求日志：\n+  Logger.info(`REQUEST→${url}→${method}`, JSON.stringify(params))\n\n  return req.request(fullUrl, options)\n    .then(res => {\n      if (res.result) {\n        // 响应日志：\n+        Logger.info(`RESPONSE→${url}→${method}`, res.result.toString().substring(0, 250))\n        // 1. 处理响应\n        const response = JSON.parse(res.result as string) as {\n          code: number\n          message: string\n          data: T\n        }\n        if (response.code === 10000) {\n          return response\n        }\n        // 2. 处理 token 失效\n        if (response.code === 401) {\n          Auth.delUser()\n          router.pushUrl({\n            url: 'pages/Login'\n          }, router.RouterMode.Single)\n        }\n      }\n      return Promise.reject(res.result)\n    })\n    .catch(err => {\n      promptAction.showToast({ message: '网络错误' })\n      // 错误日志：\n+      Logger.error(`RESPONSE→${url}→${method}`, JSON.stringify(err).substring(0, 250))\n      return Promise.reject(err)\n    })\n    .finally(() => {\n      // 销毁请求释放资源\n      req.destroy()\n    })\n\n\n\n\nUI 管理#\n\n\n1. 界面一多#\n\n> 一个界面适配多类终端\n\n手机-竖屏\n\npad-横屏\n\n * 媒体查询 tablet 且横屏\n * tabs 的横竖模式\n * 设置 bar 的位置和高度\n\n\nclass ToolBarItem {\n  defaultIcon: string | Resource\n  activeIcon: string | Resource\n  label: string\n}\n\n@Entry\n@Component\nstruct Index {\n  @State\n  activeIndex: number = 0\n\n  @State\n  isLandscape: boolean = false\n\n  listenerScreen = mediaquery.matchMediaSync('(orientation: landscape) and (device-type: tablet)')\n\n  aboutToAppear() {\n    this.listenerScreen.on('change', (mediaQueryResult) => {\n      this.isLandscape = mediaQueryResult.matches\n    })\n  }\n\n  toolBars: ToolBarItem[] = [\n    { defaultIcon: $r('app.media.home'), activeIcon: $r('app.media.home_select'), label: '首页' },\n    { defaultIcon: $r('app.media.project'), activeIcon: $r('app.media.project_select'), label: '项目' },\n    { defaultIcon: $r('app.media.interview'), activeIcon: $r('app.media.interview_select'), label: '面经' },\n    { defaultIcon: $r('app.media.mine'), activeIcon: $r('app.media.mine_select'), label: '我的' }\n  ]\n\n  @Builder\n  TabBarBuilder(item: ToolBarItem, index: number) {\n    Column({ space: 4 }) {\n      Image(this.activeIndex === index ? item.activeIcon : item.defaultIcon)\n        .width(24)\n      Text(item.label)\n        .fontSize(12)\n        .fontColor(this.activeIndex === index ? '#000' : '#aaa')\n    }\n  }\n\n  build() {\n    Tabs({\n      index: this.activeIndex,\n    }) {\n      ForEach(this.toolBars, (item: ToolBarItem, index: number) => {\n        TabContent() {\n          Text(index.toString())\n        }\n        .tabBar(this.TabBarBuilder(item, index))\n      })\n    }\n    .barPosition(this.isLandscape ? BarPosition.Start : BarPosition.End)\n    .vertical(this.isLandscape)\n    .barHeight(this.isLandscape ? 400 : 50)\n    .onChange(index => this.activeIndex = index)\n  }\n}\n\n\n\n2. 手机侧适配#\n\n> 手机端等比例缩放适配设备\n\n * 知道等比例缩放原理\n\n// 安卓一般 360 设计稿 1080，面试宝典是 375\nconst designWidth = 375\n// 书写尺寸 = 设备宽度 / 设计稿宽度 * 测量尺寸\nconst useSize =  deviceWidth / designWidth * measureSize\n\n\n * 封装等比例缩放函数\n\n\n\n\nconst designWidth = 375\nconst devicePhysics = display.getDefaultDisplaySync().width\n\nexport const vp2vp = (originSize: number) => {\n  // 不是PAD是手机等比例缩放\n  if ( deviceInfo.deviceType !== 'tablet' ) {\n    return px2vp(devicePhysics) / designWidth * originSize\n  }\n  return originSize\n}\n\n\n * 修改 Tabs 相关尺寸\n\n @Builder\n  TabBarBuilder(item: ToolBarItem, index: number) {\n    Column({ space: vp2vp(4) }) {\n      Image(this.activeIndex === index ? item.activeIcon : item.defaultIcon)\n        .width(vp2vp(24))\n      Text(item.label)\n        .fontSize(vp2vp(12))\n        .fontColor(this.activeIndex === index ? '#000' : '#aaa')\n    }\n  }\n\n  build() {\n    Tabs({\n      index: this.activeIndex,\n    }) {\n      ForEach(this.toolBars, (item: ToolBarItem, index: number) => {\n        TabContent() {\n          Text(index.toString())\n        }\n        .tabBar(this.TabBarBuilder(item, index))\n      })\n    }\n    .barPosition(this.isLandscape ? BarPosition.Start : BarPosition.End)\n    .vertical(this.isLandscape)\n    .barHeight(this.isLandscape ? vp2vp(400) : vp2vp(50))\n    .onChange(index => this.activeIndex = index)\n  }\n\n\n\n3. 配置文件#\n\n * 应用名称\n\n * 主题颜色\n\n1）应用名称\n\n{\n  \"string\": [\n    {\n      \"name\": \"module_desc\",\n      \"value\": \"模块描述\"\n    },\n    {\n      \"name\": \"EntryAbility_desc\",\n      \"value\": \"前端面试宝典，包含常见面试题，和企业真实面经\"\n    },\n    {\n      \"name\": \"EntryAbility_label\",\n      \"value\": \"面试通\"\n    },\n    {\n      \"name\": \"reason\",\n      \"value\": \"获取通知权限\"\n    }\n  ]\n}\n\n\n2）主题颜色\n\n{\n  \"color\": [\n    {\n      \"name\": \"start_window_background\",\n      \"value\": \"#FFFFFF\"\n    },\n    {\n      \"name\": \"green\",\n      \"value\": \"#27AE60\"\n    },\n    {\n      \"name\": \"gray\",\n      \"value\": \"#979797\"\n    },\n    {\n      \"name\": \"black\",\n      \"value\": \"#121826\"\n    },\n    {\n      \"name\": \"gray_bg\",\n      \"value\": \"#F6F7F9\"\n    },\n    {\n      \"name\": \"orange\",\n      \"value\": \"#F2994A\"\n    },\n    {\n      \"name\": \"blue\",\n      \"value\": \"#3266EE\"\n    },\n    {\n      \"name\": \"blue_bg\",\n      \"value\": \"#EDF2FF\"\n    }\n  ]\n}\n\n\n\n4. 准备页面#\n\n * 准备首页、项目、面经、我的四个 tabs 页面\n\n * 使用 页面组件\n\n1）准备组件\n\n@Component\nexport struct Home {\n  build() {\n    Column(){\n      Text('首页')\n    }\n    .width('100%')\n    .height('100%')\n  }\n}\n\n\n@Component\nexport struct Project {\n  build() {\n    Column(){\n      Text('项目')\n    }\n    .width('100%')\n    .height('100%')\n  }\n}\n\n\n@Component\nexport struct Interview {\n  build() {\n    Column(){\n      Text('面经')\n    }\n    .width('100%')\n    .height('100%')\n  }\n}\n\n\n@Component\nexport struct Mine {\n  build() {\n    Column(){\n      Text('我的')\n    }\n    .width('100%')\n    .height('100%')\n  }\n}\n\n\n2）使用组件\n\n\n\n\n\n\n// ...\n\n        TabContent() {\n          if (index === 0) Home()\n          else if (index === 1) Project()\n          else if (index === 2) Interview()\n          else Mine()\n        }\n        .tabBar(this.TabBarBuilder(item, index))\n\n\n\n5. 通用展示型组件#\n\n * 搜索框组件\n\n * 打卡组件\n\n * 骨架屏组件\n\n1）搜索框组件\n\n\n\n@Component\nexport struct IvSearch {\n\n  textAlign: FlexAlign = FlexAlign.Start\n\n  build() {\n    Row() {\n      Image($r('app.media.icon_public_search'))\n        .width(vp2vp(15))\n        .aspectRatio(1)\n        .fillColor($r('app.color.gray'))\n\n      Text('请输入关键词')\n        .fontSize(vp2vp(14))\n        .fontColor($r('app.color.gray'))\n        .margin({ left: vp2vp(3) })\n    }\n    .layoutWeight(1)\n    .height(vp2vp(28))\n    .backgroundColor($r('app.color.gray_bg'))\n    .borderRadius(vp2vp(14))\n    .padding({ left: vp2vp(10), right: vp2vp(10) })\n    .justifyContent(this.textAlign)\n  }\n}\n\n\n2）打卡组件\n\n\n\n@Component\nexport struct IvClock {\n  @Prop\n  clockCount: number = 0\n\n  build() {\n    Stack({ alignContent: Alignment.End }) {\n      Image(this.clockCount > 0 ? $r('app.media.clocked') : $r('app.media.unclock'))\n        .objectFit(ImageFit.Fill)\n      if (this.clockCount > 0) {\n        Column() {\n          Text('已连续打卡')\n            .fontSize(8)\n          Text() {\n            Span(this.clockCount.toString())\n              .fontWeight(600)\n              .fontSize(12)\n            Span(' 天')\n              .fontSize(10)\n          }\n        }\n        .width('50')\n      } else {\n        Text('打卡')\n          .width('50')\n          .textAlign(TextAlign.Center)\n          .fontSize(vp2vp(18))\n          .fontWeight(500)\n          .fontColor('#333C4F')\n          .margin({ bottom: vp2vp(4) })\n      }\n    }\n    .width(vp2vp(74))\n    .height(vp2vp(28))\n  }\n}\n\n\n\n\n\n@Component\nexport struct Home {\n  build() {\n    Column() {\n      Row({ space: 15 }) {\n        IvSearch()\n        IvClock()\n      }\n      .padding(15)\n\n      Text('首页')\n    }\n    .width('100%')\n    .height('100%')\n  }\n}\n\n\n3）骨架屏组件\n\n * 背景渐变 linearGradient\n\nlinearGradient({\n// 角度，默认 180\nangle?: number | string,\n// 颜色，比例\ncolors: Array<[ResourceColor, number]>,\n})\n\n\n * 组件结构\n\n\n\n@Component\nexport struct IvSkeleton {\n  widthValue: number | string = 100\n  heightValue: number | string = 20\n  @State\n  translateValue: string = '-100%'\n\n  build() {\n    Stack() {\n      Text()\n        .backgroundColor($r('app.color.gray_bg'))\n        .height('100%')\n        .width('100%')\n      Text()\n        .linearGradient({\n          angle: 90,\n          colors: [\n            ['rgba(255,255,255,0)', 0],\n            ['rgba(255,255,255,0.5)', 0.5],\n            ['rgba(255,255,255,0)', 1]\n          ]\n        })\n        .height('100%')\n        .width('100%')\n        .translate({\n          x: this.translateValue,\n        })\n        .animation({\n          duration: 1500,\n          iterations: -1\n        })\n    }\n    .height(this.heightValue)\n    .width(this.widthValue)\n    .borderRadius(vp2vp(4))\n    .clip(true)\n    .onAppear(() => {\n      this.translateValue = '100%'\n    })\n  }\n}\n","frontmatter":{"title":"HM - 面试宝典APP-通用设施"},"version":""},{"id":9,"title":"HM - 面试宝典APP-我的模块","routePath":"/interview-handbook-project/project/mine","lang":"","toc":[{"text":"个人中心","id":"个人中心","depth":2,"charIndex":3},{"text":"1. 我的-页面结构","id":"1-我的-页面结构","depth":3,"charIndex":11},{"text":"2. 我的-页面逻辑","id":"2-我的-页面逻辑","depth":3,"charIndex":3927},{"text":"3. 登录-页面结构","id":"3-登录-页面结构","depth":3,"charIndex":6436},{"text":"4. 登录-页面逻辑","id":"4-登录-页面逻辑","depth":3,"charIndex":9589},{"text":"5. 我的-退出登录","id":"5-我的-退出登录","depth":3,"charIndex":11025},{"text":"打卡日历","id":"打卡日历","depth":2,"charIndex":11878},{"text":"1. 实现打卡","id":"1-实现打卡","depth":3,"charIndex":11886},{"text":"2. 打卡日历-页面结构","id":"2-打卡日历-页面结构","depth":3,"charIndex":13027},{"text":"3. 打卡日历-第三方库","id":"3-打卡日历-第三方库","depth":3,"charIndex":14886},{"text":"4. 打卡日历-共享日历本地库","id":"4-打卡日历-共享日历本地库","depth":3,"charIndex":14999},{"text":"3. 打卡日历-显示签到","id":"3-打卡日历-显示签到","depth":3,"charIndex":21405},{"text":"编辑资料","id":"编辑资料","depth":2,"charIndex":22516},{"text":"1. 资料页面","id":"1-资料页面","depth":3,"charIndex":22524},{"text":"2. 修改昵称","id":"2-修改昵称","depth":3,"charIndex":24719},{"text":"3. 修改头像","id":"3-修改头像","depth":3,"charIndex":25824}],"domain":"","content":"#\n\n\n个人中心#\n\n\n1. 我的-页面结构#\n\n\n\n\n@Preview\n@Component\nexport struct Mine {\n  @Builder\n  NavBuilder(icon: Resource, title: string,) {\n    Column({ space: vp2vp(8) }) {\n      Image(icon)\n        .width(vp2vp(30))\n        .height(vp2vp(30))\n        .objectFit(ImageFit.Fill)\n      Text(title)\n        .fontColor($r('app.color.gray'))\n        .fontSize(vp2vp(13))\n    }\n  }\n\n  @Builder\n  CellBuilder(title: string, cb?: () => void) {\n    Row() {\n      Text(title)\n        .fontSize(vp2vp(15))\n        .fontColor($r('app.color.black'))\n      Image($r('app.media.icon_my_arrow'))\n        .fillColor('#C3C3C5')\n        .width(vp2vp(18))\n        .height(vp2vp(18))\n    }\n    .width('100%')\n    .height(vp2vp(40))\n    .justifyContent(FlexAlign.SpaceBetween)\n    .padding({ left: vp2vp(15), right: vp2vp(15) })\n    .onClick(()=>{\n      cb && cb()\n    })\n  }\n\n  build() {\n    Column({ space: vp2vp(15) }) {\n      // 头部\n      Row() {\n        Image('/common/images/avatar.png')\n          .alt('/common/images/avatar.png')\n          .width(vp2vp(55))\n          .aspectRatio(1)\n          .borderRadius(vp2vp(30))\n          .border({ width: 0.5, color: '#e4e4e4' })\n        Column({ space: vp2vp(5) }) {\n          Text('黑马程序员')\n            .fontSize(vp2vp(18))\n            .fontWeight(FontWeight.Bold)\n          Row() {\n            Text('编辑资料')\n              .fontSize(vp2vp(12))\n              .fontColor($r('app.color.gray'))\n            Image($r('app.media.icon_edit'))\n              .width(vp2vp(12))\n              .aspectRatio(1)\n              .fillColor($r('app.color.gray'))\n          }\n        }\n        .padding({ left: vp2vp(12) })\n        .alignItems(HorizontalAlign.Start)\n        .layoutWeight(1)\n\n        IvClock({ clockCount: 0 })\n      }\n      .height(vp2vp(80))\n\n      // 导航\n      GridRow({ columns: 4 }) {\n        GridCol() {\n          this.NavBuilder($r('app.media.icon_my_history'), '历史记录')\n        }\n\n        GridCol() {\n          this.NavBuilder($r('app.media.icon_my_favo'), '我的收藏')\n        }\n\n        GridCol() {\n          this.NavBuilder($r('app.media.icon_my_zan'), '我的点赞')\n        }\n\n        GridCol() {\n          Column() {\n            this.NavBuilder($r('app.media.icon_my_time'), '累计学时')\n            Row() {\n              Text('10分钟')\n                .fontColor('#C3C3C5')\n                .fontSize(vp2vp(11))\n              Image($r('app.media.icon_my_arrow'))\n                .fillColor('#C3C3C5')\n                .width(vp2vp(13))\n                .height(vp2vp(13))\n            }\n            .margin({ top: vp2vp(3) })\n          }\n        }\n      }\n      .backgroundColor('#fff')\n      .padding({ top: vp2vp(15), bottom: vp2vp(15) })\n      .borderRadius(vp2vp(8))\n\n      Row() {\n        Text()\n          .width(vp2vp(3))\n          .height(vp2vp(12))\n          .backgroundColor($r('app.color.green'))\n        Text('前端常用词')\n          .fontSize(vp2vp(15))\n          .fontColor($r('app.color.black'))\n          .layoutWeight(1)\n          .padding({ left: vp2vp(12) })\n        Image($r('app.media.icon_my_new'))\n          .width(vp2vp(53))\n          .height(vp2vp(22))\n          .margin({ right: vp2vp(10) })\n      }\n      .backgroundColor('#fff')\n      .padding({ top: vp2vp(15), bottom: vp2vp(15) })\n      .borderRadius(vp2vp(8))\n\n      List() {\n        ListItem() {\n          this.CellBuilder('推荐分享')\n        }\n\n        ListItem() {\n          this.CellBuilder('意见反馈')\n        }\n\n        ListItem() {\n          this.CellBuilder('关于我们')\n        }\n\n        if (this.user.token) {\n          ListItem() {\n            this.CellBuilder('退出登录', () => {\n              // 退出登录\n            })\n          }\n        }\n      }\n      .padding({ top: vp2vp(10), bottom: vp2vp(10) })\n      .borderRadius(vp2vp(8))\n      .backgroundColor('#fff')\n      .divider({ strokeWidth: 0.5, color: $r('app.color.gray_bg') })\n\n    }\n    .padding(vp2vp(15))\n    .width('100%')\n    .height('100%')\n    .backgroundColor($r('app.color.gray_bg'))\n  }\n}\n\n\n\n2. 我的-页面逻辑#\n\n1）在 Index 初始化持久化用户\n\n  Auth.initLocalUser()\n\n\n2）获取 AppStorage 用户数据\n\n  @StorageProp(USER_KEY)\n  @Watch('updateUser')\n  userJson: string = '{}'\n  @State\n  user: UserModel = JSON.parse(this.userJson)\n\n  updateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n\n\n3）进行展示\n\n      // 头部\n      Row() {\n        Image(this.user.avatar || '/common/images/avatar.png')\n          .alt('/common/images/avatar.png')\n          .width(vp2vp(55))\n          .aspectRatio(1)\n          .borderRadius(vp2vp(30))\n          .border({ width: 0.5, color: '#e4e4e4' })\n        Column({ space: vp2vp(5) }) {\n          if (this.user.token) {\n            Text(this.user.nickName || this.user.username)\n              .fontSize(vp2vp(18))\n              .fontWeight(FontWeight.Bold)\n            Row() {\n              Text('编辑资料')\n                .fontSize(vp2vp(12))\n                .fontColor($r('app.color.gray'))\n              Image($r('app.media.icon_edit'))\n                .width(vp2vp(12))\n                .aspectRatio(1)\n                .fillColor($r('app.color.gray'))\n            }\n          } else {\n            Text('点击登录')\n              .fontSize(vp2vp(18))\n              .fontWeight(FontWeight.Bold)\n              .onClick(() => {\n                router.pushUrl({\n                  url: 'pages/LoginPage'\n                })\n              })\n          }\n        }\n        .padding({ left: vp2vp(12) })\n        .alignItems(HorizontalAlign.Start)\n        .layoutWeight(1)\n\n        IvClock({ clockCount: this.user.clockinNumbers || 0  })\n      }\n      .height(vp2vp(80))\n\n\n          Column() {\n            this.NavBuilder($r('app.media.icon_my_time'), '累计学时')\n            Row() {\n              Text(formatTime(this.user.totalTime))\n                .fontColor('#C3C3C5')\n                .fontSize(vp2vp(11))\n              Image($r('app.media.icon_my_arrow'))\n                .fillColor('#C3C3C5')\n                .width(vp2vp(13))\n                .height(vp2vp(13))\n            }\n            .margin({ top: vp2vp(3) })\n          }\n\n\n        if (this.user.token) {\n          this.CellBuilder('退出登录')\n        }\n\n\n4）Basic 封装时间转换函数\n\nexport const formatTime = (time: number = 0, hasUnit: boolean = true) => {\n  if (time < 3600) {\n    return String(Math.floor(time / 60)) + (hasUnit ? ' 分钟' : '')\n  } else {\n    return String(Math.round(time / 3600 * 10) / 10) + (hasUnit ? ' 小时' : '')\n  }\n}\n\n\n              Text(formatTime(this.user.totalTime))\n                .fontColor('#C3C3C5')\n                .fontSize(vp2vp(11))\n\n\n\n3. 登录-页面结构#\n\n\n\n@Extend(TextInput) function customStyle() {\n  .height(vp2vp(44))\n  .borderRadius(vp2vp(2))\n  .backgroundColor('#ffffff')\n  .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })\n  .padding({ left: 0 })\n  .placeholderColor('#C3C3C5')\n  .caretColor('#fa711d')\n}\n\n@Entry\n@Component\nstruct LoginPage {\n  @State\n  username: string = 'hmheima'\n  @State\n  password: string = 'Hmheima%123'\n  @State\n  isAgree: boolean = false\n  @State\n  loading: boolean = false\n\n  build() {\n    Navigation() {\n      Scroll() {\n        Column() {\n          Column() {\n            Image($r('app.media.icon'))\n              .width(vp2vp(120))\n              .aspectRatio(1)\n            Text('面试宝典')\n              .fontSize(vp2vp(28))\n              .margin({ bottom: vp2vp(15) })\n            Text('搞定企业面试真题，就用面试宝典')\n              .fontSize(vp2vp(14))\n              .fontColor($r('app.color.gray'))\n          }\n\n          Column({ space: vp2vp(15) }) {\n            TextInput({ placeholder: '请输入用户名', text: this.username })\n              .customStyle()\n              .onChange(val => this.username = val)\n            TextInput({ placeholder: '请输入密码', text: this.password, })\n              .type(InputType.Password)\n              .showPasswordIcon(false)\n              .customStyle()\n              .onChange(val => this.password = val)\n            Row() {\n              Checkbox()\n                .selectedColor('#fa711d')\n                .width(vp2vp(14))\n                .aspectRatio(1)\n                .select(this.isAgree)\n                .onChange((val) => {\n                  this.isAgree = val\n                })\n              Row({ space: vp2vp(4) }) {\n                Text('已阅读并同意')\n                  .fontSize(vp2vp(14))\n                  .fontColor($r('app.color.gray'))\n                Text('用户协议')\n                  .fontSize(vp2vp(14))\n                Text('和')\n                  .fontSize(vp2vp(14))\n                  .fontColor($r('app.color.gray'))\n                Text('隐私政策')\n                  .fontSize(vp2vp(14))\n              }\n            }\n            .width('100%')\n\n            Button({ type: ButtonType.Normal   }) {\n              Row() {\n                if (this.loading) {\n                  LoadingProgress()\n                    .color('#ffffff')\n                    .width(vp2vp(24))\n                    .height(vp2vp(24))\n                    .margin({ right: vp2vp(10) })\n                }\n                Text('立即登录').fontColor('#ffffff')\n              }\n            }\n            .width('100%')\n            .backgroundColor('transparent')\n            .stateEffect(false)\n            .borderRadius(vp2vp(4))\n            .height(vp2vp(44))\n            .linearGradient({\n              direction: GradientDirection.Right,\n              colors: [['#fc9c1c', 0], ['#fa711d', 1]]\n            })\n          }\n          .padding(vp2vp(30))\n\n          Column() {\n            Text('其他登录方式')\n              .fontSize(vp2vp(14))\n              .fontColor($r('app.color.gray'))\n          }\n          .padding({ top: vp2vp(70), bottom: vp2vp(100) })\n        }\n      }\n    }\n    .titleMode(NavigationTitleMode.Mini)\n    .mode(NavigationMode.Stack)\n  }\n}\n\n\n\n4. 登录-页面逻辑#\n\n1）控制按钮，禁用|启用状态，点击事件\n\nButton({ type: ButtonType.Normal }) {\n  Row() {\n    if (this.loading) {\n      LoadingProgress()\n        .color('#ffffff')\n        .width(vp2vp(24))\n        .height(vp2vp(24))\n        .margin({ right: vp2vp(10) })\n    }\n    Text('立即登录')\n      .fontColor('#ffffff')\n  }\n}\n.width('100%')\n.backgroundColor('transparent')\n.borderRadius(vp2vp(4))\n.height(vp2vp(44))\n.stateEffect(false)\n.linearGradient({\n  direction: GradientDirection.Right,\n  colors: [['#fc9c1c', 0], ['#fa711d', 1]]\n})\n.enabled(!this.loading)\n.onClick(() => {\n  this.login()\n})\n\n\n2）实现登录，非空校验、登录跳转\n\nlogin() {\n  if (!this.username) {\n    return promptAction.showToast({ message: '请输入用户名' })\n  }\n  if (!this.password) {\n    return promptAction.showToast({ message: '请输入密码' })\n  }\n  if (!this.isAgree) {\n    return promptAction.showToast({ message: '请勾选已阅读并同意' })\n  }\n\n  this.loading = true\n  Request.post('login', {\n    username: this.username,\n    password: this.password\n  }).then(res => {\n    Auth.setUser(res.data)\n\n    const params = router.getParams()\n    if (params && params['return_url']) {\n      const url = params['return_url']\n      delete params['return_url']\n      router.replaceUrl({ url, params })\n    } else {\n      router.back()\n    }\n    this.loading = false\n    return promptAction.showToast({ message: '登录成功' })\n  }).catch(e => {\n    this.loading = false\n    return promptAction.showToast({ message: '登录失败' })\n  })\n\n}\n\n\n\n5. 我的-退出登录#\n\n1）退出登录\n\nif (this.user.token) {\n  this.CellBuilder('退出登录', async () => {\n    const ok = await promptAction.showDialog({\n      title: '温馨提示',\n      message: '您确认要退出面试宝典APP吗？',\n      buttons: [\n        { text: '取消', color: '#c3c4c5' },\n        { text: '确认', color: '#333333', }\n      ]\n    })\n    if (ok.index === 1) {\n      Auth.delUser()\n    }\n  })\n}\n\n\n2）退出和登录，使用 emitter 通知 Home 更新页面\n\n基本语法：\n\non(event: InnerEvent, callback: Callback): void\n\nemit(event: InnerEvent, data?: EventData): void\n\ninterface InnerEvent {\n  eventId: number\n}\n\n\n * Home 注册事件\n\naboutToAppear() {\n  this.getQuestionTypeList()\n\n  emitter.on(LOGIN_EVENT, () => this.getQuestionTypeList())\n}\n\n\n * 登录触发事件\n\nAuth.setUser(res.data)\n// 通知 Home 更新页面\nemitter.emit(LOGIN_EVENT)\n\n\n * 退出触发事件\n\nif (ok.index === 1) {\n  Auth.delUser()\n  // 通知 Home 更新页面\n  emitter.emit(LOGIN_EVENT)\n}\n\n\n\n打卡日历#\n\n\n1. 实现打卡#\n\n1）首页打开数量显示\n\n  @StorageProp(USER_KEY)\n  @Watch('updateUser')\n  userJson: string = '{}'\n  @State\n  user: UserModel = JSON.parse(this.userJson)\n\n  updateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n\n\n      Row({ space: vp2vp(10) }) {\n        IvSearch()\n+        IvClock({ clockCount: this.user.clockinNumbers || 0 })\n      }\n\n\n2）打卡功能实现\n\n.onClick(() => {\n  const user = Auth.getUser()\n  if (user.token) {\n    if (user.clockinNumbers > 0) {\n      // 跳转打卡日历页面\n      return router.pushUrl({ url: 'pages/ClockPage' })\n    } else {\n      // 进行打卡\n      Request.post<{ clockinNumbers: number }>('clockin').then(res => {\n        Auth.setUser({ ...user, clockinNumbers: res.data.clockinNumbers })\n        promptAction.showToast({ message: '打卡成功' })\n      })\n    }\n  } else {\n    router.pushUrl({ url: 'pages/LoginPage' })\n  }\n})\n\n\n3）更新打卡信息（用户信息）重新登录系统的时候\n\n\n// 获取用户信息\naboutToAppear(){\n  if (this.user.token) {\n    Request.get('userInfo')\n      .then(res => {\n        const { avatar, nickName, clockinNumbers, totalTime } = res.data\n        Auth.setUser({ ...this.user, avatar, nickName, clockinNumbers, totalTime })\n      })\n  }\n}\n\n\n\n\n2. 打卡日历-页面结构#\n\n\n\n@Entry\n@Component\nstruct ClockPage {\n  @Builder\n  dayBuilder(params: {\n    day: number,\n    text: string\n  }) {\n    Column() {\n      Row() {\n        Text(params.day.toString())\n          .fontSize(vp2vp(40))\n          .fontWeight(FontWeight.Bold)\n        Text('天')\n          .fontSize(vp2vp(10))\n          .fontColor($r('app.color.gray'))\n          .margin({ bottom: vp2vp(8), left: vp2vp(10) })\n      }\n      .alignItems(VerticalAlign.Bottom)\n\n      Text(params.text)\n        .fontSize(vp2vp(10))\n        .fontColor($r('app.color.gray'))\n    }.margin({ right: vp2vp(36) })\n  }\n\n  build() {\n    Column() {\n      Navigation() {\n        Column() {\n          Row() {\n            Text('今日已打卡')\n              .fontSize(vp2vp(20))\n              .margin({ right: vp2vp(5) })\n            Image($r('app.media.icon_clock_card'))\n              .width(vp2vp(20))\n              .aspectRatio(1)\n              .objectFit(ImageFit.Fill)\n          }\n          .width('100%')\n\n          Row() {\n            this.dayBuilder({ day: 10, text: '累计打卡' })\n            this.dayBuilder({ day: 10, text: '连续打卡' })\n          }\n          .padding({ top: vp2vp(10), bottom: vp2vp(25) })\n          .width('100%')\n          .justifyContent(FlexAlign.Start)\n\n          Row() {\n\n          }\n          .height(300)\n          .margin({ bottom: vp2vp(50) })\n\n          Image('/common/images/clock_btn.png')\n            .width(vp2vp(145))\n            .height(vp2vp(38))\n            .objectFit(ImageFit.Fill)\n\n        }\n        .padding(vp2vp(15))\n        .layoutWeight(1)\n      }\n      .title('每日打卡')\n      .titleMode(NavigationTitleMode.Mini)\n      .mode(NavigationMode.Stack)\n      .backgroundImage('/common/images/clock_bg.png')\n      .backgroundImageSize(ImageSize.Contain)\n      .backgroundImagePosition(Alignment.Top)\n    }.backgroundColor($r('app.color.gray_bg'))\n  }\n}\n\n\n\n3. 打卡日历-第三方库#\n\n1）方式1：使用 ohmp 命令行，参考：链接\n\n2）方式2：\n\n  \"dependencies\": {\n    \"dayjs\": \"latest\"\n  }\n\n\n3）查找支持的第三方包 链接\n\n\n4. 打卡日历-共享日历本地库#\n\n1）创建本地包\n\n * 创建模块\n\n * 包名称 miniCalendar\n\n2）修改日历文件，名称 MainPage.ets 改成 MiniCalendar.ets\n\n\n\n\n\n// 设计稿宽度\nconst designWidth = 375\n// 物理像素\nconst devicePhysics = display.getDefaultDisplaySync().width\n\nexport const vp2vp = (originSize: number) => {\n  // useSize =  deviceWidth / designWidth * measureSize\n  // 只有 手机 才需要\n  // if (deviceInfo.deviceType !== 'tablet') {\n  //   return px2vp(devicePhysics) / designWidth * originSize\n  // }\n  return originSize\n}\n\nconst img = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABECAYAAAA4E5OyAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAF5SURBVHgB7drLUcMwFIXhGzvOMKwoJXSAO0gJ0BkdECoQJaQT2II1MTo8NiZsmLm6R+R8mzjJIuN/Yo0tyUxERERERERE/rmVOUopXa3Xm4dyeFN+ap/z6904ji9GrDNHfT/s7CMGzLsSJyGSEXMNMs+2PPktexTXIMfjdF9eDouPqaO4jiHwNY6kcrhdfHXI+W1kG1Pcg0BLUaoEgVaiVAsCLUSpGgTYo1QPAsxRQoIAa5SwIMAYJTQIsEUJDwJMUSiCAEsUmiDAEIUqCERHoQsCkVFcH///CieME7cTUwddN9yaI8og31Yn/r993z+bI8oguGSGYZPKjNuPS2aaLh7NEeWg+luMnC/L1XR9PoNqdAygujGLjgE0t+4MMYDi4Y4lBoQ//jPFgNAJIrYYEDaFyBgDQiaZWWNA9WUI5hhQdaGKPQZUW8psIQZUWexuJQa47yBqKQa47yBqKQbU3kFEHQNq7CDaf76bn9hjiIiIiIiIiMhZeAeOPE1Nm7TnTQAAAABJRU5ErkJggg=='\n\nclass DayItem {\n  public date: number\n  public month: number\n  public year: number\n  public isSelected?: boolean\n}\n\n@Component\nexport struct MiniCalendar {\n  // 内部属性\n  private weeks: string[] = ['日', '一', '二', '三', '四', '五', '六']\n  private selectedText: string = '已打卡'\n  private format: string = 'YYYY-MM-DD'\n  // 当前时间\n  @Prop\n  @Watch('onCurrentDateUpdate')\n  currentDate: string\n  // 选中时间\n  @Link\n  @Watch('onCurrentDateUpdate')\n  selectedDays: string[]\n  @State\n  days: DayItem[] = []\n  onClickDate: (date: string) => void\n  onChangeMonth: (date: string) => void\n\n  onCurrentDateUpdate() {\n    this.days = this.getDays(this.currentDate)\n  }\n\n  aboutToAppear() {\n    this.days = this.getDays(this.currentDate)\n  }\n\n  getDays(originDate?: string) {\n    const date = originDate ? dayjs(originDate) : dayjs()\n    const days: DayItem[] = []\n    const len = 42\n\n    // 当前月\n    const currDays = date.daysInMonth()\n    for (let index = 1; index <= currDays; index++) {\n      days.push({\n        date: index,\n        month: date.month() + 1,\n        year: date.year(),\n        isSelected: this.selectedDays.some(item => date.date(index).isSame(item))\n      })\n    }\n    // 上个月\n    const prevMonth = date.date(0)\n    const prevMonthLastDate = prevMonth.date()\n    const prevDays = prevMonth.day()\n    if (prevDays < 6) {\n      for (let index = 0; index <= prevDays; index++) {\n        days.unshift({\n          date: prevMonthLastDate - index,\n          month: prevMonth.month() + 1,\n          year: prevMonth.year()\n        })\n      }\n    }\n    // 下个月\n    const nextMonth = date.date(currDays + 1)\n    const start = days.length\n    for (let index = 1; index <= len - start; index++) {\n      days.push({\n        date: index,\n        month: nextMonth.month() + 1,\n        year: nextMonth.year()\n      })\n    }\n\n    return days\n  }\n\n  isTheMonth(month: number) {\n    return dayjs(this.currentDate).month() === month - 1\n  }\n\n  @Styles\n  btnStyle() {\n    .width(vp2vp(20))\n    .height(vp2vp(20))\n    .backgroundColor('#f6f7f9')\n    .borderRadius(vp2vp(4))\n  }\n\n  build() {\n    Column() {\n      Row() {\n        Column() {\n          Image(img)\n            .width(vp2vp(14))\n            .aspectRatio(1)\n            .rotate({ angle: 180 })\n        }\n        .btnStyle()\n        .justifyContent(FlexAlign.Center)\n        .onClick(() => {\n          const date = dayjs(this.currentDate).subtract(1, 'month')\n          this.currentDate = date.format(this.format)\n          this.onChangeMonth && this.onChangeMonth(date.format('YYYY-MM'))\n        })\n\n        Text(dayjs(this.currentDate).format('YYYY年MM月'))\n          .fontColor('#6B7897')\n          .margin({ right: vp2vp(20), left: vp2vp(20) })\n          .width(vp2vp(110))\n          .textAlign(TextAlign.Center)\n\n        Column() {\n          Image(img)\n            .width(vp2vp(14))\n            .aspectRatio(1)\n        }\n        .btnStyle()\n        .justifyContent(FlexAlign.Center)\n        .onClick(() => {\n          const date = dayjs(this.currentDate).add(1, 'month')\n          this.currentDate = date.format(this.format)\n          this.onChangeMonth && this.onChangeMonth(date.format('YYYY-MM'))\n        })\n      }\n      .padding(15)\n\n      GridRow({ columns: 7 }) {\n        ForEach(this.weeks, (item) => {\n          GridCol() {\n            Column() {\n              Text(item)\n                .fontColor('#6E7B8A')\n            }\n          }.height(vp2vp(40))\n        })\n        ForEach(this.days, (item: DayItem) => {\n          GridCol() {\n            Column() {\n              if (item.isSelected) {\n                Text(item.date.toString())\n                  .fontColor('#fff')\n                  .width(vp2vp(32))\n                  .height(vp2vp(32))\n                  .borderRadius(vp2vp(16))\n                  .backgroundColor('#FFC531')\n                  .textAlign(TextAlign.Center)\n                  .fontSize(vp2vp(14))\n                Text(this.selectedText)\n                  .fontColor('#FFC531')\n                  .fontSize(vp2vp(10))\n                  .margin({ top: vp2vp(2) })\n\n              } else {\n                Text(item.date.toString())\n                  .width(vp2vp(32))\n                  .height(vp2vp(32))\n                  .fontSize(vp2vp(14))\n                  .textAlign(TextAlign.Center)\n                  .fontColor(this.isTheMonth(item.month) ? '#6E7B8A' : '#E1E4E7')\n              }\n            }.onClick(() => {\n              const date = `${item.year}-${item.month.toString().padStart(2, '0')}-${item.date.toString()\n                .padStart(2, '0')}`\n              this.onClickDate && this.onClickDate(date)\n            })\n          }.height(vp2vp(48))\n        })\n      }\n      .padding({ top: vp2vp(15) })\n      .border({ width: { top: 0.5 }, color: '#f6f7f9' })\n    }\n    .width('100%')\n    .backgroundColor('#fff')\n    .borderRadius(vp2vp(8))\n  }\n}\n\n\n3）导出组件\n\nexport { MiniCalendar } from './src/main/ets/components/mainpage/MiniCalendar'\n\n\n4）使用组件\n\n  \"dependencies\": {\n    \"@ohos/miniCalendar\": \"file:../miniCalendar\"\n  }\n\n\n\n\n\n            MiniCalendar({\n              currentDate: '2023-12-9',\n              selectedDays: $selectedDays,\n              onChangeMonth: (date: string) => {\n                promptAction.showToast({ message: date })\n              }\n            })\n\n\n\n3. 打卡日历-显示签到#\n\n1）数据模型\n\nexport class ClockModel {\n  flag?: boolean\n  clockinNumbers?: number\n  totalClockinNumber?: number\n  clockins?: ClockInModel[]\n}\n\nexport class ClockInModel {\n  id: string\n  createdAt: string\n}\n\n\n2）获取数据\n\n  @State\n  clockData: ClockModel = {\n    totalClockinNumber: 0,\n    clockinNumbers: 0\n  }\n\n  aboutToAppear() {\n    this.getData()\n  }\n\n  async getData(date?: {\n    year: string,\n    month: string\n  }) {\n    const res = await Request.get('clockinInfo', date || {})\n    this.clockData = res.data\n    this.selectedDays = res.data.clockins.map(item => item.createdAt)\n  }\n\n\n3）渲染页面\n\n          Row() {\n            this.dayBuilder({ day: this.clockData.totalClockinNumber, text: '累计打卡' })\n            this.dayBuilder({ day: this.clockData.clockinNumbers, text: '连续打卡' })\n          }\n\n\n4）切换月份查询打卡数据\n\n            MiniCalendar({\n              currentDate: '2023-12-9',\n              selectedDays: $selectedDays,\n              onChangeMonth: (date: string) => {\n                const [year, month] = date.split('-')\n                this.getData({ year, month })\n              }\n            })\n\n\n\n编辑资料#\n\n\n1. 资料页面#\n\n            Row() {\n              Text('编辑资料')\n                .fontSize(vp2vp(12))\n                .fontColor($r('app.color.gray'))\n              Image($r('app.media.icon_edit'))\n                .width(vp2vp(12))\n                .aspectRatio(1)\n                .fillColor($r('app.color.gray'))\n            }\n            .onClick(() => {\n              router.pushUrl({\n                url: 'pages/ProfilePage'\n              })\n            })\n\n\n\n\n\n\n@Entry\n@Component\nstruct ProfilePage {\n  @StorageProp(USER_KEY)\n  @Watch('updateUser')\n  userJson: string = '{}'\n  @State\n  user: UserModel = JSON.parse(this.userJson)\n\n  updateUser() {\n    this.user = JSON.parse(this.userJson)\n  }\n\n  pickerAvatar() {\n    // TODO\n  }\n\n  updateNickName() {\n    // TODO\n  }\n\n  build() {\n    Navigation() {\n      List() {\n        ListItem() {\n          Row() {\n            Text('头像')\n            Image(this.user.avatar)\n              .alt('/common/images/avatar.png')\n              .width(vp2vp(40))\n              .aspectRatio(1)\n              .borderRadius(vp2vp(20))\n              .border({ width: 0.5, color: '#e4e4e4' })\n              .onClick(() => {\n                this.pickerAvatar()\n              })\n          }\n          .width('100%')\n          .height(vp2vp(60))\n          .justifyContent(FlexAlign.SpaceBetween)\n        }\n\n        ListItem() {\n          Row() {\n            Text('昵称')\n            TextInput({ text: this.user.nickName })\n              .textAlign(TextAlign.End)\n              .layoutWeight(1)\n              .padding(0)\n              .height(vp2vp(60))\n              .backgroundColor(Color.White)\n              .borderRadius(0)\n              .onChange((value) => this.user.nickName = value)\n              .onSubmit(() => {\n                this.updateNickName()\n              })\n          }\n          .width('100%')\n          .justifyContent(FlexAlign.SpaceBetween)\n        }\n      }\n      .width('100%')\n      .height('100%')\n      .padding({ left: vp2vp(30), right: vp2vp(30), top: vp2vp(15), bottom: vp2vp(15) })\n      .divider({ strokeWidth: 0.5, color: '#f5f5f5' })\n    }\n    .title('完善个人信息')\n    .titleMode(NavigationTitleMode.Mini)\n    .mode(NavigationMode.Stack)\n  }\n}\n\n\n\n2. 修改昵称#\n\n1）实现更新\n\n  updateNickName() {\n    Request.put('userInfo/profile', {\n      nickName: this.user.nickName\n    }).then(res => {\n      promptAction.showToast({ message: '更新昵称成功' })\n      Auth.setUser(this.user)\n    })\n  }\n\n\n2）自定义弹窗\n\n\n\n@CustomDialog\nexport struct IvLoadingDialog {\n  message: string = ''\n  controller: CustomDialogController\n\n  build() {\n    Column() {\n      LoadingProgress()\n        .width(vp2vp(48))\n        .aspectRatio(1)\n        .color('#fff')\n      if (this.message) {\n        Text(this.message)\n          .fontSize(vp2vp(14))\n          .fontColor('#fff')\n      }\n    }\n    .width(vp2vp(120))\n    .aspectRatio(1)\n    .backgroundColor('rgba(0,0,0,0.5)')\n    .borderRadius(vp2vp(16))\n    .justifyContent(FlexAlign.Center)\n  }\n}\n\n\n3）初始化加载框\n\n  dialog: CustomDialogController = new CustomDialogController({\n    builder: IvLoadingDialog({ message: '更新中...' }),\n    customStyle: true,\n\n  })\n\n  updateNickName() {\n  this.dialog.open()\n  Request.post('userInfo/profile', {\n    nickName: this.user.nickName\n  }).then(res => {\n    Auth.setUser(this.user)\n    this.dialog.close()\n  })\n}\n\n\n\n3. 修改头像#\n\n1）选择文件\n\nURI: string = null\n\npickerAvatar() {\n  const photoSelectOptions = new picker.PhotoSelectOptions()\n  photoSelectOptions.MIMEType = picker.PhotoViewMIMETypes.IMAGE_TYPE\n  photoSelectOptions.maxSelectNumber = 1\n\n  const photoViewPicker = new picker.PhotoViewPicker()\n  photoViewPicker.select(photoSelectOptions).then(result => {\n    // 1. 得到文件路径\n    this.URI = result.photoUris[0]\n    this.uploadAvatar()\n  })\n}\n\n\n2）上传图片\n\nuploadAvatar() {\n  this.dialog.open()\n\n  const context = getContext(this)\n  const fileType = 'jpg'\n  const fileName = Date.now() + '.' + fileType\n  const copyFilePath = context.cacheDir + '/' + fileName\n\n  const file = fs.openSync(this.URI, fs.OpenMode.READ_ONLY)\n  fs.copyFileSync(file.fd, copyFilePath)\n\n  const config: request.UploadConfig = {\n    url: BaseURL + 'userInfo/avatar',\n    method: 'POST',\n    header: {\n      'Accept': '*/*',\n      'Authorization': `Bearer ${this.user.token}`,\n      'Content-Type': 'multipart/form-data'\n    },\n    files: [\n      { name: 'file', uri: `internal://cache/` + fileName, type: fileType, filename: fileName }\n    ],\n    data: []\n  }\n\n  request.uploadFile(context, config, (err, data) => {\n    if (err) return Logger.error('UPLOAD', err.message)\n    data.on('progress', (size) => {\n      Logger.info(size.toString())\n    })\n    data.on('complete', () => {\n      this.getUserInfo()\n    })\n  })\n}\n\n\n3）更新数据\n\ngetUserInfo () {\n  Request.get<{ avatar: string }>('userInfo').then(res => {\n    this.user.avatar = res.data.avatar\n    Auth.setUser(this.user)\n    this.dialog.close()\n  })\n}\n","frontmatter":{"title":"HM - 面试宝典APP-我的模块"},"version":""},{"id":10,"title":"HM - 面试宝典APP-应用分发","routePath":"/interview-handbook-project/project/publish","lang":"","toc":[{"text":"发布应用","id":"发布应用","depth":2,"charIndex":3},{"text":"项目经验","id":"项目经验","depth":2,"charIndex":17},{"text":"学习建议","id":"学习建议","depth":2,"charIndex":1217}],"domain":"","content":"#\n\n\n发布应用#\n\n参考文档\n\n\n项目经验#\n\n 1. 项目描述\n\n面试APP提供了多种题目和内容，包括基础知识点问题、原理问题、项目问题等，满足不同前端程序员的需求。同时，面试通APP还包含各大公司的真实面试经验，便于用户找到\n心仪公司的面经。面试通APP支持用户自主选择学习内容，同时还提供了智能推荐和反馈机制，帮助用户更好地掌握知识和技能。\n\n核心功能：\n\n•刷题系统：题库频道、面试题长列表、点赞、收藏、分享、富文本预览\n\n•项目系统：企业级项目场景面试题展示、业务类问答、技术类问答\n\n•面经系统：大厂面试经验、文章阅读、试题阅读数据埋点\n\n•个人中心：打卡、打卡记录、学习时间统计、数据可视化、编辑头像、编辑昵称、退出登录\n\n•历史记录：试题阅读记录、面经阅读记录、点赞收藏记录、个人反馈记录\n\n 2. 使用技术\n\n * 基于 API9 使用 ArtTS 与 ArtUI 实现页面构建和状态管理\n * 基于 PersistentStorage 和 AppStorage 实现用户信息存储和访问权限控制\n * 基于 display 和 deviceInfo 实现适配手机侧函数 vp2vp 做到视觉统一\n * 基于 IDataSource 和 LazyForEach 实现列表懒加载优化列表性能\n * 基于 emitter 实现 UIAbility 进程内通信实现通知更新首页信息\n * 基于 mediaquery 实现设备和横竖屏查询实现多设备布局适配\n * 基于 http 封装请求工具类，实现接口响应数据泛型支持和参数处理与响应拦截\n * 基于鸿蒙系统组件，抽象封装通用组件 Search、Skeleton、MiniCalendar、LoadingDialog、Tag等\n * 基于 UIAbility 和 Page 生命周期实现阅读实现埋点\n * 基于 fs 读取和复制到应用沙箱环境实现文件上传，且完成数据回显功能\n * 基于 Web 组件实现 webview 能力，实现用户协议和隐私协议功能\n * 基于 router 都页面栈进行控制，完成页面栈维护和清理\n * 基于 notificationManager 实现用户学习时间通知提醒\n * 基于动画模块，实现页面转场动画的自定义以及下拉刷新自定义组件动画效果\n * 使用鸿蒙第三方库 dayjs 实现时间相关处理业务逻辑\n * 封装本地库，抽离 MiniCalendar 组件进行共享维护和迭代\n\n整个项目涉及到鸿蒙原生能力应用，文件管理、网络管理、WebView、窗口管理完成项目需求。\n\n 3. 技术亮点\n\n• 实现手机侧统一视觉比例适配，解决 Meta50 显示问题\n\n• 突破了文件上传 API 设计缺陷，和后台约定上传规范\n\n• 共享库维护，将一些通用的组件统一维护，为后期项目迭代准备\n\n其他：\n\n * 如何实现地图？\n * 如何实现支付？\n\n\n学习建议#\n\n 1. 鸿蒙能力集\n 2. 卡片开发\n 3. 本地数据库\n 4. 原子化服务\n 5. 端云一体\n 6. 三个一多","frontmatter":{"title":"HM - 面试宝典APP-应用分发"},"version":""}]