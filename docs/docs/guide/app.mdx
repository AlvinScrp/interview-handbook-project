---
title: HM - 鸿蒙-应用程序开发
---

# 鸿蒙-应用程序开发

## 路由与生命周期

### 1. 路由-常用API

> 如何新建页面，如何跳转和回退操作

1）新建页面

```typescript title="pages/DetailPage.ets"
@Entry
@Component
struct DetailPage {
  build() {
    Column({ space: 15 }) {
      Text('Detail Page')
        .fontSize(40)
      Button('Back')
    }
    .height('100%')
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

```diff title="src/main/resources/base/profile/main_pages.json"
{
  "src": [
    "pages/Index",
+    "pages/DetailPage"
  ]
}
```

::: tip
- 手动新建一个页面（ets）文件，需要在 `main_pages.json` 中手动配置
- 可以自动创建
    <img src="./images/36.png" width="300" />
:::

2）跳转与后退 API 

- 跳转 `router.pushUrl()`
- 后退 `router.back()`
- 替换跳转 `router.replaceUrl()`

```typescript
import router from '@ohos.router'
@Entry
@Component
struct Index {
  build() {
    Column({ space: 15 }) {
      Text('Index Page')
        .fontSize(40)
      Button('Jump To Detail Page')
        .onClick(() => {
          // 1. 跳转，压入页面栈顶部
          // router.pushUrl({
          //   url: 'pages/DetailPage'
          // })

          // 2. 跳转，替换当前页面栈
          // router.replaceUrl({
          //   url: 'pages/DetailPage'
          // })

          // 3. 返回
          // router.back()
        })
    }
    .height('100%')
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

::: tip
- 页面栈的最大容量为32个页面。如果超过这个限制，可以调用 `router.clear()` 方法清空历史页面栈，释放内存空间。

:::

### 2. 路由-参数传递

> 页面参数传递和获取

1）传参

```typescript {26} title="pages/Index.ets"
import router from '@ohos.router'

class User {
  name: string
  age: number
}

@Entry
@Component
struct Index {

  @State
  user: User = {
    name: 'jack',
    age: 18
  }

  build() {
    Column({ space: 15 }) {
      Text('Index Page')
        .fontSize(40)
      Button('Jump To Detail Page')
        .onClick(() => {
          router.pushUrl({
            url: 'pages/DetailPage',
            params: this.user
          })
        })
    }
    .height('100%')
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

2）获取

```typescript {7-10} title="pages/DetailPage.ets"
import router from '@ohos.router'
import promptAction from '@ohos.promptAction'
@Entry
@Component
struct DetailPage {

  aboutToAppear() {
    const params = router.getParams()
    promptAction.showToast({ message: params['name'] + params['age'] })
  }

  build() {
    Column({ space: 15 }) {
      Text('Detail Page')
        .fontSize(40)
      Button('Back')
        .onClick(() => {
          router.back()
        })
    }
    .height('100%')
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

### 3. UIAbility-生命周期

> 当用户打开、切换和返回到对应应用时，应用中的UIAbility实例会在其生命周期的不同状态之间转换。

<img src="./images/37.png" width="600"  />

1. UIAbility实例创建完成时触发，系统会调用 `onCreate()` 回调。
    - 可以在该回调中进行应用初始化操作，例如变量定义资源加载等，用于后续的UI界面展示。
  
2. `onForeground()` 回调，在 UIAbility 的UI界面可见之前，如 UIAbility 切换至前台时触发。
    - 可以在 onForeground() 回调中申请系统需要的资源，或者重新申请在 onBackground() 中释放的资源。

3. `onBackground()` 回调，在 UIAbility 的UI界面完全不可见之后，如 UIAbility 切换至后台时候触发。
    - 可以在 onBackground() 回调中释放UI界面不可见时无用的资源，或者在此回调中执行较为耗时的操作，例如状态保存等

4. Destroy 状态在 UIAbility 实例销毁时触发，系统会调用 `onDestroy()` 回调。
    - 可以在该回调中进行系统资源的释放、数据的保存等操作。


### 4. 组件-生命周期


1）任何组件

`aboutToAppear`

- aboutToAppear 函数在创建自定义组件的新实例后，在执行其 build 函数之前执行。
- 允许在 aboutToAppear 函数中改变状态变量，更改将在后续执行 build 函数中生效。

`aboutToDisappear`

- aboutToDisappear 函数在自定义组件析构销毁之前执行。
- 不允许在 aboutToDisappear 函数中改变状态变量，特别是 @Link 变量的修改可能会导致应用程序行为不稳定。


2）仅页面 `@Entry` 组件 

`onPageShow`

- 页面每次显示时触发一次，包括路由过程、应用进入前后台等场景，仅 @Entry 修饰的自定义组件生效。

`onPageHide`

- 页面每次隐藏时触发一次，包括路由过程、应用进入前后台等场景，仅 @Entry 修饰的自定义组件生效。

`onBackPress`

- 当用户点击返回按钮时触发，仅 @Entry 修饰的自定义组件生效。


### 5. UIAbility跳转

> UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互

- UIAbility组件是系统调度的基本单元，为应用提供绘制界面的窗口；
- 一个UIAbility组件中可以通过多个页面来实现一个功能模块；
- 每一个UIAbility组件实例，都对应于一个最近任务列表中的任务。

```typescript title="OtherAbility"
Button('Jump To PayAbility Page')
  .onClick(() => {
    const context = getContext(this) as common.UIAbilityContext
    const want: Want = {
      bundleName: 'com.itcast.myapplication',
      abilityName: 'PayAbility'
    }
    context.startAbility(want)
  })
```


```typescript title="EntryAbility"
Button('Back')
  .onClick(() => {
    router.back()
  })
```

::: tip

- 后续消息通知跳转到应用也需要跳转到对应的 UIAbility 方式类似

:::


## 使用动画

### 1. 属性动画

> 组件的某些通用属性变化时，可以通过属性动画实现渐变过渡效果，提升用户体验。

- 支持的属性包括width、height、backgroundColor、opacity、scale、rotate、translate等。

```typescript
@Entry
@Component
struct Index {
  @State
  widthSize: number = 100
  @State
  heightSize: number = 40

  build() {
    Column({ space: 15 }) {
      Button('元素动画')
        .width(this.widthSize)
        .height(this.heightSize)
        .onClick(() => {
          this.widthSize = 200
          this.heightSize = 100
        })
        .animation({
          // 动画时间
          duration: 1000,
          // 执行次数
          iterations: -1,
          // 动画曲线
          curve: Curve.Ease,
          // 延时时间
          delay: 1000,
          // 播放模式
          playMode: PlayMode.Alternate
        })
    }
    .height('100%')
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

### 2. 显示动画

> 提供全局animateTo显式动画接口来指定由于闭包代码导致的状态变化插入过渡动效。

```typescript
import promptAction from '@ohos.promptAction'
@Entry
@Component
struct Index {
  @State
  show: boolean = true

  build() {
    Column({ space: 15 }) {
      Column() {
        Row() {
          Text('一级菜单')
            .fontColor('#fff')
            .height(50)
        }
        .onClick(() => {
          animateTo({
            duration: 200,
            onFinish: () => {
              // 动画结束
              promptAction.showToast({ message: 'finish' })
            }
          },() => {
            this.show = !this.show
          })
        })

        if (this.show) {
          Column() {
            Text('二级菜单')
              .fontColor('#fff')
              .height(50)
            Text('二级菜单')
              .fontColor('#fff')
              .height(50)
          }
        }
      }
      .width(100)
      .backgroundColor('#069')
    }
    .height('100%')
    .width('100%')
  }
}
```


### 3. 元素共享转场

> 当路由进行切换时，可以通过设置组件的 `sharedTransition` 属性将该元素标记为共享元素并设置对应的共享元素转场动效。

<img src="./images/38.gif" width="300" />

```typescript title="Index.ets"
import router from '@ohos.router'
@Entry
@Component
struct Index {
  build() {
    Row({ space: 15 }) {
      Column({ space: 10 }){
        Image($rawfile('apple.png'))
          .width('100%')
          .aspectRatio(1)
          .sharedTransition('apple', { duration: 500 })
        Text('鸣春谷 正宗甘肃特产花牛水果苹果 【天水直发】 4.5-5斤中果A(约13-16个)')
          .sharedTransition('text', { duration: 500 })
      }
      .padding(15)
      .width('50%')
      .onClick(() => {
        router.pushUrl({
          url: 'pages/DetailPage'
        })
      })
    }
    .width('100%')
  }
}
```

```typescript title="DetailPage.ets"
@Entry
@Component
struct DetailPage {
  build() {
    Column({ space: 15 }) {
      Column({ space: 10 }){
        Image($rawfile('apple.png'))
          .width('100%')
          .aspectRatio(1)
          .sharedTransition('apple', { duration: 500 })
        Text('鸣春谷 正宗甘肃特产花牛水果苹果 【天水直发】 4.5-5斤中果A(约13-16个)')
          .fontSize(18)
          .sharedTransition('text', { duration: 500 })
      }
      .padding(15)
    }
    .height('100%')
    .width('100%')
  }
}
```

### 4. 拖动手势-阻尼和磁吸


## 原生能力

### 1. 数据管理-用户首选项

### 2. 安全-程序访问控制

### 3. 绘画能力-画布组件

### 4. 公共事件与通知-通知管理

### 5. 后台任务-后台代理提醒


## 今日案例-华为闹钟

### 1. 页面结构-首页结构


### 2. 页面结构-绘制闹钟


### 3. 页面结构-绘制闹钟任务列表


### 4. 页面结构-详情页


### 5. 业务逻辑-渲染闹钟任务列表


### 6. 业务逻辑-跳转详情并渲染


### 7. 业务逻辑-添加&修改闹钟任务


### 8. 业务逻辑-删除闹钟任务


### 10. 业务逻辑-停止和开启闹钟任务
